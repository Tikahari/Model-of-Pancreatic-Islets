define("modules/clean/react/browse/client_download_modal",["require","exports","tslib","react","dig-components/buttons","dig-components/modal","dig-components/typography","modules/clean/ajax","modules/clean/analytics","modules/clean/react/css","modules/clean/react/modal","modules/clean/static_urls","modules/core/browser","modules/core/cookies","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),n=a.__importStar(n),u=a.__importStar(u),c=a.__importStar(c);var _=(function(e){function t(t){var a=e.call(this,t)||this;return a.onAccept=function(){l.TeamsWebActionsLogger.log("uj_popup_modal_clicked",{},(function(){c.redirect("/downloading")}))},a.onDismiss=function(){l.TeamsWebActionsLogger.log("uj_popup_modal_dismissed"),a.setState({isOpen:!1})},a.state={isOpen:!0},a}return a.__extends(t,e),t.showInstance=function(e){u.Modal.showInstance(r.default.createElement(t.ClientDownloadModal,a.__assign({},e)))},t.prototype.getHeader=function(){return this.props.isDownload?h.intl.formatMessage({id:"uu2ys/",defaultMessage:"Download files just by opening them"}):h.intl.formatMessage({id:"xCB92y",defaultMessage:"No more uploads — how easy!"})},t.prototype.getBody=function(){return this.props.isDownload?h.intl.formatMessage({id:"XLoIL2",defaultMessage:"With the Dropbox desktop app, you can access everything in your account right from your desktop. Save to the cloud instantly, and download files when you need them just by opening them."}):h.intl.formatMessage({id:"0PKyIR",defaultMessage:"With the Dropbox desktop app and selective sync, you can open, edit, and save files right on your desktop. Your changes sync automatically to all your devices, so you save time and hard drive space."})},t.prototype.render=function(){return r.default.createElement(s.Modal,{open:this.state.isOpen,withCloseButton:h.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),className:"uj-popup-modal",onRequestClose:this.onDismiss},r.default.createElement(s.Modal.Header,{hasBottomSpacing:"title-standard"},r.default.createElement(i.Title,null,this.getHeader())),r.default.createElement(s.Modal.Body,null,r.default.createElement("div",null,r.default.createElement("img",{alt:"",src:p.static_url("/static/images/install/uj_popup_install-vflA_v5Lg.png")})),r.default.createElement(i.Text,null,this.getBody())),r.default.createElement(s.Modal.Footer,null,r.default.createElement(o.Button,{variant:"primary",onClick:this.onAccept},h.intl.formatMessage({id:"EsqZjG",defaultMessage:"Download for free"}))))},t.ClientDownloadModal=d.requireCssWithComponent(t,["/static/css/browse/popup_modal-vflCDH3Gh.css","/static/css/dig-components/index.web-vflSjAPFK.css"]),t})(r.default.Component);t.ClientDownloadModalView=_,t.maybeShowClientDownloadModal=function(e){"y"!==m.Cookies.read("uj-pop")&&n.WebRequest({url:"/should_show_uj_popup",data:{is_download:e},success:function(t){JSON.parse(t).showModal&&(_.showInstance({isDownload:e}),m.Cookies.create("uj-pop","y",30))},error:function(){}})}})),define("modules/clean/react/browse/shared_with",["require","exports","tslib","external/lodash","react","modules/clean/ajax","modules/clean/api_v2/default_user_client","modules/clean/avatar/size","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/integrations/report_error","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/folder_overview_selectors","modules/clean/react/browse/data/store","modules/clean/react/browse/models","modules/clean/react/browse/shared_with_view","modules/clean/react/files_view/types","modules/clean/sharing/api","modules/clean/sharing/api/client","spectrum-sharing/utils/sharing_constants","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/share_modal_util","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/avatar_info","modules/clean/viewer","modules/core/browser"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T,v,b,A,M,I,U,R){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),o=a.__importDefault(o),s=a.__importStar(s),l=a.__importStar(l),m=a.__importStar(m),h=a.__importStar(h),_=a.__importStar(_),R=a.__importStar(R);var C=new((function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._fetchIntegrationData=function(e){var a=h.user(f.getStoreForBrowse().getState());return(e?e():new i.DefaultUserApiV2Client(a)).ns("integrations").rpc("get_user_settings",{},{}).then((function(e){var a=e.dismissed_prompts.filter((function(e){return"tooltip_click_for_more_auto_display"===e[".tag"]})).length>0;void 0===t._integrationData&&(t._integrationData=E.defaultIntegrationData),t._integrationData.autoDisplayTooltip=!a})).catch((function(e){p.webReportError(e,"non-critical",["ProfileCard"],{endpoint:"integrations/get_user_settings",entry_point:"browse page side bar"})})).finally((function(){t.emit_change()}))},t}return a.__extends(t,e),t.prototype.initializeWith=function(e){var t=e.path,a=e.files;return this._pathLoaded(t,a)},t.prototype._init=function(){this._sharedFolderDataByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._sharedLinkInfoByPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={},this._hasSharedDataLoadedByContainingPath={},this._integrationData=void 0},t.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},t.prototype.clearSharedLinkDataCache=function(){this._filesWeHaveSharedLinkDataFor={}},t.prototype.getDataForPath=function(e){var t={},a=this._getSharedLinkInfoByPath(e);return a&&(t.sharedLinkInfo=a),t},t.prototype.getDataForFile=function(e){var t={};if(e&&!e.target_ns&&this._canBeSharedFile(e)){var a=this._sharedFileDataByFileId[e.file_id||e.fq_path]||{},o=this._sharedFolderDataByTargetNs[h.context(f.getStoreForBrowse().getState()).currentNSID]||{};null!=a.joinedMembers&&a.joinedMembers.length||null!=a.groups&&a.groups.length||null!=a.invitations&&a.invitations.length||(t.audienceDescription=o.audienceDescription),t.groups=r.uniqBy(r.union(a.groups||[],o.groups||[]),(function(e){return e.gid})),t.invitations=r.uniqBy(r.union(a.invitations||[],o.invitations||[]),(function(e){return e.email_or_fbname})),t.joinedMembers=r.uniqBy(r.union(a.joinedMembers||[],o.joinedMembers||[]),(function(e){return e.email})),t.numUndisplayableUsersAndInvites=(a.numUndisplayableUsersAndInvites||0)+(o.numUndisplayableUsersAndInvites||0);var s=(null!=t.joinedMembers?t.joinedMembers.length:0)+(null!=t.invitations?t.invitations.length:0)+(t.numUndisplayableUsersAndInvites||0);null!=t.groups&&(s+=t.groups.map((function(e){return e.num_users||1})).reduce((function(e,t){return e+t}),0)),t.memberCount=s}else t=e&&e.target_ns?this._sharedFolderDataByTargetNs[e.target_ns]:this._sharedFolderDataByTargetNs[h.context(f.getStoreForBrowse().getState()).currentNSID];t=t||{};var i=this._getSharedLinkInfoByFile(e);return i?t.sharedLinkInfo=i:null!=t&&delete t.sharedLinkInfo,t.hasSharedDataLoaded=this._getHasSharedDataLoaded(),t},t.prototype.getIntegrationData=function(){return this._integrationData||E.defaultIntegrationData},t.prototype._getSharedLinkInfoByPath=function(e){return this._sharedLinkInfoByPath[e]},t.prototype._getSharedLinkInfoByFile=function(e){var t,a=h.path(f.getStoreForBrowse().getState()),r=this._sharedLinkDataMapsByFolderFQPath[a];return r&&e&&(t=r[this._sharedLinkKey(e)]),t},t.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case c.SharedWithActionType.BROWSE_FILES_LOADED:return this._pathLoaded(t.data.parentPath,t.data.files);case c.SharedWithActionType.BROWSE_FILES_UPDATED:return this._filesChanged(t.data.parentPath,t.data.files);case c.SharedWithActionType.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(t.data.fileIds);case c.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(t.data.parentPath);case c.SharedWithActionType.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(t.data.parentPath,t.data.fileFqPaths);case c.SharedWithActionType.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(t.data.sharedFolderData,t.data.containingPath);case c.SharedWithActionType.SET_SHARED_LINK_DATA:return this._setSharedLinkData(t.data.parentPath,t.data.sharedLinkData);case c.SharedWithActionType.SET_SHARED_LINK_INFO_FOR_PARENT_PATH:return this._setSharedLinkInfoForParentPath(t.data.parentPath,t.data.sharedLinkInfo);case c.SharedWithActionType.SET_SHARED_FILE_DATA:return this._setSharedFileData(t.data.sharedFileData);case c.SharedWithActionType.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(t.data.targetNs);case c.SharedWithActionType.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(t.data.parentPath,t.data.files);case c.SharedWithActionType.INIT_INTEGRATION_DATA:return this._fetchIntegrationDataIfNotExisting()}},t.prototype._fillInMissingSharedLinkData=function(e){for(var t=e.parentPath,a=[],r=0,o=e.files;r<o.length;r++){var s=o[r];this.hasLinkDataForFile(s)||(this._filesWeHaveSharedLinkDataFor[s.fq_path]=!0,a.push(s))}return D.loadLinkDataForFiles({parentPath:t,fileFqPaths:a.map((function(e){return e.fq_path}))})},t.prototype._getHasSharedDataLoaded=function(){var e=h.path(f.getStoreForBrowse().getState());return e in this._hasSharedDataLoadedByContainingPath&&this._hasSharedDataLoadedByContainingPath[e]},t.prototype._setHasSharedDataLoaded=function(e){var t=h.path(f.getStoreForBrowse().getState());return this._hasSharedDataLoadedByContainingPath[t]=e},t.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},t.prototype._loadSharedFileData=function(e){void 0===e&&(e=!1),e&&(this._sharedFileDataByFileId={});for(var t=[],a=0,r=h.sortedFiles(f.getStoreForBrowse().getState()).toArray();a<r.length;a++){var o=r[a];!this._canBeSharedFile(o)||o.file_id in this._sharedFileDataByFileId||t.push(o.file_id)}return D.loadSharedFileDataForFiles({fileIds:t})},t.prototype._pathLoaded=function(e,t){this._setHasSharedDataLoaded(!1),D.loadSFDataForPath({parentPath:e,abortCurrentRequest:!0}),D.loadSFLinkDataForPath({parentPath:e}),this._loadSharedFileData(!0),this._filesAdded(e,t),this.emit_change()},t.prototype._filesAdded=function(e,t){this._fillInMissingSharedLinkData({parentPath:e,files:t}),this._loadSharedFileData(),this.emit_change()},t.prototype._filesChanged=function(e,t){e===h.path(f.getStoreForBrowse().getState())&&(D.loadSFDataForPath({parentPath:e}),D.loadSFLinkDataForPath({parentPath:e}),this.clearSharedLinkDataCache(),this._fillInMissingSharedLinkData({parentPath:e,files:t}),this._loadSharedFileData(!0),this.emit_change())},t.prototype._signalSharedFileDataOutOfDate=function(e){return D.loadSharedFileDataForFiles({fileIds:e})},t.prototype._signalSharedFolderDataOutOfDate=function(e){return null==e&&(e=h.path(f.getStoreForBrowse().getState())),D.loadSFDataForPath({parentPath:e})},t.prototype._signalSharedLinkDataOutOfDate=function(e,t){return null==e&&(e=h.path(f.getStoreForBrowse().getState())),D.loadSFLinkDataForPath({parentPath:e}),D.loadLinkDataForFiles({parentPath:e,fileFqPaths:t})},t.prototype._setNSSharedWithData=function(e,t){this._sharedFolderDataByTargetNs=e,this._hasSharedDataLoadedByContainingPath[t]=!0,this.emit_change()},t.prototype._setSharedLinkData=function(e,t){for(var a=this._sharedLinkDataMapsByFolderFQPath[e]||{},r=0,o=t;r<o.length;r++){var s=o[r],i=s.file,n=s.sharedLinkToken;a[this._sharedLinkKey(i)]=n}return this._sharedLinkDataMapsByFolderFQPath[e]=a,this.emit_change()},t.prototype._setSharedLinkInfoForParentPath=function(e,t){return this._sharedLinkInfoByPath[e]=t,this.emit_change()},t.prototype._setSharedFileData=function(e){this._sharedFileDataByFileId=a.__assign(a.__assign({},this._sharedFileDataByFileId),e),this.emit_change()},t.prototype._clearSharedFolderDataForNs=function(e){return delete this._sharedFolderDataByTargetNs[e],this.emit_change()},t.prototype._removeSharedLinkData=function(e,t){for(var a=this._sharedLinkDataMapsByFolderFQPath[e]||{},r=0,o=t;r<o.length;r++){var s=o[r];delete a[this._sharedLinkKey(s)]}return this._sharedLinkDataMapsByFolderFQPath[e]=a,this.emit_change()},t.prototype._fetchIntegrationDataIfNotExisting=function(e){return void 0===this._integrationData?this._fetchIntegrationData(e):Promise.resolve()},t})(d.Store));t.SharedWithStore=C,document.addEventListener(y.SharingApi.REQUEST_SUCCEEDED_EVENT,(function(e,t){return t.request_url.indexOf("/share_ajax/leave")>-1?u.Dispatcher.dispatch({type:c.SharedWithActionType.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):u.Dispatcher.dispatch({type:c.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:h.path(f.getStoreForBrowse().getState())}})}));var D=(function(){function e(){}return e.loadSFDataForPath=function(t){var a=t.parentPath,r=t.abortCurrentRequest,o=void 0!==r&&r,i=h.user(f.getStoreForBrowse().getState());o&&null!=e._currentSFDataRequest&&e._currentSFDataRequest.abort(),e._currentSFDataRequest=s.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:i,data:{max_results:5,fq_path_prefix:a,include_inherited:!0,sort_by_name:!0},success:function(e){for(var t={},r=0,o=e;r<o.length;r++){var s=o[r];t[s.ns_id]={numUndisplayableUsersAndInvites:s.num_avatars_not_shown,groups:s.groups,invitations:s.invitations,joinedMembers:s.joined_members,audienceDescription:s.audience_description,memberCount:s.num_users_and_invites}}return u.Dispatcher.dispatch({type:c.SharedWithActionType.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:t,containingPath:a}})},complete:function(){e._currentSFDataRequest=null}})},e.loadSharedFileDataForFiles=function(e){var t=e.fileIds,a=h.user(f.getStoreForBrowse().getState());if(a.is_email_verified){var r=new T.FileShareApiClient({userId:a.id}),o=function(e){if(!e||0!==e.length){var t=e.slice(0,100),a=e.slice(100);return r.listMembersBatch({contentIds:t,limit:5}).then((function(e){var t={};if(e.forEach((function(e,a){return t[a]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(I.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(I.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(I.apiUserMemberToAvatarInfo).toArray()}})),u.Dispatcher.dispatch({type:c.SharedWithActionType.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),a)return o(a)}))}};return o(t)}},e.loadSFLinkDataForPath=function(e){var t=e.parentPath,a=h.user(f.getStoreForBrowse().getState());s.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify([t])},subject_user:a,success:function(e){for(var a,r=0,o=e.shmodels;r<o.length;r++){var s=o[r];s.disabled||l.paths_are_equal(s.path,t)&&(a=s)}u.Dispatcher.dispatch({type:c.SharedWithActionType.SET_SHARED_LINK_INFO_FOR_PARENT_PATH,data:{parentPath:t,sharedLinkInfo:a}})}})},e.loadLinkDataForFiles=function(e){var t=e.parentPath,a=e.fileFqPaths,o=h.user(f.getStoreForBrowse().getState()),i=function(e){if(0!==e.length){var a=e.slice(0,100),n=e.slice(100);s.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(a)},subject_user:o,success:function(e){for(var o,s=h.unsortedFiles(f.getStoreForBrowse().getState()),l=[],d=0,p=e.shmodels;d<p.length;d++){var m=p[d];m.disabled||(o=s.get(m.path))&&l.push({file:o,sharedLinkToken:m})}l.length&&u.Dispatcher.dispatch({type:c.SharedWithActionType.SET_SHARED_LINK_DATA,data:{parentPath:t,sharedLinkData:l}});for(var _,g=r.zipObject(r.map(e.shmodels,"path"),r.map(e.shmodels,(function(){return!0}))),E=[],S=0,y=a;S<y.length;S++){var T=y[S];T in g||(_=s.get(T))&&E.push(_)}if(E.length&&u.Dispatcher.dispatch({type:c.SharedWithActionType.REMOVE_SHARED_LINK_DATA,data:{parentPath:t,files:E}}),n)return i(n)}})}};i(a)},e._currentSFDataRequest=null,e})();t.SharedWithActions=D;var O=(function(e){function t(t){var a=e.call(this,t)||this;return a.receiveStateFromStores=function(e){a.setState(a.getStateFromStores(e))},a.handleMembershipClick=function(){var e=a.props,t=e.browseContext,r=e.file,o=e.user;if(r||!t.isCurrentlyInRoot){if((!r||!g.File.isTeamMemberFolder(r))&&(!r||g.File.canViewFileMembers(r,t)))return A.showShareModal(o,r||t,{browseContext:t,origin:v.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW},(function(e){var t=e.path,a=e.qargs;return f.getStoreForBrowse().dispatch(m.setUrl({path:t,qargs:a}))}))}else{var s=U.Viewer.get_viewer(),i=o.is_team&&!s.team_is_limited;o.is_team_admin&&i?R.open_tab("/team/admin/members"):R.open_tab("/team#members")}},a.handleSharedLinkClick=function(){var e=a.props,t=e.browseContext,r=e.file,o=e.user;return A.showShareModal(o,r||t,{browseContext:t,origin:v.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW},(function(e){var t=e.path,a=e.qargs;return f.getStoreForBrowse().dispatch(m.setUrl({path:t,qargs:a}))}))},a.state=a.getStateFromStores(),a}return a.__extends(t,e),t.prototype.componentDidMount=function(){C.add_change_listener(this.receiveStateFromStores),M.sharingInfoStore.add_change_listener(this.receiveStateFromStores),this.props.isInAudienceBox&&setTimeout((function(){u.Dispatcher.dispatch({type:c.SharedWithActionType.INIT_INTEGRATION_DATA})}),0),this.setState(this.getStateFromStores())},t.prototype.componentWillUnmount=function(){C.remove_change_listener(this.receiveStateFromStores),M.sharingInfoStore.remove_change_listener(this.receiveStateFromStores)},t.prototype.UNSAFE_componentWillReceiveProps=function(e){this.receiveStateFromStores(e)},t.prototype.getStateFromStores=function(e){void 0===e&&(e=this.props);var t=e.browseContext,a=e.file,r=e.user,o=t.currentFQPath,s=C.getDataForFile(a),i=C.getDataForPath(o),n=C.getIntegrationData(),l=a?s.sharedLinkInfo:i.sharedLinkInfo,d=M.sharingInfoStore.getSharingInfo(r.id,a&&a.fq_path),u=_.loadingState(f.getStoreForBrowse().getState())===S.LoadingState.LOADING_FIRST_PAGE,p=s||{},c=p.audienceDescription,m=void 0===c?void 0:c,h=p.numUndisplayableUsersAndInvites,g=void 0===h?0:h,E=p.groups,y=void 0===E?[]:E,T=p.hasSharedDataLoaded,v=void 0!==T&&T,b=p.invitations,A=void 0===b?[]:b,I=p.joinedMembers,U=void 0===I?[]:I,R=p.memberCount;return{audienceDescription:m,numUndisplayableUsersAndInvites:g,groups:y,hasSharedDataLoaded:v&&!u,invitations:A,joinedMembers:U,memberCount:void 0===R?0:R,sharedLinkInfo:l,linkMetadata:d&&d.linkMetadata()||void 0,integrationData:n}},t.prototype.render=function(){var e=this.props,t=e.browseContext,a=e.file,r=e.tabIndex,s=e.user;if(t.isCurrentlyInRoot&&null==a&&!s.is_cdm_member)return null;var i=a?g.File.canViewFileMembers(a,t):t.canViewContainingNSMembers,l=s.is_cdm_member&&"/"===t.currentFQPath&&t.currentNSID===t.rootNSID,d=this.props,u=d.inSelectMode,p=d.isInAudienceBox,c=this.state,m=c.audienceDescription,h=c.groups,_=c.hasSharedDataLoaded,f=c.integrationData,S=c.invitations,y=c.joinedMembers,T=c.linkMetadata,v=c.memberCount,A=c.numUndisplayableUsersAndInvites,M=c.sharedLinkInfo;return o.default.createElement(E.SharedWithView,{user:s,file:a,onOverflowCountClick:this.handleMembershipClick,onAvatarClick:this.handleMembershipClick,groups:h,invitations:S,joinedMembers:y,numUndisplayableUsersAndInvites:A,memberCount:v,parentFolderName:t.getNameOfTargetFolder(),animation:!1,avatarDimension:n.AVATAR_DIMENSION_BY_SIZE.MEDIUM,maxVisibleAvatars:5,sharedLinkInfo:M,onSharedLinkClick:this.handleSharedLinkClick,publicFolderSharing:a&&b.shouldUsePublicFolderSharing(t.config,a.fq_path),isCdmRoot:l,inSelectMode:u,isInAudienceBox:p,audienceDescription:m,hasSharedDataLoaded:_,canViewMembers:i&&!t.isInsideDeletedFolder,inContentManagerCdmRoot:!1,linkMetadata:T,integrationData:f,tabIndex:r})},t})(o.default.Component);t.SharedWithController=O})),define("modules/clean/react/browse/shared_with_view",["require","exports","tslib","classnames","create-react-class","react","react-dom-factories","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","spectrum-sharing/utils/sharing_constants","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/user_education/react/user_education_effect","modules/core/i18n","modules/clean/integrations/integration_popover","modules/clean/react/css","modules/clean/integrations/data/store","modules/clean/file_store/utils","modules/clean/filetypes","deep-integrations/async"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),s=a.__importDefault(s),i=a.__importDefault(i),d=a.__importDefault(d);var v=s.default.createElement,b=n.AVATAR_DIMENSION_BY_SIZE.SMALL,A=_.intl.formatMessage({id:"Y73l91",defaultMessage:"No access"}),M=_.intl.formatMessage({id:"jw1rtm",defaultMessage:"Limited access"});t.defaultIntegrationData={autoDisplayTooltip:!1};var I,U=o.default({displayName:"SharedWithView",mixins:[c.MemberAvatarsMixin],getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:b,maxVisibleAvatars:5,file:void 0,canViewMembers:!0,inContentManagerCdmRoot:!1,inSelectMode:!1,memberCount:0,isCdmRoot:!1,joinedMembers:[],integrationData:t.defaultIntegrationData}},render:function(){if(this.props.inContentManagerCdmRoot){if(0===this.props.groups.length)return i.default.div({});var e=this.props.groups[0].num_users;return i.default.div({className:"audience-description",onClick:function(e){return e.preventDefault(),e.stopPropagation()}},_.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:e}))}return this.props.isInAudienceBox?this.props.canViewMembers?this.props.file&&this.props.file.isDeleted?null:i.default.div({className:this.getClassName()},this.props.hasSharedDataLoaded?v(h.UserEducationEffect,{containerName:this.constructor.displayName,name:"AudienceBoxAvatars"},this.renderAudienceBoxAvatars()):v(l.LoadingIndicator,{style:l.LoadingIndicator.LoadingIndicatorStyle.DOTS})):null:i.default.div({className:this.getClassName()},this._hasSharedLink()?this.renderSharedLinkInColumn():void 0,this.renderAudienceDescription())},getClassName:function(){return r.default({"shared-with-members":!0,"audience-box u-pad-top-xs u-pad-bottom-s u-mar-bottom-xs":this.props.isInAudienceBox})},renderSharedLinkInColumn:function(){var e=this.props.onSharedLinkClick,t=this.props.inSelectMode;return v(d.default,{key:"shared_link",text:this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo,this.props.linkMetadata),direction:this.props.titleButtonDirection,className:"audience-description__link-avatar"},i.default.img({src:m.static_url("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||_.intl.formatMessage({id:"KGWCGo",defaultMessage:"Shared link"}),width:12,height:12,onClick:function(a){if(!t)return e(),a.preventDefault(),a.stopPropagation()}}))},renderAudienceDescription:function(){var e,t;if(!this.props.hasSharedDataLoaded)return null;if(this.props.file&&this.props.file.isDeleted)e=_.intl.formatMessage({id:"RBvabN",defaultMessage:"Deleted"});else if(this.props.canViewMembers)this.props.audienceDescription&&(e=this.props.audienceDescription);else{var a=this.props.file._mount_access_perms;e=a&&a.includes("can_view")?M:A}var r=(this.props.groups||[]).concat(this.props.joinedMembers||[]).concat(this.props.invitations||[]),o=r.length+(this.props.numUndisplayableUsersAndInvites||0),s=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers||[])[0];if(!(!(o>=0)||1===o&&s||this.props.file&&this.props.file.isDeleted)){e||(e=_.intl.formatMessage({id:"ECZFz/",defaultMessage:"{count, plural, one{{count} member} other{{count} members}}"},{count:this.props.memberCount}));var n=r.slice(0,this.props.maxVisibleAvatars).map((function(e){return u.Emstring.em_snippet(e.display_name||e.email||e.name||e.email_or_fbname,p.SNIPPET_SIZES.DISPLAY_NAME)}));if(o>this.props.maxVisibleAvatars){n.pop();var l=o-(this.props.maxVisibleAvatars-1),c=_.intl.formatMessage({id:"asRDyH",defaultMessage:"{count, plural, one{and {count} more...} other{and {count} more...}}"},{count:l});n.push(c)}t=n.join("\n")}this.props.publicFolderSharing&&this.props.file&&!this.props.file.is_dir?e||(e=_.intl.formatMessage({id:"m1ZBqW",defaultMessage:"Anyone"})):e||(e=_.intl.formatMessage({id:"ZP6Ear",defaultMessage:"Only you"}));var m=this.props,h=m.inSelectMode,f=m.file,g=m.onAvatarClick,E=m.tabIndex,S=f?f.isDeleted:void 0,y=i.default.div({className:"audience-description",onClick:function(e){if(!h&&!S)return g(),e.preventDefault(),e.stopPropagation()},tabIndex:E,"aria-label":e.toString()},e);return t?v(d.default,{key:"membership_column_bubble",respectLineBreaks:!0,text:t,direction:this.props.titleButtonDirection},y):y},renderAudienceBoxAvatars:function(){var e=[],t=this.props.joinedMembers?this.props.joinedMembers:[],a=this.props.groups?this.props.groups.slice():[],r=this.props.invitations?this.props.invitations.slice():[],o=this._getIntegrationPopoverInfo();this._addSharedLinkIfExists(e);var s=[],n=this.findOwnerAndMeInJoinedMembers(t)[1];if(n&&(s.push(n.user_id),e.push(c.renderJoinedMember({arePairedUsersInSF:this.state.paired_users_in_sf,member:n,avatarArgs:{avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onAvatarClick,titleButtonDirection:this.props.titleButtonDirection}},this._getIntegrationPopoverInfo(!0)))),this.addGroupsMembersInvitations(e,a,t,r,s,o),1===e.length&&n){if(this.props.user.is_team_admin&&this.props.isCdmRoot){for(var l=1;l<=this.props.maxVisibleAvatars-1;l++)e.push(c.renderPlaceholderAvatar({index:l,description:_.intl.formatMessage({id:"sTZgnw",defaultMessage:"Invite"}),avatarArgs:{onAvatarClick:this.props.onAvatarClick,avatarDimension:this.props.avatarDimension,titleButtonDirection:this.props.titleButtonDirection}}));return this.renderAvatarList(e,void 0,o)}var d=void 0;return d=this._hasSharedLink()?this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo,this.props.linkMetadata):_.intl.formatMessage({id:"8yAvwd",defaultMessage:"Only you have access"}),i.default.div({className:"audience-box--text-only"},d)}return this.renderAvatarList(e,void 0,o)},_addSharedLinkIfExists:function(e){return this._hasSharedLink()?e.push(this.renderSharedLink(this.props.sharedLinkInfo,null,this._getIntegrationPopoverInfo())):null},_hasSharedLink:function(){return Boolean(this.props.sharedLinkInfo)},_getIntegrationPopoverInfo:function(e){return{integrationPopoverGroup:this._getIntegrationPopoverGroup(),integrationStore:this._getIntegrationStore(),autoDisplayTooltip:e&&this.props.integrationData.autoDisplayTooltip,entryPoint:"browse_page_side_bar",fileInfo:this.props.file?{".tag":this.props.file.type===y.FileTypes.FILE?"file":"folder",id:T.fulfilled(this.props.file.file_id),name:S.getFilename(this.props.file)}:void 0}},_getIntegrationStore:function(){return E.initStoreForIntegration(this.props.user.id)},_getIntegrationPopoverGroup:function(){return I||(I=new f.IntegrationPopoverGroup),I}});t.SharedWithViewWithoutCSS=U;var R=g.requireCssWithComponent(U,["/static/js/deep-integrations/index.web-vflaKPXS_.css"]);t.SharedWithView=R})),define("modules/clean/react/file_modal_controller",["require","exports","tslib","react","modules/clean/filepath","modules/clean/react/file_modals","modules/clean/react/modal","modules/clean/sharing/gating_util"],(function(e,t,a,r,o,s,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importStar(o),t.showPermanentlyDelete=function(e,t,a){var o=r.default.createElement(s.PermanentlyDeleteModal,{files:t,userId:e.id,onDelete:a});i.Modal.showInstance(o)},t.showDelete=function(e,t,a,o,n){var l=a.isInsideSharedFolder||a.isNonUserRelativeContext&&a.isCurrentlyInRoot,d=a.isNonUserRelativeContext,u=r.default.createElement(s.DeleteFileModal,{files:t,user:e,isNonUserRelativeContext:d,parentSharedFolderName:l?o:null,onDelete:n});i.Modal.showInstance(u)},t.showContentManagerBridge=function(e,t,a){var o=r.default.createElement(s.ContentManagerBridgeModal,{files:e,type:t,isLimitedTeam:a});i.Modal.showInstance(o)},t.showNoAccess=function(e,t,a){var l=r.default.createElement(s.NoAccessFolderModal,{folderName:o.filename(t.fq_path),folderPath:t.fq_path,userIsSameTeam:!(!e.team_dbtid||!a.teamFolderOwnerTeamApiId||e.team_dbtid!==a.teamFolderOwnerTeamApiId),userIsSuperAdmin:n.GoldenGate.hasContentManagerAndSuperAdmin(e.id),userIsCdmMember:e.is_cdm_member});i.Modal.showInstance(l)},t.showConfirmOwnershipTransferModal=function(e){var t=r.default.createElement(s.ConfirmOwnershipTransferModal,{onAccept:e});i.Modal.showInstance(t)},t.showFileSystemWarningsModal=function(e){i.Modal.showInstance(r.default.createElement(s.FileSystemWarningsModal,a.__assign({},e)))},t.showMoveErrorModal=function(e){i.Modal.showInstance(r.default.createElement(s.MoveErrorModal,a.__assign({},e)))}})),define("modules/clean/react/file_modals",["require","exports","tslib","react","react-intl","spectrum/button","spectrum/modal","modules/clean/em_string","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/css","modules/clean/react/modal","spectrum-sharing/utils/sharing_constants","modules/clean/web_user_action_events","modules/core/browser","modules/core/i18n","modules/clean/ux_analytics_utils","modules/clean/viewer","modules/clean/pnm/utils","modules/clean/filepath"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y){"use strict";function T(t){return a.__awaiter(this,void 0,Promise,(function(){return a.__generator(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(t,a){e(["modules/clean/sharing/content_manager"],t,a)})).then(a.__importStar)];case 1:return(0,r.sent().goToContentManagerForPath)(t),[2]}}))}))}function v(){var e=document.querySelector(".mc-util-modal-actions-buttons .mc-button-primary");e&&e.focus()}Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),l=a.__importStar(l),_=a.__importStar(_);var b=(function(e){function t(t){var a=e.call(this,t)||this;return a.handleAccept=function(){u.logFileOperationModalClick({uid:a.props.userId,event_name:h.WebUserActionLogEvent.PERMANENT_DELETE_ACCEPT_CLICK}),a.props.onDelete()},a.handleCancel=function(){a.setState({isModalOpen:!1})},a.onModalReady=function(){v()},a.state={isModalOpen:!0},a}return a.__extends(t,e),t.prototype.isSingleSharedFolder=function(e){return 1===e.length&&e[0].type===d.FileTypes.SHARED_FOLDER},t.prototype.getTitle=function(e){var t=e.length;return this.isSingleSharedFolder(e)?f.intl.formatMessage({id:"tsfY1h",defaultMessage:"Remove access to folder?"}):f.intl.formatMessage({id:"SuReIT",defaultMessage:"{count, plural, one{Permanently delete {count} file?} other{Delete {count} items permanently?}}"},{count:t})},t.prototype.renderContent=function(e){var t=e.length;if(1===t){var a=l.filename(e[0].fq_path);return this.isSingleSharedFolder(e)?f.intl.formatMessage({id:"nY1t1d",defaultMessage:"Are you sure you want to remove your access to <strong>{filename}</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."},{strong:function(e){return r.default.createElement("strong",null,e)},filename:a}):f.intl.formatMessage({id:"DZcmlQ",defaultMessage:"Are you sure you want to delete <strong>{filename}</strong> from your Dropbox permanently?"},{strong:function(e){return r.default.createElement("strong",null,e)},filename:a})}return r.default.createElement("span",null,f.intl.formatMessage({id:"4FbsPD",defaultMessage:"{count, plural, one{Are you sure you want to permanently delete {count} item from your Dropbox?} other{Are you sure you want to permanently delete {count} items from your Dropbox?}}"},{count:t}))},t.prototype.render=function(){var e=this.getTitle(this.props.files);return r.default.createElement(i.UtilityModal,{ariaLabel:e,title:e,primaryAction:this.isSingleSharedFolder(this.props.files)?f.intl.formatMessage({id:"eTtbKw",defaultMessage:"Remove my access"}):f.intl.formatMessage({id:"5jtRU7",defaultMessage:"Delete permanently"}),secondaryAction:f.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onPrimaryAction:this.handleAccept,open:this.state.isModalOpen,shouldRequestCloseOnActions:!0,overlayClickClose:!0,onRequestClose:this.handleCancel,displayCloseButton:!0,onReady:this.onModalReady},this.renderContent(this.props.files))},t})(r.default.Component);t.PermanentlyDeleteModal=b;t.showUnifiedTrashModal=function(t){var r=function(){return(function(e){var t=e.files,a=e.context,r=e.userId,o=e.onRestore;t||(t=[{fq_path:a.currentFQPath,ns_path:a.currentNSPath,ns_id:a.currentNSID}]),o(r,t)})(t)},o=t.userId,s=t.context,i=t.files;new Promise((function(t,a){e(["modules/clean/react/trash/trash_modal_util"],t,a)})).then(a.__importStar).then((function(e){(0,e.openTrashModalFromBrowseFiles)({userId:o,context:s,files:i,onRestore:r})}))},t.showPurgeModal=function(t){var r=t.userId,o=t.context,s=t.files,i=function(){return(function(e){var t=e.files,a=e.context,r=e.userId,o=e.onPurge;t||(t=[{fq_path:a.currentFQPath,ns_path:a.currentNSPath,ns_id:a.currentNSID}]),o(r,t)})(t)};new Promise((function(t,a){e(["modules/clean/react/trash/trash_modal_util"],t,a)})).then(a.__importStar).then((function(e){(0,e.openPurgeModalFromBrowseFiles)({userId:r,context:o,files:s,onPurge:i})}))};var A=(function(e){function t(t){var a=e.call(this,t)||this;return a.getViewerTeamNameStr=function(){var e=E.Viewer.get_viewer().team_name;return e?"‘"+e+"’ ":""},a.handleAccept=function(){u.logFileOperationModalClick({uid:a.props.user.id,event_name:h.WebUserActionLogEvent.DELETE_ACCEPT_CLICK}),a.props.onDelete(),g.dispatchModalClosed()},a.handleCancel=function(){a.setState({isModalOpen:!1}),g.dispatchModalClosed()},a.onModalReady=function(){v(),g.dispatchModalOpened()},a.isRemovingSharedFolder=function(){return 1===a.props.files.length&&a.props.files[0].target_ns},a.getTitle=function(){var e=a.props.files;return e.length<1?"":1===e.length?e[0].is_dir?a.isRemovingSharedFolder()?f.intl.formatMessage({id:"LuUl3L",defaultMessage:"Remove shared folder?"}):f.intl.formatMessage({id:"5Vbnwn",defaultMessage:"Delete folder?"}):f.intl.formatMessage({id:"G3f1O4",defaultMessage:"Delete file?"}):f.intl.formatMessage({id:"scjK+h",defaultMessage:"{count, plural, one{Delete {count} item?} other{Delete {count} items?}}"},{count:e.length})},a.isTsdPlusOne=function(){var e=a.props,t=e.user,r=e.files;return!(!t||!r||0===r.length)&&(t.is_cdm_member&&r[0].ns_id===t.root_ns_id&&2===r[0].ns_path.split("/").length)},a.getContents=function(){var e=a.props,t=e.user,s=e.files;if(!t||!s||0===s.length)return"";var i=t.is_cdm_member,n=s[0].target_ns,d=a.props,u=d.parentSharedFolderName,p=d.isNonUserRelativeContext,c=a.isTsdPlusOne(),m=s.filter((function(e){return e.target_ns})).length,h=s[0],_=l.filename(h.fq_path);S.hasValidLinkNode(h.per_node_metadata)&&(_=y.filename_without_extension(_));var g,E={filename:_,shared_folder_name:u,b:function(e){return r.default.createElement("b",{className:"file-modal-file-name"},e)},item_count:s.length,team_name:a.getViewerTeamNameStr()};return"string"==typeof(g=null!=a.props.parentSharedFolderName?1===s.length?c?o.defineMessage({id:"seo+5+",defaultMessage:"Are you sure you want to delete <b>{filename}</b> from your {team_name}workspace?"}):o.defineMessage({id:"hPUy4L",defaultMessage:"Are you sure you want to delete <b>{filename}</b> from the shared folder ‘{shared_folder_name}’?"}):c?o.defineMessage({id:"FvpWE9",defaultMessage:"Are you sure you want to delete {item_count} items from your {team_name}workspace?"}):o.defineMessage({id:"wfz3PO",defaultMessage:"Are you sure you want to delete {item_count} items from the shared folder ‘{shared_folder_name}’?"}):1===s.length&&n&&!p?i?o.defineMessage({id:"TMiu4a",defaultMessage:"Are you sure you want to remove the shared folder <b>{filename}</b> from your team member folder? This folder will stay shared with any existing members. You can re-add it later."}):o.defineMessage({id:"+ZZzd+",defaultMessage:"Are you sure you want to remove the shared folder <b>{filename}</b> from your Dropbox? This folder will stay shared with any existing members. You can re-add it later."}):1===s.length?i?o.defineMessage({id:"Kya0G1",defaultMessage:"Are you sure you want to delete <b>{filename}</b> from your team member folder?"}):o.defineMessage({id:"tERyMx",defaultMessage:"Are you sure you want to delete <b>{filename}</b> from your Dropbox?"}):m>0?i?f.intl.formatMessage({id:"LD9R8s",defaultMessage:"{count, plural, one{Are you sure you want to delete {item_count} items, including {count} shared folder, from your team member folder?} other{Are you sure you want to delete {item_count} items, including {count} shared folders, from your team member folder?}}"},{count:m,item_count:s.length}):f.intl.formatMessage({id:"IWC7/Z",defaultMessage:"{count, plural, one{Are you sure you want to delete {item_count} items, including {count} shared folder, from your Dropbox?} other{Are you sure you want to delete {item_count} items, including {count} shared folders, from your Dropbox?}}"},{count:m,item_count:s.length}):i?o.defineMessage({id:"ByIkrE",defaultMessage:"Are you sure you want to delete {item_count} items from your team member folder?"}):o.defineMessage({id:"Yv1kAy",defaultMessage:"Are you sure you want to delete {item_count} items from your Dropbox?"}))?g:f.intl.formatMessage(g,E)},a.state={isModalOpen:!0},a}return a.__extends(t,e),t.prototype.render=function(){var e=this.getTitle();return r.default.createElement(i.UtilityModal,{title:e,ariaLabel:e,primaryAction:this.isRemovingSharedFolder()&&!this.props.isNonUserRelativeContext?f.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"}):f.intl.formatMessage({id:"9v2+SN",defaultMessage:"Delete"}),secondaryAction:f.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),onPrimaryAction:this.handleAccept,shouldRequestCloseOnActions:!0,displayCloseButton:!0,overlayClickClose:!0,onRequestClose:this.handleCancel,open:this.state.isModalOpen,onReady:this.onModalReady,shouldFocusAfterRender:!0},r.default.createElement("div",{className:"uxa-modal",id:"delete-file-modal"},this.getContents()))},t.defaultProps={parentSharedFolderName:null,isNonUserRelativeContext:!1},t})(r.default.Component);t.DeleteFileModalWithoutCss=A;var M=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAccept=function(){var e=t.props.files[0].fq_path;T({containingFolder:l.parent_dir(e),filenameToSelect:l.filename(e)})},t}return a.__extends(t,e),t.prototype.getModalMessage=function(){return"archive"===this.props.type?f.intl.formatMessage({id:"qHf3NV",defaultMessage:"You can archive team folders in the Admin Console."}):"rename"===this.props.type?f.intl.formatMessage({id:"oeAin5",defaultMessage:"You can rename team folders in the Admin Console."}):void 0},t.prototype.render=function(){return r.default.createElement(c.Modal,{ref:"modal",style:"clean",onAccept:this.handleAccept,acceptButtonText:f.intl.formatMessage({id:"KdMLOm",defaultMessage:"Go to Admin Console"}),altAction:r.default.createElement("a",{onClick:function(){return c.Modal.close()}},f.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),width:350,showX:!1,className:"content-manager-bridge-modal"},this.getModalMessage())},t})(r.default.Component);t.ContentManagerBridgeModal=M;var I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptClick=function(){t.props.userIsSuperAdmin&&t.props.userIsSameTeam&&T({containingFolder:t.props.folderPath})},t}return a.__extends(t,e),t.prototype.render=function(){var e,t=this.props.userIsSuperAdmin&&this.props.userIsSameTeam;e=t?o.defineMessage({id:"KFeJDh",defaultMessage:"Access to “{folder_name}” is restricted, but you can access it in the admin console."}):this.props.userIsSameTeam?o.defineMessage({id:"TOKC1D",defaultMessage:"Access to “{folder_name}” is restricted."}):o.defineMessage({id:"8589qi",defaultMessage:"You don’t have permission to open the folder “{folder_name}”."});var a=t?f.intl.formatMessage({id:"n8SIeG",defaultMessage:"View this folder in the admin console"}):f.intl.formatMessage({id:"SSMhOU",defaultMessage:"Can’t open this folder"});return r.default.createElement(i.UtilityModal,{ariaLabel:a,title:a,overlayClickClose:!0,primaryAction:t?f.intl.formatMessage({id:"SrWnn5",defaultMessage:"View in admin console"}):f.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),secondaryAction:t?f.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}):"",onPrimaryAction:this.handleAcceptClick,open:!0,onRequestClose:function(){return c.Modal.close()}},r.default.createElement("div",null,f.intl.formatMessage(e,{folder_name:n.Emstring.em_snippet(this.props.folderName,m.SNIPPET_SIZES.FILENAME)})))},t})(r.default.Component);t.NoAccessFolderModal=I;var U=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptAndCloseModal=function(){t.props.onAccept(),c.Modal.close()},t}return a.__extends(t,e),t.prototype.render=function(){var e=f.intl.formatMessage({id:"5VCkuI",defaultMessage:"If you make this move, you'll no longer be the owner of some of the folders."});return r.default.createElement(c.Modal,{ref:"modal",style:"default",onAccept:this.handleAcceptAndCloseModal,acceptButtonText:f.intl.formatMessage({id:"ONKdzy",defaultMessage:"Move items anyways"}),dismissButtonText:f.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),title:f.intl.formatMessage({id:"+Km1yK",defaultMessage:"Move items?"})},r.default.createElement("div",null,e))},t})(r.default.Component);t.ConfirmOwnershipTransferModal=U;var R=(function(e){function t(t){var a=e.call(this,t)||this;return a.handleAccept=function(){a.state.fswIndex+1===a.props.fsws.length?(a.getCurrentFSW().blocking?a.props.onAbortAction&&a.props.onAbortAction():a.props.onFinalAccept(),a.setState({isModalOpen:!1})):a.setState({fswIndex:a.state.fswIndex+1})},a.handleCancel=function(){a.props.onAbortAction&&a.props.onAbortAction(),a.setState({isModalOpen:!1})},a.redirectToLearnMoreLink=function(){_.open_tab(a.getCurrentFSW().learn_more)},a.cancelButtonCreator=function(e){return a.getCurrentFSW().blocking?r.default.createElement("span",null):r.default.createElement(s.Button,{onClick:e,variant:"secondary"},f.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))},a.state={isModalOpen:!0,fswIndex:0},a}return a.__extends(t,e),t.prototype.getCurrentFSW=function(){return this.props.fsws[this.state.fswIndex]},t.prototype.render=function(){if(this.state.fswIndex>this.props.fsws.length)return null;var e=this.getCurrentFSW(),t=e.confirm_text?e.confirm_text:this.props.confirmText;return r.default.createElement(i.UtilityModal,{ariaLabel:e.title,className:"fsw-modal",link:e.learn_more?f.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}):"",onLink:this.redirectToLearnMoreLink,onPrimaryAction:this.handleAccept,onSecondaryAction:this.handleCancel,open:this.state.isModalOpen,overlayClassName:"fsw-modal--overlay",primaryAction:e.blocking?f.intl.formatMessage({id:"1URVg+",defaultMessage:"Okay"}):t,secondaryAction:this.cancelButtonCreator,title:e.title},e.text)},t})(r.default.Component);t.FileSystemWarningsModalWithoutCSS=R,t.FileSystemWarningsModal=p.requireCssWithComponent(R,["/static/css/react/file_modal-vflJkyHFy.css"]),t.DeleteFileModal=p.requireCssWithComponent(A,["/static/css/react/file_modal-vflJkyHFy.css"]);var C=(function(e){function t(t){var a=e.call(this,t)||this;return a.handleClose=function(){a.setState({isModalOpen:!1})},a.handleCancel=function(){null!=a.props.buttonString&&(a.setState({isModalOpen:!1}),a.props.onClick())},a.redirectToLearnMoreLink=function(){_.open_tab(a.props.learnMoreLink)},a.state={isModalOpen:!0},a}return a.__extends(t,e),t.prototype.render=function(){return r.default.createElement(i.UtilityModal,{ariaLabel:this.props.title,className:"move-error-modal",link:f.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),onLink:this.redirectToLearnMoreLink,onPrimaryAction:this.handleClose,onSecondaryAction:this.handleCancel,open:this.state.isModalOpen,primaryAction:f.intl.formatMessage({id:"nOO9Qi",defaultMessage:"OK"}),secondaryAction:this.props.buttonString,title:this.props.title},this.props.content)},t})(r.default.Component);t.MoveErrorModalWithoutCss=C,t.MoveErrorModal=p.requireCssWithComponent(C,["/static/css/react/file_modal-vflJkyHFy.css"])})),define("modules/clean/react/file_uploader/actions",["require","exports","tslib","modules/clean/ajax","modules/clean/analytics","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/file_uploader/action_logger","modules/core/notify","modules/clean/stormcrow/client","modules/clean/react/file_uploader/actions_adapter","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/error_handling","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/sharing/actions/cdm_new_folder_modal_actions","modules/clean/sharing/browse_exports","modules/clean/sharing/multifolder_permissions_at_upload/util","modules/clean/viewer","modules/clean/web_upload_action_events","modules/core/cookies","modules/core/exception","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T,v,b,A,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),s=a.__importStar(s),n=a.__importStar(n),d=a.__importStar(d),_=a.__importDefault(_),t.UploaderDispatcher=i.Dispatcher;var I=["1password","abbu","agilekeychain","aplibrary","app","band","cmproj","dvdproj","fcpbundle","gameproj","graffle","imovielibrary","imovieproject","itlp","key","logic","logicx","lpdf","lrdata","mindnode","mindnode","mpkg","numbers","pages","photolibrary","rcproject","rtfd","screenflow","scriv","sketch","theater","xcodeproj","xd","ydevice","bundle","framework","plugin","kext","pkg"],U=(function(){function e(){var e=this;this.numExpectedFilePathsDuringUploadAttempt=1,this.numFilePathsAddedDuringUploadAttempt=0,this._isStaging=!1,this.isCreatingSharedFolder=!1,this._createHandlers=function(t){var o=t.chooseDestination,n=t.isContentManager,l=t.autoTeamGroupId,u=t.getBrowseContext,p=t.expGrowthActSmbTsaPermUpload,c=t.expGrowthActSmbTsaPermUploadMulti,h=void 0===c?"OFF":c,E=t.expGrowthActSmbTsaPermUploadNested,S=t.useUploadKit,T=t.uploadConsumerInterface,b=t.parallelFileUploads;return{handleFilesAdded:function(t,r){for(var n={},c=0,y=t;c<y.length;c++){n[y[c].dest]=null}e.numFilePathsAddedDuringUploadAttempt+=Object.keys(n).length;var A=S||e.numFilePathsAddedDuringUploadAttempt>=e.numExpectedFilePathsDuringUploadAttempt;A&&(e.numExpectedFilePathsDuringUploadAttempt=1,e.numFilePathsAddedDuringUploadAttempt=0);var U=f.uploaderStore.user();o&&e.setIsUploadModalOpen({isUploadModalOpen:!1});for(var R=[],C=0,D=t;C<D.length;C++){null==(B=D[C]).size&&R.push(B)}for(var O=0,L=R;O<L.length;O++){var F=L[O];i.Dispatcher.dispatch({type:m.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:F,errorType:m.UploadErrorType.EMPTY_OR_FOLDER,errorMessage:M.intl.formatMessage({id:"ed5DT4",defaultMessage:"This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it."})}}),e._broadcastUploadErrored(F);var w=f.uploaderStore.uploadById(F.uploadId);d.logUploadAction({user:U,action:v.WebUploadActionEvent.UPLOAD_FAILURE,upload:w,useUploadKit:S})}t=t.filter((function(e){return null!=e.size}));for(var P=function(e){return I.includes(s.file_extension(e.name))&&e.size%34==0},N=[],x=0,k=t;x<k.length;x++){var B=k[x];P(B)&&N.push(B)}for(var q=0,Q=N;q<Q.length;q++){var V=Q[q];i.Dispatcher.dispatch({type:m.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:V,errorType:m.UploadErrorType.PACKAGE_FILE,errorMessage:M.intl.formatMessage({id:"7J6IUj",defaultMessage:"This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first."})}}),e._broadcastUploadErrored(V);w=f.uploaderStore.uploadById(V.uploadId);d.logUploadAction({user:U,action:v.WebUploadActionEvent.UPLOAD_FAILURE,upload:w,useUploadKit:S})}if(t=t.filter((function(e){return!P(e)})),R.length&&e.cancelUploads({files:R},S&&T||!1,Boolean(b)),N.length&&e.cancelUploads({files:N},S&&T||!1,Boolean(b)),i.Dispatcher.dispatch({type:m.UploaderActionType.QUEUE_UPLOADS,data:{files:t}}),["V1","V2","V3"].includes(h)||p){var H=g.getFileUploadsWithStatus(f.uploaderStore.fileList(),[m.FileStatusType.PENDING,m.FileStatusType.UPLOADING]);if((S&&T?T.isUploading:!_.default.isStoppedOrQueued())||e.isCreatingSharedFolder||e.isStaging()||!H.length||!A)return void(r&&r());e.canSeeMultiFolderPermissionsAtUploadModal(h,null==E?void 0:E.variant)?e.showMultiFolderPermissionsAtUploadModal(S&&T||!1,Boolean(b),r,E):l&&u&&e.canSeeNewFolderViaUploadModal(p,h,null==E?void 0:E.variant)?e.showCdmNewFolderViaUploadModal(l,u,S&&T||!1,Boolean(b),r,E):(e.stormcrowApiClient&&E&&""!==f.uploaderStore.path()&&e.stormcrowApiClient.logExposure(a.__assign({feature:"growth_act_smb_tsa_perm_upload_nested"},E)),e._startNextUploadIfAvailable(b),r&&r())}else e._startNextUploadIfAvailable(b),r&&r()},handleUploadProgress:function(t,a){if(!f.uploaderStore.isUploadCancelled(t.uploadId)){var r=t.percentUploaded,o=b?t:f.uploaderStore.currentUpload();if(null===o)return void(t.uploadId in e.reportedFileUploadExceptions||(A.reportException({err:new Error("UploaderStore.currentUpload() is null"),severity:A.SEVERITY.NONCRITICAL}),e.reportedFileUploadExceptions[t.uploadId]=!0));var s=r*o.size/100+g.calculateSizeOfUploads(f.uploaderStore.fileList(),[m.FileStatusType.COMPLETE]),n=(g.calculateSizeOfUploads(f.uploaderStore.fileList(),[m.FileStatusType.COMPLETE,m.FileStatusType.PENDING,m.FileStatusType.UPLOADING])-s)/(S?e.calcBytesPerSec(s):_.default.bytesPerSec())+f.uploaderStore.fileList().count((function(e){return e.status===m.FileStatusType.PENDING||e.status===m.FileStatusType.UPLOADING}));b?i.Dispatcher.dispatch({type:m.UploaderActionType.SET_UPLOAD_PROGRESS,data:{uploadId:o.uploadId,percentComplete:r,numSecondsLeft:a?n:void 0}}):i.Dispatcher.dispatch({type:m.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:r,numSecondsLeft:a?n:void 0}})}},handleFileUploaded:function(t){if(!f.uploaderStore.isUploadCancelled(t.uploadId)){e.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1});var a=f.uploaderStore.user();i.Dispatcher.dispatch({type:m.UploaderActionType.COMPLETE_UPLOAD,data:{uploadId:t.uploadId,parallelFileUploads:b}}),e._broadcastUploadComplete(t),d.logUploadAction({user:a,action:v.WebUploadActionEvent.UPLOAD_FILE,upload:t}),d.logUploadAction({user:a,action:v.WebUploadActionEvent.UPLOAD_SUCCESS,upload:t,useUploadKit:!0}),e._startNextUploadIfAvailable(b)}},handlePLUFileUploaded:function(t,a){if(!f.uploaderStore.isUploadCancelled(t.uploadId)){e.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1});var r=void 0,o=!1,s=!1,l=!1,u=!1,p=void 0,c=void 0,h=f.uploaderStore.user();try{s=!!(r=JSON.parse(a.response))&&!!r.error,l=!!r&&"ignored"===r.error,u=!!r&&"invalid_extension"===r.error}catch(e){A.reportException({err:e,severity:A.SEVERITY.NONCRITICAL}),o=!0}if(l?(p=m.UploadErrorType.IGNORED,c=M.intl.formatMessage({id:"8uKnLO",defaultMessage:"This file was skipped because it’s an internal system file."})):u?(p=m.UploadErrorType.INVALID_EXTENSION,c=M.intl.formatMessage({id:"YF8NvF",defaultMessage:"This file was skipped because files of this type cannot be uploaded."})):(p=m.UploadErrorType.GENERIC,c=void 0),o||s||l||u){_.default.removeFiles({files:[t]}),i.Dispatcher.dispatch({type:m.UploaderActionType.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:p,errorMessage:c}}),e._broadcastUploadErrored(t);var g=f.uploaderStore.uploadById(t.uploadId);d.logUploadAction({user:h,action:v.WebUploadActionEvent.UPLOAD_FAILURE,upload:g})}else A.assert(!!r,"unable to parse file uploaded response"),A.assert(!!r&&"complete"===r.status,"response status is not complete"),n&&(A.assert(!!r&&r.total_size===t.size,"response total size does not equal file size"),A.assert(!!r&&r.upload_id===t.uploadId,"response body upload ID does not equal the file uploadId")),i.Dispatcher.dispatch({type:m.UploaderActionType.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}}),e._broadcastUploadComplete(t),d.logUploadAction({user:h,action:v.WebUploadActionEvent.UPLOAD_FILE,upload:t}),d.logUploadAction({user:h,action:v.WebUploadActionEvent.UPLOAD_SUCCESS,upload:t});e._startNextUploadIfAvailable(b)}},handleUploadComplete:function(){var t=f.uploaderStore.fileList().valueSeq().filter((function(e){return e.status===m.FileStatusType.COMPLETE})).toArray();i.Dispatcher.dispatch({type:m.UploaderActionType.RESET_TEAM_ACCESS_LEVELS}),e.resetCreatedFolders(),e.resetFoldersWithError(),e.resetUploadStartTime(),e._broadcastAllUploadsComplete(t)},handleError:function(t,a,r){f.uploaderStore.fileList().has(t.uploadId)?(i.Dispatcher.dispatch({type:m.UploaderActionType.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:a,errorMessage:r,parallelFileUploads:b}}),e._broadcastUploadErrored(t)):(i.Dispatcher.dispatch({type:m.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:t,errorType:a,errorMessage:r}}),e._broadcastUploadErrored(t)),a!==m.UploadErrorType.OVER_QUOTA_ERROR&&a!==m.UploadErrorType.LOCKED_TEAM_ERROR||i.Dispatcher.dispatch({type:m.UploaderActionType.SET_HAS_OVERQUOTA_ERROR,data:{hasOverquotaError:!0}}),e._startNextUploadIfAvailable(b)},handleBeforeUpload:function(t,o,s,i,n){var d=M.intl.formatMessage({id:"eIIEty",defaultMessage:"Something went wrong while uploading this file. There was a server error during the upload request."}),u=e.getUploadPath();if(["V1","V3"].includes(h)&&("V1"===(null==E?void 0:E.variant)||""===u)&&l){var c=y.getRootPath(t,u),g=o;o=function(){return a.__awaiter(e,void 0,void 0,(function(){return a.__generator(this,(function(e){switch(e.label){case 0:return[4,this.createSharedFolder(t,l,Boolean(b))];case 1:return e.sent(),_.default.setAjaxParams(t,_.default.uploader.settings.multipart_params),this.addCreatedFolder(c),g(),[2]}}))}))}}if(!f.uploaderStore.confirmedFSWBatchIds().filter((function(e){return t.batchId===e})).length){var S={path:t.dest,to_path:t.name,fsw_request:"check",_subject_uid:t.userId};e.ajaxInterceptor&&(S=e.ajaxInterceptor.interceptUploadPrecheck(S));return r.SilentBackgroundRequest({url:"/cmd/upload_precheck",data:S,success:function(a){e.handleUploadPrecheckSuccess(a,t,o,d,l,p,h,null==E?void 0:E.variant,s,n,i,b)},error:function(a){e.manuallySetInErrorState({file:t,errorType:m.UploadErrorType.UPLOAD_PRECHECK_ERROR,errorMessage:d,extra:{type:"ajax-error",errorCode:a.status.toString(),errorText:a.responseText,requestId:a.getResponseHeader("x-dropbox-request-id")||""}},Boolean(b),s)}})}o()}}},this.reportedFileUploadExceptions={},this.resetCreatedFolders(),this.resetFoldersWithError()}return Object.defineProperty(e.prototype,"stormcrowApiClient",{get:function(){var e=f.uploaderStore.user();return e?new p.StormcrowApiClient({userId:e.id}):void 0},enumerable:!0,configurable:!0}),e.prototype.initPLU=function(e){var t=this,r=e.chooseDestination,o=void 0!==r&&r,n=e.isContentManager,l=void 0!==n&&n,u=e.rootNSIDForCM,p=e.autoTeamGroupId,E=e.getBrowseContext,S=e.expGrowthActSmbTsaPermUpload,y=void 0!==S&&S,T=e.expGrowthActSmbTsaPermUploadMulti,b=void 0===T?"OFF":T,A=e.expGrowthActSmbTsaPermUploadNested,M=e.handleClickNewFolder,I=e.useUploadKit,U=e.uploadConsumerInterface,R=e.parallelFileUploads;if(!_.default.isInitialized){_.default.init(l);var C=o?function(e,a){t.setPath({path:e}),void 0!==a&&t.setFolderNsId({folderNsId:a})}:void 0,D=this._createHandlers({chooseDestination:o,autoTeamGroupId:p,getBrowseContext:E,expGrowthActSmbTsaPermUpload:y,expGrowthActSmbTsaPermUploadMulti:b,expGrowthActSmbTsaPermUploadNested:A,useUploadKit:I,uploadConsumerInterface:U,parallelFileUploads:R}),O=D.handleFilesAdded,L=D.handleUploadProgress,F=D.handleFileUploaded,w=D.handlePLUFileUploaded,P=D.handleUploadComplete,N=D.handleError,x=D.handleBeforeUpload;I?(c.ActionsAdapter.on("beforeUpload",(function(e){var r=e.uploadItems,o=e.beforeUploadComplete;return a.__awaiter(t,void 0,void 0,(function(){var e,t,s;return a.__generator(this,(function(a){switch(a.label){case 0:e=function(e){return new Promise((function(t){x(c.convertUploadItem(e),(function(){return t({uploadCanceled:!1})}),!0,U,(function(){return t({uploadCanceled:!0})}))}))},t=[],s=0,a.label=1;case 1:return s<r.length?[4,e(r[s])]:[3,3];case 2:return a.sent().uploadCanceled?(i.Dispatcher.dispatch({type:m.UploaderActionType.CANCEL_UPLOADS,data:{files:r.slice(s).map((function(e){return c.convertUploadItem(e)}))}}),s=r.length):(t.push(r[s]),s++),[3,1];case 3:return o({items:t,errors:[]}),[2]}}))}))})),c.ActionsAdapter.on("filesAdded",(function(e){var r=e.uploadItems,o=e.allUploadItems,i=e.filesAddedComplete;return a.__awaiter(t,void 0,void 0,(function(){var e,t,n;return a.__generator(this,(function(a){switch(a.label){case 0:return[4,new Promise((function(e){O(r.map((function(e){return c.convertUploadItem(e)})),e)}))];case 1:return a.sent(),e=g.getFileUploadsWithStatus(f.uploaderStore.fileList(),[m.FileStatusType.PENDING,m.FileStatusType.UPLOADING]),t=e.map((function(e){return e.dest+"/"+e.name})),n=o.filter((function(e){return t.includes(s.normalize(e.parentPath)+"/"+e.destPath)})),i(n),[2]}}))}))})),c.ActionsAdapter.on("fileUploaded",(function(e){var t=e.uploadItem;F(c.convertUploadItem(t))})),c.ActionsAdapter.on("uploadProgress",(function(e){var t=e.uploadItem;L(c.convertUploadItem(t),!0)})),c.ActionsAdapter.on("error",(function(e){var t=e.uploadItem,a=e.errorType,r=e.user,o=e.loggingOnly;if(h.reportUploadException(a,s.filename(t.destPath),t.bytes),d.logUploadAction({user:r,action:v.WebUploadActionEvent.UPLOAD_FAILURE,upload:c.convertUploadItem(t),errorType:a,useUploadKit:!0}),!o){var i=c.convertUploadItem(t),n=h.getErrorMessage(a);N(i,a,n)}})),c.ActionsAdapter.on("uploadComplete",(function(){P()}))):(_.default.init(l),_.default.onBeforeFilesAdded(),_.default.onFilesAdded({isContentManager:l,rootNSIDForCM:u,setPathAndFolderNsId:C,resetFolderNsId:function(){t.setFolderNsId({folderNsId:null})},handleClickNewFolder:M,cb:O}),_.default.onUploadProgress(L),_.default.onFileUploaded(w),_.default.onUploadComplete(P),_.default.onError(N),_.default.onBeforeUpload(x))}},e.prototype.canSeeNewFolderViaUploadModal=function(e,t,a){void 0===e&&(e=!1),void 0===t&&(t="OFF"),void 0===a&&(a="OFF");var r=f.uploaderStore.user(),o=f.uploaderStore.fileList(),s=this.getUploadPath(),i=g.uploadContainsFolder(o,s),n=g.isMultifolderUpload(o,s),l=g.isUploadInTmf(o,r);return(e||["V2","V3"].includes(t))&&("V1"===a||""===s)&&!n&&i&&"work"===r.role&&r.is_cdm_member&&!l},e.prototype.canSeeMultiFolderPermissionsAtUploadModal=function(e,t){void 0===e&&(e="OFF"),void 0===t&&(t="OFF");var a=f.uploaderStore.user(),r=f.uploaderStore.fileList(),o=this.getUploadPath(),s=!g.uploadContainsFolder(r,o),i=g.isMultifolderUpload(r,o),n=g.isUploadInTmf(r,a);return("V1"===e||"V3"===e&&(i||s))&&("V1"===t||""===o)&&"work"===a.role&&a.is_cdm_member&&!n},e.prototype.isStaging=function(){return this._isStaging},e.prototype.resetCreatedFolders=function(){this.createdFolders=[]},e.prototype.resetUploadStartTime=function(){this.uploadStartTime=void 0},e.prototype.addCreatedFolder=function(e){this.createdFolders.includes(e)||this.createdFolders.push(e)},e.prototype.resetFoldersWithError=function(){this.foldersWithError=[]},e.prototype.addFolderWithError=function(e){this.isFolderWithError(e)||this.foldersWithError.push(e)},e.prototype.isFolderWithError=function(e){return this.foldersWithError.includes(e)},e.prototype.showCdmNewFolderViaUploadModal=function(e,t,r,o,i,n){var l=this,d=f.uploaderStore.user();if(d){var u=this.getUploadPath(),p=g.getFileUploadsWithStatus(f.uploaderStore.fileList(),[m.FileStatusType.PENDING,m.FileStatusType.UPLOADING])[0],c=p.chooserType,h=t(),_=u.split("/"),E=s.normalize(p.dest).split("/"),y=_.concat(E[_.length]).join("/"),T=function(e){e&&l.manuallySetInErrorState({file:p,errorType:m.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR,errorMessage:e,startNextUploadIfAvailable:!1},o),l._isStaging=!1,l.cancelPendingFileUploads(r,o),l.setIsUploadModalOpen({isUploadModalOpen:!1}),i&&i()},v=function(){l._isStaging=!1,l.setIsUploadModalOpen({isUploadModalOpen:!1}),l._startNextUploadIfAvailable(o),i&&i()};S.asyncShowCdmNewFolderViaUploadModal((function(t){l.handleCreateFolderWithCdmNewFolderViaUploadModal(c,u,d,e,T,v,t)}),h,y,d,(function(){l.handleCancelWithCdmNewFolderViaUploadModal(c,T)}),(function(){l._isStaging=!0,l.stormcrowApiClient&&n&&""!==u&&l.stormcrowApiClient.logExposure(a.__assign({feature:"growth_act_smb_tsa_perm_upload_nested"},n)),l.handleCdmNewFolderViaUploadModalShow(c)}))}},e.prototype.showMultiFolderPermissionsAtUploadModal=function(e,t,r,s){var n=this;if(!f.uploaderStore.isPermissionsAtUploadModalOpen()){var l=this.getUploadPath(),d=T.Viewer.get_viewer(),u=l?m.TeamAccessLevel.INHERIT:m.TeamAccessLevel.WRITER;i.Dispatcher.dispatch({type:m.UploaderActionType.ADD_TEAM_ACCESS_LEVEL,data:{path:l,accessLevel:u}}),S.asyncShowMultiFolderPermissionsAtUploadModal({cancelUploads:function(a){n.cancelUploads({files:a},e,t)},onCancel:function(){n.cancelPendingFileUploads(e,t),r&&r()},onClose:function(){n.setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:!1})},onShow:function(e){e.length&&(o.TeamsWebActionsLogger.log("upload_choose_audience_impression_multi",{batch_id:e[0].batchId}),n.stormcrowApiClient&&s&&""!==l&&n.stormcrowApiClient.logExposure(a.__assign({feature:"growth_act_smb_tsa_perm_upload_nested"},s)))},onSuccess:function(){n._startNextUploadIfAvailable(t),r&&r()},teamName:d.team_name,uploadPath:l}).catch((function(){n.setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:!1}),r&&r()})),this.setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:!0})}},e.prototype.getUploadPath=function(){return s.normalize(f.uploaderStore.path())},e.prototype.getTeamAccessLevel=function(e){var t=y.getFilePath(e);return f.uploaderStore.getTeamAccessLevel(t)},e.prototype.createSharedFolder=function(e,t,r){return a.__awaiter(this,void 0,void 0,(function(){var o,s,i,n,l;return a.__generator(this,(function(a){switch(a.label){case 0:if(!(o=f.uploaderStore.user()))return[2];s=this.getTeamAccessLevel(e),i=this.getUploadPath(),a.label=1;case 1:return a.trys.push([1,3,,4]),this.isCreatingSharedFolder=!0,[4,y.createSharedFolder({user:o,uploadPath:i,file:e,teamAccessLevel:s,createdFolders:this.createdFolders,foldersWithError:this.foldersWithError,autoTeamGroupId:t})];case 2:return a.sent(),[3,4];case 3:return a.sent(),n=M.intl.formatMessage({id:"eIIEty",defaultMessage:"Something went wrong while uploading this file. There was a server error during the upload request."}),this.manuallySetInErrorState({file:e,errorType:m.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR,errorMessage:n},r),l=y.getRootPath(e,i),this.addFolderWithError(l),[3,4];case 4:return this.isCreatingSharedFolder=!1,[2]}}))}))},e.prototype.handleUploadPrecheckSuccess=function(e,t,r,s,d,u,p,c,h,_,E,S){var y,T=this,v=!1,b=!1;try{v=!(!(y=JSON.parse(e))||!y.failure_details),b=!(!y||!y.error||"invalid_character"!==y.error)}catch(a){return A.reportException({err:a,tags:["web_upload"],severity:"non-critical"}),void this.manuallySetInErrorState({file:t,errorType:m.UploadErrorType.UPLOAD_PRECHECK_ERROR,errorMessage:s,extra:{type:"json-parse",errorText:a.toString(),fswData:e}},Boolean(S),h)}if(b){var I=M.intl.formatMessage({id:"lTIn1A",defaultMessage:"Something went wrong while uploading this file. The filename contains an invalid character."});this.manuallySetInErrorState({file:t,errorType:m.UploadErrorType.UPLOAD_PRECHECK_INVALID_CHAR_ERROR,errorMessage:I},Boolean(S),h)}else if(v){var U=this.canSeeMultiFolderPermissionsAtUploadModal(p,c),R=this.canSeeNewFolderViaUploadModal(u,p,c),C=y.failure_details.filter((function(e){return(!U||"action_missing_parent"!==e.id||!f.uploaderStore.getTeamAccessLevelsDefinition().hasDefinitions())&&((!R&&!U||"action_commit_to_tsd_root"!==e.id)&&!f.uploaderStore.confirmedFSWs().includes(e.id))}));if(0===C.length)return void r();var D=C.map((function(e){return e.id}));l.logFileUploadFSWReturned({uid:t.userId,file_name:t.name,upload_id:t.uploadId,filtered_fsw_ids:D.join(","),all_fsw_ids:y.failure_details.map((function(e){return e.id})).join(",")});var O=function(){h?_&&_():T.cancelPendingFileUploads(h&&E||!1,Boolean(S))},L=function(){r(),i.Dispatcher.dispatch({type:m.UploaderActionType.CONFIRM_FSW,data:{fswIds:C.map((function(e){return e.id})),batchId:t.batchId}})};o.TeamsWebActionsLogger.log("upload_warning_impression",a.__assign({file_type:t.chooserType},g.getFSWMetadataToLog(D)));n.showFileSystemWarningsModal({confirmText:M.intl.formatMessage({id:"i98Ff5",defaultMessage:"Upload"}),fsws:C,onFinalAccept:function(){T.handleFileSystemWarningsModalFinalAccept(t.chooserType,L)},onAbortAction:function(){T.handleFileSystemWarningsModalAbortAction(t.chooserType,O)}})}else i.Dispatcher.dispatch({type:m.UploaderActionType.CONFIRM_FSW,data:{fswIds:[],batchId:t.batchId}}),r()},e.prototype.handleFileSystemWarningsModalFinalAccept=function(e,t){o.TeamsWebActionsLogger.log("upload_warning_clk_confirm",{file_type:e}),t()},e.prototype.handleFileSystemWarningsModalAbortAction=function(e,t){o.TeamsWebActionsLogger.log("upload_warning_clk_cancel",{file_type:e}),t()},e.prototype.handleCreateFolderWithCdmNewFolderViaUploadModal=function(e,t,a,r,s,i,n){var l=this,d=n.folderName,p=n.isConfidential,c=n.autoTeamGroupAccessLevel;if(o.TeamsWebActionsLogger.log("upload_choose_audience_click",{file_type:e,audience:p?"individuals":"team"}),p){var m=function(){l.handleShareViaUploadModalShow(e)};document.addEventListener("modalOpened",m),S.asyncShowNewFolderShareModal(a,null,t,d,!0,this.isContentManager,null,void 0,void 0,i,(function(t,a){l.handleShareViaUploadShareButtonClick(e,t,a)}),!0,!0,(function(){l.handleShareViaUploadModalCancel(e,s)}),(function(){l.handleShareViaUploadModalClose(e,m)}),(function(e){e&&u.Notify.error(e)}),M.intl.formatMessage({id:"i98Ff5",defaultMessage:"Upload"}))}else this.setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:!1}),c&&E.createTSDPlus1NsfFolder({user:a,pathName:t,folderName:d,autoTeamGroupAccessLevel:c,autoTeamGroupId:r,onPending:function(){},onComplete:i,onCancel:s})},e.prototype.handleShareViaUploadModalShow=function(e){o.TeamsWebActionsLogger.log("add_member_permission_impression",{file_type:e})},e.prototype.handleShareViaUploadShareButtonClick=function(e,t,a){o.TeamsWebActionsLogger.log("add_member_permission_upload",{file_type:e,num_invites:t.length,permission_level:a})},e.prototype.handleShareViaUploadModalClose=function(e,t){document.removeEventListener("modalOpened",t),this.setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:!1})},e.prototype.handleShareViaUploadModalCancel=function(e,t){o.TeamsWebActionsLogger.log("add_member_permission_cancel",{file_type:e}),t()},e.prototype.handleCancelWithCdmNewFolderViaUploadModal=function(e,t){o.TeamsWebActionsLogger.log("upload_choose_audience_cancel",{file_type:e}),this.setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:!1}),t()},e.prototype.handleCdmNewFolderViaUploadModalShow=function(e){o.TeamsWebActionsLogger.log("upload_choose_audience_impression",{file_type:e}),this.setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:!0})},e.prototype.setPath=function(e){var t=e.path,a=e.hasPermissionToUploadToFolder,r=void 0===a||a,o=e.isMovingIntoVault,s=void 0!==o&&o;t===f.uploaderStore.path()&&r===f.uploaderStore.hasPermissionToUploadToFolder()&&s===f.uploaderStore.isMovingIntoVault()||i.Dispatcher.dispatch({type:m.UploaderActionType.SET_PATH,data:{path:t,hasPermissionToUploadToFolder:r,isMovingIntoVault:s}})},e.prototype.setFolderNsId=function(e){var t=e.folderNsId;i.Dispatcher.dispatch({type:m.UploaderActionType.SET_FOLDER_NS_ID,data:{folderNsId:t}})},e.prototype.setUser=function(e){var t=e.user;i.Dispatcher.dispatch({type:m.UploaderActionType.SET_USER,data:{user:t}})},e.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,a=e.isInternalTransfer,r=void 0!==a&&a;i.Dispatcher.dispatch({type:m.UploaderActionType.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:t,isInternalTransfer:r}})},e.prototype.addFilesToPLU=function(e){var t=e.files,a=e.path,r=e.dropTarget,o=e.numPathsInUploadAttempt;this.numExpectedFilePathsDuringUploadAttempt=o||1,_.default.addFiles({files:t,path:a}),this._broadcastUploadBegin(t,r),this.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1})},e.prototype.addDirectoriesToPLU=function(e){for(var t=e.directoryEntries,a=e.batchId,r=e.chooserType,o=e.onFinish,n=[],l=[],u=0,p=function(e){if(u+=1,e&&e.createReader){var t=e.createReader(),s=function(){return t.readEntries((function(t){if(t.length>0){for(var i=0,d=t;i<d.length;i++){var c=d[i];c.isDirectory?p(c):n.push({entry:c,dest:e.fullPath||""})}s()}else 0===(u-=1)&&(m=function(){if(n.length>0){var e=n.pop();if(e){var t=e.entry,s=e.dest;if(t&&t.file)return t.file((function(e){var t=e;t.batchId=a,t.chooserType=r,l.push({entry:t,dest:s}),m()}))}}else o(l)})();var m}))};s()}},c=0,h=t;c<h.length;c++){var _=h[c];if(I.includes(s.file_extension(_.name))){var g=new m.FileUpload({name:_.name,dest:_.fullPath});i.Dispatcher.dispatch({type:m.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:g,errorType:m.UploadErrorType.PACKAGE_FILE,errorMessage:M.intl.formatMessage({id:"O7/lCv",defaultMessage:"Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the “Upload…“ dialog."})}}),this._broadcastUploadErrored(g);var E=f.uploaderStore.uploadById(g.uploadId);d.logUploadAction({user:f.uploaderStore.user(),action:v.WebUploadActionEvent.UPLOAD_FAILURE,upload:E})}else p(_)}},e.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;i.Dispatcher.dispatch({type:m.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},e.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;i.Dispatcher.dispatch({type:m.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED,data:{inlineStatusShouldBeDismissed:t}})},e.prototype.setIsPermissionsAtUploadModalOpen=function(e){var t=e.isPermissionsAtUploadModalOpen;i.Dispatcher.dispatch({type:m.UploaderActionType.SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN,data:{isPermissionsAtUploadModalOpen:t}})},e.prototype.setAjaxInterceptor=function(e){this.ajaxInterceptor=e,_.default.setAjaxInterceptor(e)},e.prototype.setIsContentManager=function(e){void 0===e&&(e=!1),this.isContentManager=e},e.prototype.cancelUploads=function(e,t,r){var o=this,s=e.files;t&&t.uploadItems.length?s.forEach((function(e){var r=e.name;return a.__awaiter(o,void 0,void 0,(function(){return a.__generator(this,(function(e){switch(e.label){case 0:return[4,t.cancelUploadItem(r)];case 1:return e.sent(),t.removeUploadItem(r),[2]}}))}))})):t||_.default.removeFiles({files:s}),i.Dispatcher.dispatch({type:m.UploaderActionType.CANCEL_UPLOADS,data:{files:s}}),!t&&_.default.isStoppedOrQueued()||this._startNextUploadIfAvailable(r)},e.prototype.manuallySetInErrorState=function(e,t,a){var r=e.file,o=e.errorType,s=e.errorMessage,n=e.extra,l=e.startNextUploadIfAvailable,u=void 0===l||l;_.default.removeFiles({files:[r]}),i.Dispatcher.dispatch({type:m.UploaderActionType.UPLOAD_ERROR,data:{uploadId:r.uploadId,errorType:o,errorMessage:s}});var p=f.uploaderStore.uploadById(r.uploadId);d.logUploadAction({user:f.uploaderStore.user(),action:v.WebUploadActionEvent.UPLOAD_FAILURE,upload:p,errorType:o,extra:n,useUploadKit:a}),this.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1}),u&&this._startNextUploadIfAvailable(t),this._broadcastUploadErrored(r)},e.prototype._startUpload=function(e){var t,a,r=e.file,o=e.parallelFileUploads;return i.Dispatcher.dispatch({type:m.UploaderActionType.START_UPLOAD,data:{file:r,parallelFileUploads:o}}),t=["url","webloc","website"].includes(s.file_extension(r.name))?0:1,a=this.isContentManager?{dest:r.dest,reported_total_size:r.size,upload_id:r.uploadId,_subject_uid:r.userId,offset:0,ns_id_for_routing:r.ns_id,overwrite:t,t:b.Cookies.read("__Host-js_csrf")}:{_subject_uid:r.userId,t:b.Cookies.read("__Host-js_csrf"),dest:r.dest,overwrite:t,reported_total_size:r.size,ns_id_for_routing:r.ns_id},_.default.setAjaxParams(r,a),_.default.start(),!0},e.prototype.cancelPendingFileUploads=function(e,t){var a=g.getFileUploadsWithStatus(f.uploaderStore.fileList(),[m.FileStatusType.PENDING,m.FileStatusType.UPLOADING]);this.cancelUploads({files:a},e,t),i.Dispatcher.dispatch({type:m.UploaderActionType.RESET_TEAM_ACCESS_LEVELS})},e.prototype._startNextUploadIfAvailable=function(e){void 0===e&&(e=!1);var t=f.uploaderStore.nextUpload();null==t||null!=f.uploaderStore.currentUpload()&&!e||(A.assert(t instanceof m.FileUpload,"the nextUpload is not of type FileUpload"),this._startUpload({file:t,parallelFileUploads:e}))},e.prototype._doBroadcast=function(e,t){if("function"==typeof CustomEvent)window.dispatchEvent(new CustomEvent(e,t));else{var a=document.createEvent("CustomEvent");a.initCustomEvent(e,!0,!0,t?t.detail:void 0),document.dispatchEvent(a)}},e.prototype._broadcastUploadBegin=function(e,t){if(e.length){var a={detail:{files:e.map((function(e){return{name:e.name,path:f.uploaderStore.path()}})),target:t}};this._doBroadcast(m.UPLOAD_BEGIN_EVENT,a)}},e.prototype._broadcastUploadErrored=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(m.UPLOAD_ERROR_EVENT,t)},e.prototype._broadcastUploadComplete=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(m.UPLOAD_COMPLETE_EVENT,t)},e.prototype._broadcastAllUploadsComplete=function(e){if(e.length){var t={detail:{files:e.map((function(e){return{path:e.dest,name:e.name}}))}};this._doBroadcast(m.ALL_UPLOADS_COMPLETE_EVENT,t),i.Dispatcher.dispatch({type:m.UploaderActionType.ALL_UPLOADS_COMPLETE,data:{}})}},e.prototype.calcBytesPerSec=function(e){var t=Date.now();this.uploadStartTime||(this.uploadStartTime=t);var a=t-this.uploadStartTime;return Math.ceil(e/((a||1)/1e3))},e})();t.UploaderActions=new U})),define("modules/clean/react/file_uploader/error_handling",["require","exports","modules/clean/react/file_uploader/constants","modules/constants/trademark","modules/core/exception","modules/core/i18n"],(function(e,t,a,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorMessage=function(e){switch(e){case a.UploadErrorType.OVER_QUOTA_ERROR:return s.intl.formatMessage({id:"fnG2Ew",defaultMessage:"This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page."});case a.UploadErrorType.LOCKED_TEAM_ERROR:return s.intl.formatMessage({id:"tQ1bJN",defaultMessage:"Can’t upload. Your team no longer has full use of {trademark_business} features."},{trademark_business:r.TRADEMARK_BUSINESS});case a.UploadErrorType.FILE_SIZE_ERROR:return s.intl.formatMessage({id:"4SqdmQ",defaultMessage:"This file is too large to upload using the Dropbox website. Please use the desktop client."});case a.UploadErrorType.HTTP_ERROR:return s.intl.formatMessage({id:"eIIEty",defaultMessage:"Something went wrong while uploading this file. There was a server error during the upload request."});case a.UploadErrorType.CONNECTION_ERROR:return s.intl.formatMessage({id:"Lp9J2f",defaultMessage:"Something went wrong while uploading this file. Check your connection to the internet and try again."});case a.UploadErrorType.FOLDER_SAFARI:return s.intl.formatMessage({id:"CeMx7Q",defaultMessage:"Can’t upload folders in Safari. Upload the files separately or try another browser."});case a.UploadErrorType.BLOCKS_MISSING_ERROR:case a.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case a.UploadErrorType.BLOCK_INDEX_ERROR:case a.UploadErrorType.BLOCK_EMPTY_ERROR:case a.UploadErrorType.BLOB_EMPTY_ERROR:case a.UploadErrorType.BLOB_MISSING_ERROR:case a.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case a.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:return s.intl.formatMessage({id:"RVsdJD",defaultMessage:"Something went wrong while uploading this file."});case a.UploadErrorType.COMMIT_HTTP_ERROR:case a.UploadErrorType.UPLOAD_BLOCK_ERROR:case a.UploadErrorType.SERVER_RESPONSE_ERROR:case a.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR:case a.UploadErrorType.SERVER_TOKENS_MISSING_ERROR:case a.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case a.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case a.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case a.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case a.UploadErrorType.HASHES_NOT_EQUAL_ERROR:return s.intl.formatMessage({id:"eIIEty",defaultMessage:"Something went wrong while uploading this file. There was a server error during the upload request."});default:return s.intl.formatMessage({id:"RVsdJD",defaultMessage:"Something went wrong while uploading this file."})}},t.reportUploadException=function(e,t,r){switch(e){case a.UploadErrorType.BLOCKS_MISSING_ERROR:o.reportException({err:new Error("Blocks missing from web upload."),tags:["web_upload","blocks_missing"],severity:o.SEVERITY.CRITICAL,exc_extra:{filename:t,size:r}});break;case a.UploadErrorType.UPLOAD_BLOCK_ERROR:o.reportException({err:new Error("Server error encountered when trying to upload a block."),tags:["web_upload","upload_block_error"],severity:o.SEVERITY.CRITICAL,exc_extra:{filename:t,size:r}});break;case a.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:o.reportException({err:new Error("Chunks not enabled."),tags:["web_upload","chunks_not_enabled_error"],severity:o.SEVERITY.CRITICAL,exc_extra:{filename:t,size:r}});break;case a.UploadErrorType.SERVER_RESPONSE_ERROR:o.reportException({err:new Error("Server response error."),tags:["web_upload","server_response_error"],severity:o.SEVERITY.CRITICAL,exc_extra:{filename:t,size:r}});break;case a.UploadErrorType.HASHES_NOT_EQUAL_ERROR:o.reportException({err:new Error("Client and server hashes are not equal."),tags:["web_upload","hashes_not_equal"],severity:o.SEVERITY.CRITICAL,exc_extra:{filename:t,size:r}});break;case a.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:o.reportException({err:new Error("Client hash digest error."),tags:["web_upload","client_hash_digest_error"],severity:o.SEVERITY.CRITICAL,exc_extra:{filename:t,size:r}});break;case a.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:o.reportException({err:new Error("File reader null result error."),tags:["web_upload","file_reader_null_result_error"],severity:o.SEVERITY.USER_ERROR,exc_extra:{filename:t,size:r}});break;case a.UploadErrorType.COMMIT_READINESS_ERROR:o.reportException({err:new Error("Commit readiness error."),tags:["web_upload","commit_readiness_error"],severity:o.SEVERITY.CRITICAL,exc_extra:{filename:t,size:r}})}}})),define("modules/clean/react/file_uploader/mapper",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(){function e(){this.fileIdMap={}}return e.prototype.uploadIdOf=function(e){return this.fileIdMap[e]||null},e.prototype.set=function(e,t){this.fileIdMap[e]=t},e})();t.uploaderMapper=new a})),define("modules/clean/react/file_uploader/plu_wrapper",["require","exports","tslib","external/lodash","plupload_dev","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/filepath","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/async_fileops_modals","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/error_handling","modules/clean/react/file_uploader/mapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/types","modules/clean/react/file_uploader/utils","modules/clean/react/folder_dialog/api","modules/clean/react/folder_dialog/async","modules/clean/web_upload_action_events","modules/core/browser_detection","modules/core/cookies","modules/core/exception","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T,v,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),o=a.__importStar(o),n=a.__importStar(n),d=a.__importStar(d),u=a.__importStar(u),E=a.__importStar(E),y=a.__importStar(y);var A=function(e,t){var a=r.assignIn({},t,e);return new p.FileUpload({uploadId:a.uploadId,dest:a.dest,name:a.name,size:a.size,userId:a.userId,percentUploaded:null!=a.percent?a.percent:0,ns_id:a.nsIdForRouting,batchId:a.batchId,chooserType:a.chooserType})},M=new((function(){function e(){var e=this;this.queuedFiles=[],this.setAjaxInterceptor=function(t){e.ajaxInterceptor=t},this.init=this.init.bind(this),this.addFiles=this.addFiles.bind(this),this.start=this.start.bind(this),this.setAjaxParams=this.setAjaxParams.bind(this),this.showFilePicker=this.showFilePicker.bind(this),this.onBeforeFilesAdded=this.onBeforeFilesAdded.bind(this),this.onFilesAdded=this.onFilesAdded.bind(this),this.onUploadProgress=this.onUploadProgress.bind(this),this.onFileUploaded=this.onFileUploaded.bind(this),this.onUploadComplete=this.onUploadComplete.bind(this),this.onError=this.onError.bind(this),this.onBeforeUpload=this.onBeforeUpload.bind(this),this.bytesPerSec=this.bytesPerSec.bind(this),this.removeFiles=this.removeFiles.bind(this),this.isInitialized=!1}return e.prototype.init=function(e){var t=this;if(void 0===e&&(e=!1),!this.isInitialized){this.isInitialized=!0,this.secretFilePickerButton=document.createElement("button"),this.secretFilePickerButton.setAttribute("class","secret-file-uploader-button"),this.secretFilePickerButton.style.display="none",document.body.appendChild(this.secretFilePickerButton),this.secretFolderPickerButton=document.createElement("input"),this.secretFolderPickerButton.setAttribute("type","file"),this.secretFolderPickerButton.setAttribute("webkitdirectory","true"),this.secretFolderPickerButton.style.display="none",this.secretFolderPickerButton.addEventListener("change",(function(e){var a,r=e.target,o=r.files;if(o&&o.length>0){s.TeamsWebActionsLogger.log("upload_folder_pick");for(var i=f.generateBatchId(),l=Object.create(null),d=[],u=0;u<o.length;u++){var p=o.item(u);d.push(p),p.batchId=i,p.chooserType=_.ChooserType.FOLDER;var c=n.parent_dir(null!==(a=p.webkitRelativePath)&&void 0!==a?a:""),m=l[c];m?m.push(p):l[c]=[p]}t.tryAddFiles(d,(function(){for(var e in l){var a=l[e];t.uploader.addFile(a,e)}}))}r.value=""})),document.body.appendChild(this.secretFolderPickerButton),this.pluContainer=document.createElement("div"),this.pluContainer.id="flash-upload-container",this.pluContainer.style.display="none",this.pluContainer.style.position="absolute",this.pluContainer.style.left="-2000",document.body.appendChild(this.pluContainer);var a={url:"https://dl-web.dropbox.com/chunked_upload",waterfall_upload_block_url:"https://dl-web.dropbox.com/put_block_returning_token_unauth",waterfall_commit_upload_url:"https://www.dropbox.com/commit_web_upload_by_token",file_data_name:"file",runtimes:"html5",multipart_params:{},multipart:!1,max_retries:2,browse_button:this.secretFilePickerButton,max_file_size:"50000mb",chunk_size:e?"8mb":"4mb",waterfall_parallel_uploads:!e,container:"flash-upload-container",init:{ChunkUploaded:function(e,a,r){var o=m.uploaderMapper.uploadIdOf(a.id);v.assert(null!=o,"uploadId is null"),v.assert(JSON.parse(r.response).upload_id===o,"uploadId in the response does not match the current uploadId");var s=h.uploaderStore.fileList().get(o);v.assert(null!=s,"fileUpload is null");var i=s,n=i.dest,l=i.size,d=i.userId,u=i.ns_id;return t.setAjaxParams(i,{dest:n,reported_total_size:l,upload_id:o,_subject_uid:d,offset:r.offset,ns_id_for_routing:u,overwrite:1,t:T.Cookies.read("__Host-js_csrf")})}}};v.assert("string"==typeof a.chunk_size&&a.chunk_size in p.ValidChunkSizeStrings,"we only allow a valid chunk size specified as a string"),this.uploader=new o.Uploader(a),this.uploader.init()}},e.prototype.addFiles=function(e){var t=e.files,a=e.path;this.isInitialized||this.init(),this.uploader.addFile(t,a)},e.prototype.start=function(){this.isInitialized||this.init(),this.uploader.start()},e.prototype.setAjaxParams=function(e,t){this.isInitialized||this.init(),this.ajaxInterceptor&&(t=this.ajaxInterceptor.interceptUpload(e,t)),this.uploader.settings.multipart_params=t},e.prototype.showFilePicker=function(){this.isInitialized||this.init(),this.secretFilePickerButton.click()},e.prototype.showFolderPicker=function(){this.isInitialized||this.init(),this.secretFolderPickerButton.click()},e.prototype.getErrorOnStatus507=function(e){var t=p.UploadErrorType.OVER_QUOTA_ERROR;try{"locked_team"===JSON.parse(e.response).error&&(t=p.UploadErrorType.LOCKED_TEAM_ERROR)}catch(e){}return t},e.prototype.getParallelUploadHttpErrorType=function(e){var t=p.UploadErrorType.GENERIC;if(0===e.status)t=y.safari&&0===e.file.loaded&&""===e.file.type&&e.file.size>0?p.UploadErrorType.FOLDER_SAFARI:p.UploadErrorType.CONNECTION_ERROR;else switch(e.code){case o.UPLOAD_BLOCK_ERROR:t=p.UploadErrorType.UPLOAD_BLOCK_ERROR;break;case o.COMMIT_HTTP_ERROR:t=p.UploadErrorType.COMMIT_HTTP_ERROR}return t},e.prototype.onBeforeFilesAdded=function(){var e=this;this.isInitialized||this.init(),this.uploader.bind("BeforeFilesAdded",(function(t,a){return e.tryAddFiles(a,(function(){e.uploader.addFile(a)})),!1}))},e.prototype.onFilesAdded=function(e){var t=this,r=e.isContentManager,o=e.rootNSIDForCM,i=e.setPathAndFolderNsId,p=e.resetFolderNsId,c=e.handleClickNewFolder,y=e.cb;this.isInitialized||this.init(),this.uploader.bind("FilesAdded",(function(e,T){var M=h.uploaderStore.user();v.assert(T&&T.length>=1,"FilesAdded should be called with an array of PluploadFile with at least one entry");var I=!!T[0].batchId,U=T[0].batchId?T[0].batchId:f.generateBatchId();I||s.TeamsWebActionsLogger.log("upload_file_pick");for(var R=0,C=T;R<C.length;R++){var D=C[R];I?v.assert(D.batchId===U,"All entries should have the same batchId"):(v.assert(void 0===D.batchId,"No entries should have their batchId set"),D.batchId=U,D.chooserType=_.ChooserType.FILE)}t.queuedFiles=t.queuedFiles.concat(T);var O=function(){v.assert(null!=h.uploaderStore.user(),"UploaderStore.user() is null");var e=t.queuedFiles;t.queuedFiles=[];var a=e.map((function(t){var a=h.uploaderStore.user(),r=f.generateUploadId(),o=h.uploaderStore.path();t.dest=n.normalize(o)+n.normalize(t.dest),m.uploaderMapper.set(t.id,r),v.assert(!!t.batchId,"At this point, a PluploadFile should have a batchId set");var s={uploadId:r,userId:a.id},i=h.uploaderStore.folderNsId();""===n.normalize(o)?(s.nsIdForRouting=a.root_ns_id,s.nsId=a.root_ns_id):null!==i&&(s.nsIdForRouting=i,s.nsId=i);var l=A(t,s);return u.logUploadAction({user:a,action:S.WebUploadActionEvent.UPLOAD_ATTEMPT,upload:l,chooser_type:l.chooserType,num_files:e.length,uploadPath:o}),l}));null!==h.uploaderStore.folderNsId()&&p&&p(),y(a)},L=function(){t.queuedFiles.forEach((function(t){return e.removeFile(t)})),t.queuedFiles=[]};if(i){var F={user:M,onAccept:i,onSuccess:function(){O(),s.TeamsWebActionsLogger.log("upload_choose_dest_clk_confirm",f.getUploadLocationMetadataToLog(M,h.uploaderStore.path()))},onCancel:function(){L(),s.TeamsWebActionsLogger.log("upload_choose_dest_clk_cancel")}};if(s.TeamsWebActionsLogger.log("upload_choose_dest_impression"),r)d.showAdminUpload(a.__assign(a.__assign({},F),{rootNSID:o,isRootSelectable:!0}));else{var w=function(e){E.showFolderDialog({modalName:l.ModalName.UPLOAD,user:M,title:b.intl.formatMessage({id:"dMKLu2",defaultMessage:"Upload to…"}),primaryActionLabel:b.intl.formatMessage({id:"i98Ff5",defaultMessage:"Upload"}),onSuccess:function(e,t){i(e,t),O(),s.TeamsWebActionsLogger.log("upload_choose_dest_clk_confirm",f.getUploadLocationMetadataToLog(M,h.uploaderStore.path()))},onCancel:L,getFolderContents:e?g.getFolderContents:g.getFolderContentsWithCache,handleClickNewFolder:c?c(w):void 0,initialPath:e})};w()}}else O()}))},e.prototype.onUploadProgress=function(e){this.isInitialized||this.init(),this.uploader.bind("UploadProgress",(function(t,a,r){var o=m.uploaderMapper.uploadIdOf(a.id);v.assert(null!=o,"uploadIs is null");var s=h.uploaderStore.fileList().get(o);v.assert(null!=s,"existingUpload is null"),e(s.set("percentUploaded",a.percent),r)}))},e.prototype.onFileUploaded=function(e){this.isInitialized||this.init(),this.uploader.bind("FileUploaded",(function(t,a,r){var o=m.uploaderMapper.uploadIdOf(a.id);v.assert(null!=o,"uploadIs is null");var s=h.uploaderStore.fileList().get(o);e(s,r)}))},e.prototype.onUploadComplete=function(e){this.isInitialized||this.init(),this.uploader.bind("UploadComplete",(function(t,a){e(a)}))},e.prototype.onError=function(e){var t=this;this.isInitialized||this.init(),this.uploader.bind("Error",(function(a,r){if(null==r.file)throw new Error("PLU error without an associated file.");var s;switch(r.code){case o.FILE_SIZE_ERROR:s=p.UploadErrorType.FILE_SIZE_ERROR;break;case o.BLOCKS_MISSING_ERROR:s=p.UploadErrorType.BLOCKS_MISSING_ERROR,v.reportException({err:new Error("Blocks missing from web upload."),tags:["web_upload","blocks_missing"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.COMMIT_HTTP_ERROR:s=507===r.status?t.getErrorOnStatus507(r):t.getParallelUploadHttpErrorType(r);break;case o.UPLOAD_BLOCK_ERROR:507===r.status?s=t.getErrorOnStatus507(r):(s=t.getParallelUploadHttpErrorType(r))===p.UploadErrorType.UPLOAD_BLOCK_ERROR&&v.reportException({err:new Error("Server error encountered when trying to upload a block."),tags:["web_upload","upload_block_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.CHUNKS_NOT_ENABLED_ERROR:s=p.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR,v.reportException({err:new Error("Chunks not enabled."),tags:["web_upload","chunks_not_enabled_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.SERVER_RESPONSE_ERROR:s=p.UploadErrorType.SERVER_RESPONSE_ERROR,v.reportException({err:new Error("Server response error."),tags:["web_upload","server_response_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case o.SERVER_TOKEN_EMPTY_ERROR:s=p.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR,v.reportException({err:new Error("Server token empty error."),tags:["web_upload","server_token_empty_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case o.SERVER_TOKENS_MISSING_ERROR:s=p.UploadErrorType.SERVER_TOKENS_MISSING_ERROR,v.reportException({err:new Error("Server tokens missing error."),tags:["web_upload","server_tokens_missing_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.SERVER_HASH_RESPONSE_ERROR:s=p.UploadErrorType.SERVER_HASH_RESPONSE_ERROR,v.reportException({err:new Error("Server hash response error."),tags:["web_upload","server_hash_response_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case o.BLOCK_RUNTIME_ID_MISSING_ERROR:s=p.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR,v.reportException({err:new Error("Block runtime id missing."),tags:["web_upload","block_runtime_id_missing"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.CLIENT_HASH_EMPTY_ERROR:s=p.UploadErrorType.CLIENT_HASH_EMPTY_ERROR,v.reportException({err:new Error("Client hash is empty or undefined."),tags:["web_upload","client_hash_empty"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.SERVER_HASH_EMPTY_ERROR:s=p.UploadErrorType.SERVER_HASH_EMPTY_ERROR,v.reportException({err:new Error("Server hash is empty or undefined."),tags:["web_upload","server_hash_empty"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case o.HASHES_NOT_EQUAL_ERROR:s=p.UploadErrorType.HASHES_NOT_EQUAL_ERROR,v.reportException({err:new Error("Client and server hashes are not equal."),tags:["web_upload","hashes_not_equal"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case o.BLOCK_INDEX_ERROR:s=p.UploadErrorType.BLOCK_INDEX_ERROR,v.reportException({err:new Error("Block index error."),tags:["web_upload","block_index_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex}});break;case o.BLOCK_EMPTY_ERROR:s=p.UploadErrorType.BLOCK_EMPTY_ERROR,v.reportException({err:new Error("Empty block error."),tags:["web_upload","block_empty_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex,offset:r.offset}});break;case o.BLOB_MISSING_ERROR:s=p.UploadErrorType.BLOB_MISSING_ERROR,v.reportException({err:new Error("Blob missing error."),tags:["web_upload","blob_missing_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.BLOB_EMPTY_ERROR:s=p.UploadErrorType.BLOB_EMPTY_ERROR,v.reportException({err:new Error("Empty blob error."),tags:["web_upload","blob_empty_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size}});break;case o.CLIENT_HASH_DIGEST_ERROR:s=p.UploadErrorType.CLIENT_HASH_DIGEST_ERROR,v.reportException({err:new Error("Client hash digest error."),tags:["web_upload","client_hash_digest_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex,digestError:r.message}});break;case o.FILE_READER_NULL_RESULT_ERROR:s=p.UploadErrorType.FILE_READER_NULL_RESULT_ERROR;var i=r.domException?r.domException.name:void 0;v.reportException({err:new Error("File reader null result error."),tags:["web_upload","file_reader_null_result_error"],severity:void 0===i?v.SEVERITY.CRITICAL:v.SEVERITY.USER_ERROR,exc_extra:{filename:r.file.name,size:r.file.size,index:r.blockIndex,error_name:i}});break;case o.COMMIT_READINESS_ERROR:s=p.UploadErrorType.COMMIT_READINESS_ERROR,v.reportException({err:new Error("Commit readiness error."),tags:["web_upload","commit_readiness_error"],severity:v.SEVERITY.CRITICAL,exc_extra:{filename:r.file.name,size:r.file.size,reason:r.message}});break;case o.HTTP_ERROR:s=0===r.status?y.safari&&0===r.file.loaded&&""===r.file.type&&r.file.size>0?p.UploadErrorType.FOLDER_SAFARI:p.UploadErrorType.CONNECTION_ERROR:507===r.status?t.getErrorOnStatus507(r):p.UploadErrorType.HTTP_ERROR;break;default:s=p.UploadErrorType.GENERIC}var n,l=c.getErrorMessage(s),d=m.uploaderMapper.uploadIdOf(r.file.id);n=d&&h.uploaderStore.fileList().has(d)?h.uploaderStore.fileList().get(d):A(r.file,{uploadId:f.generateUploadId()});var _=h.uploaderStore.user();n&&u.logUploadAction({user:_,action:S.WebUploadActionEvent.UPLOAD_FAILURE,upload:n,errorType:s}),e(n,s,l)}))},e.prototype.onBeforeUpload=function(e){this.isInitialized||this.init(),this.uploader.bind("BeforeUpload",(function(t,a){var r=m.uploaderMapper.uploadIdOf(a.id);v.assert(null!=r,"uploadId is null");var s=h.uploaderStore.fileList().get(r);return e(s,(function(){a.status=o.UPLOADING,t.trigger("UploadFile",a)})),!1}))},e.prototype.bytesPerSec=function(){return this.isInitialized||this.init(),null!=this.uploader.total?this.uploader.total.bytesPerSec:void 0},e.prototype.removeFiles=function(e){var t=e.files;this.isInitialized||this.init();for(var a=function(e){var t=r.find(o.uploader.files,(function(t){return m.uploaderMapper.uploadIdOf(t.id)===e.uploadId}));o.uploader.removeFile(t)},o=this,s=0,i=t;s<i.length;s++){a(i[s])}this.isStoppedOrQueued()||(this.uploader.stop(),this.uploader.start())},e.prototype.isStoppedOrQueued=function(){return[o.STOPPED,o.QUEUED].includes(this.uploader.state)},e.prototype.tryAddFiles=function(e,t){this.isInitialized||this.init();var a=e.map((function(e){return e.name})).filter((function(e){return i.CLOUD_DOCS_EXTS.includes(n.file_extension(e))}));a?f.showInvalidFileWarning(a,a.length===e.length,!1).then(t):t()},e})());t.default=M})),define("modules/clean/react/file_uploader/uploader_new",["require","exports","tslib","external/lodash","react","modules/clean/ajax","modules/clean/analytics","modules/clean/browse/browse_drag_utils","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/client_download_modal","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/actions_adapter","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader_modal","modules/clean/react/file_uploader/inline_upload_status","modules/clean/react/file_uploader/oq_drag_drop_modal","modules/clean/react/file_uploader/oq_drag_drop_modal_types","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/types","modules/clean/react/file_uploader/utils","modules/clean/react/fileops_actions","modules/clean/react/folder_dialog/async","modules/clean/react/modal","modules/clean/react/snackbar","modules/clean/react/upload_kit/lib/selectors","modules/clean/viewer","modules/clean/web_upload_action_events","modules/clean/web_user_action_events","modules/constants/trademark","modules/core/browser","modules/core/browser_detection","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T,v,b,A,M,I,U,R,C,D,O,L,F,w,P,N,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),o=a.__importDefault(o),s=a.__importStar(s),n=a.__importStar(n),d=a.__importStar(d),p=a.__importStar(p),f=a.__importStar(f),S=a.__importDefault(S),b=a.__importStar(b),A=a.__importStar(A),L=a.__importStar(L),F=a.__importStar(F);var k=null;t.clearSingleton=function(){throw Error("You may only clear the singleton in testing.")};var B=(function(t){function B(s){var l=t.call(this,s)||this;return l._dragEnterCount=0,l._lastEnteredElement=null,l.onNextFileUploadComplete=null,l.listeners=[],l.vaultApiClient=Promise.all([new Promise((function(t,a){e(["modules/clean/react/vault/lib/api"],t,a)})).then(a.__importStar),new Promise((function(t,a){e(["modules/clean/react/vault/logging_types"],t,a)})).then(a.__importStar)]),l.logUploadAttempts=function(e,t,r){return a.__awaiter(l,void 0,void 0,(function(){var o;return a.__generator(this,(function(a){switch(a.label){case 0:o=0,a.label=1;case 1:return o<r?[4,p.logUploadAction({user:y.uploaderStore.user(),action:C.WebUploadActionEvent.UPLOAD_ATTEMPT,chooser_type:e,upload_method:T.UploadMethod.CHOOSER,num_files:r,uploadPath:t,useUploadKit:!0})]:[3,5];case 2:return a.sent(),[4,new Promise(requestAnimationFrame)];case 3:a.sent(),a.label=4;case 4:return o++,[3,1];case 5:return[2]}}))}))},l.chooseFolder=function(){var e=l.props,t=e.useUploadKit,a=e.uploadConsumerInterface,r=y.uploaderStore.path();t&&void 0!==a?a.chooseFolder().then((function(e){var t=e.items,a=e.errors;l.logUploadAttempts(T.ChooserType.FOLDER,r,t.length+a.length)})):S.default.showFolderPicker()},l.chooseFiles=function(){var e=l.props,t=e.useUploadKit,a=e.uploadConsumerInterface,r=y.uploaderStore.path();t&&void 0!==a?a.chooseFiles().then((function(e){var t=e.items,a=e.errors;l.logUploadAttempts(T.ChooserType.FILE,r,t.length+a.length)})):S.default.showFilePicker()},l.cancelUpload=function(e){var t=l.props,a=t.useUploadKit,r=t.uploadConsumerInterface,o=t.parallelFileUploads;c.UploaderActions.cancelUploads({files:[e]},a&&r||!1,Boolean(o))},l.updateInlineStatus=function(){var e=l.state,t=e.currentUpload,a=e.fileList,r=e.hasOverquotaError,o=e.inlineStatusShouldBeDismissed,s=e.isInlineStatusShowing,i=e.isUploadModalOpen,n=e.numSecondsLeft,d=e.isPermissionsAtUploadModalOpen,u=y.uploaderStore.user(),c=l.isSomethingUploading(l.state),m=!i&&(c||!c&&!o&&a.toArray().filter((function(e){return e.status!==h.FileStatusType.CANCELLED})).length>0);m=!(r&&!c)&&m,d&&(m=!1),m?f.showInlineUploadStatusSnackbar({fileList:a,currentUpload:t,onViewDetails:function(){l.showModal(),p.logUploadAction({user:u,action:D.WebUserActionLogEvent.VIEW_DETAILS_CLICK})},numSecondsLeft:n,onShown:function(){l.setState({isInlineStatusShowing:!0})},onClosed:function(){l.setState({isInlineStatusShowing:!1})},parallelFileUploads:!!l.props.parallelFileUploads}):I.Snackbar.manager?r?(I.Snackbar.close("inline-upload-snackbar"),I.Snackbar.manager.showContainer()):i&&I.Snackbar.manager.state.isVisible?I.Snackbar.manager.hideContainer():I.Snackbar.close("inline-upload-snackbar"):s&&I.Snackbar.close("inline-upload-snackbar")},l.onModalDismissed=function(){if(I.Snackbar.manager){var e=l.state,t=e.currentUpload,a=e.fileList,r=e.numSecondsLeft,o=y.uploaderStore.user();f.showInlineUploadStatusSnackbar({fileList:a,currentUpload:t,onViewDetails:function(){l.showModal(),p.logUploadAction({user:o,action:D.WebUserActionLogEvent.VIEW_DETAILS_CLICK})},numSecondsLeft:r,onShown:function(){l.setState({isInlineStatusShowing:!0})},onClosed:function(){l.setState({isInlineStatusShowing:!1})},parallelFileUploads:!!l.props.parallelFileUploads}),I.Snackbar.manager.showContainer()}l.props.onModalDismissed&&l.props.onModalDismissed()},l.handleStoreChanged=function(){l.setState(l.getStateFromStores())},l.handleDragOver=function(e){e.preventDefault(),e.stopPropagation()},l.handleDragEnter=function(e){if(e.preventDefault(),e.stopPropagation(),e.target!==l._lastEnteredElement){l._lastEnteredElement=e.target,l._dragEnterCount++;var t=e.dataTransfer,a=t.mozItemCount,o=0;t.items&&(o=Object.keys(t.items).length);var s=1;a?s=a:o&&(s=o);var i=t.types,n=["Files","application/x-moz-file",F.INTERNAL_FILE_DATA_TRANSFER_TYPE,"text/x-moz-url","text/uri-list","Url"];if(i&&i.indexOf&&r.intersection(i,n).length||i instanceof DOMStringList&&(i.contains("Files")||i.contains("text/x-moz-url")||i.contains(F.INTERNAL_FILE_DATA_TRANSFER_TYPE)||F.msie&&(i.contains("Text")||i.contains("text/plain")))){var d=l.isInternalTransfer(i);c.UploaderActions.setNumDraggingFiles({numDraggingFiles:s,isInternalTransfer:d})}}},l.handleDragLeave=function(e){e.preventDefault(),e.stopPropagation(),l._lastEnteredElement=null,l._dragEnterCount--,l._dragEnterCount<1&&(l._dragEnterCount=0,c.UploaderActions.setNumDraggingFiles({numDraggingFiles:0}))},l.handleUnload=function(e){if(l.isSomethingUploading(l.state)&&l.state.fileList.count()){var t=P.intl.formatMessage({id:"VjdrXm",defaultMessage:"Leaving this page will cancel your uploads."});return e.returnValue=t,t}},l.notifyLockedVault=function(){l.vaultApiClient.then((function(e){var t=e[0].logProductAnalyticsEvent,a=e[1],r=a.AnalyticsEventActionSurface,o=a.AnalyticsEventAction,s=a.AnalyticsEventObject;return t({actionSurface:r.BROWSE,eventAction:o.SELECT,eventObject:s.MOVE_INTO_LOCKED_VAULT})})),N.Notify.error(P.intl.formatMessage({id:"6ASmGo",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}))},l.handleInternalDrop=function(e,t){var a=l.state.user;w.assert(null!=a,"user is null");try{var r=JSON.parse(t),o=r.userId,s=r.fromPath,i=r.filePaths;if(i&&i.length&&s&&o){if(l.props.isContentManager)return;return!l.state.hasPermissionToUploadToFolder&&l.state.isMovingIntoVault?void l.notifyLockedVault():l.state.hasPermissionToUploadToFolder?o!==a.id?void N.Notify.error(P.intl.formatMessage({id:"KZtaJC",defaultMessage:"You can’t move or copy files here from another Dropbox."})):void(e.ctrlKey||e.altKey?b.copyFiles({user:a,files:i.map((function(e){return{fq_path:e}})),newPath:l.state.path,checkFSWs:!0}):s!==l.state.path&&b.moveFiles({user:a,path:s,files:i.map((function(e){return{fq_path:e}})),newPath:l.state.path,checkFSWs:!0})):void N.Notify.error(P.intl.formatMessage({id:"rFwHYL",defaultMessage:"You don’t have permission to add to this folder."}))}}catch(e){return w.reportException({err:e,severity:w.SEVERITY.NONCRITICAL,tags:["web_uploader","drag_and_drop"]}),e}},l.handleDraggedLink=function(e,t,a){var r=n.buildUrlLinkfileContents(t),o=new Blob([r],{type:"text/plain"}),s=x.URI.parse(t).getAuthority();if(s!==L.get_hostname()&&"dl-web.dropbox.com"!==s){for(var i=0,l=["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","previews.dropboxusercontent.com","previews.dropbox.com"];i<l.length;i++){if(s===l[i])return}o.name="#"+s+".url",o.overwrite=!1,o.batchId=a,c.UploaderActions.addFilesToPLU({files:[o],dropTarget:e.target||void 0})}},l.verifyDataTransferItems=function(e,t){var a=(e.dataTransfer||{}).items,r=void 0===a?null:a;if(r&&r.length>0&&!r[0]){var o=t||{},s=o.name,i=void 0===s?void 0:s,n=o.message,l=void 0===n?void 0:n;w.reportException({err:new Error("Drag and drop DateTransfer item unexpectedly undefined"),severity:w.SEVERITY.NONCRITICAL,tags:["web_uploader","drag_and_drop"],exc_extra:{item_index:0,items_length:r.length,had_internal_transfer_error:!!t,internal_transfer_error_name:i,internal_transfer_error_message:l}})}},l.legacyHandleExernalDrop=function(e,t,r){var s=e.dataTransfer||{},n=s.items,l=void 0===n?null:n,d=s.files,u=void 0===d?null:d,m=y.uploaderStore.user(),h=y.uploaderStore.path(),_=T.ChooserType.FILE;if(l&&l.length>0&&l[0]&&l[0].webkitGetAsEntry){for(var f=[],g=0;g<l.length;g++)if(l[g])f.push(l[g].webkitGetAsEntry());else{var E=r||{},b=E.name,A=void 0===b?void 0:b,M=E.message,U=void 0===M?void 0:M;w.reportException({err:new Error("Drag and drop DateTransfer item unexpectedly undefined"),severity:w.SEVERITY.NONCRITICAL,tags:["web_uploader","drag_and_drop"],exc_extra:{item_index:g,items_length:l.length,had_internal_transfer_error:!!r,internal_transfer_error_name:A,internal_transfer_error_message:U}})}for(var R=[],O=[],L=0,N=f;L<N.length;L++){var x=N[L];x&&x.isFile&&R.push(x),x&&x.isDirectory&&(O.push(x),_=T.ChooserType.FOLDER)}R.length>0&&O.length>0&&(_=T.ChooserType.FILE_FOLDER),p.logUploadAction({user:m,action:D.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,chooser_type:_,upload_method:T.UploadMethod.DRAG}),i.TeamsWebActionsLogger.log("drag_and_drop_files",a.__assign({file_type:_},v.getUploadLocationMetadataToLog(m,y.uploaderStore.path())));for(var k=Object.create(null),B=[],q=R.length+(O.length?1:0),Q=function(t){if(O.length>0&&0===t.length)I.Snackbar.show(o.default.createElement(I.Snackbar,{title:P.intl.formatMessage({id:"N5+K9w",defaultMessage:"Can’t upload empty folder."}),variant:"fail",closeButtonText:"Close",id:"upload-error-empty-dir"}));else{for(var a=0,r=t;a<r.length;a++){var s=r[a];B.push(s.entry);var i=s.dest?s.dest:"",n=k[i];n?n.push(s.entry):k[i]=[s.entry]}if(0==--q){S.default.tryAddFiles(B,(function(){for(var t in k){var a=k[t];c.UploaderActions.addFilesToPLU({files:a,path:t||void 0,dropTarget:e.target||void 0,numPathsInUploadAttempt:Object.keys(k).length})}}))}}},V=0,H=R;V<H.length;V++){var G=H[V];G.file&&G.file((function(e){var a=e;a.batchId=t,a.chooserType=_,Q([{entry:a,dest:void 0}]),p.logUploadAction({user:m,action:C.WebUploadActionEvent.UPLOAD_ATTEMPT,upload:a,chooser_type:T.ChooserType.FILE,upload_method:T.UploadMethod.DRAG,num_files:R.length,uploadPath:h})}))}O.length&&(c.UploaderActions.addDirectoriesToPLU({directoryEntries:O,batchId:t,chooserType:_,onFinish:Q}),p.logUploadAction({user:m,action:C.WebUploadActionEvent.UPLOAD_ATTEMPT,chooser_type:T.ChooserType.FOLDER,upload_method:T.UploadMethod.DRAG,num_dirs:O.length,batchId:t,uploadPath:h}))}else if(u&&u.length){var W=[];_=T.ChooserType.UNKNOWN;for(g=0;g<u.length;g++){(j=u.item(g)).batchId=t,j.chooserType=_,W.push(j)}p.logUploadAction({user:m,action:D.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,chooser_type:_,upload_method:T.UploadMethod.DRAG}),i.TeamsWebActionsLogger.log("drag_and_drop_files",a.__assign({file_type:_},v.getUploadLocationMetadataToLog(m,y.uploaderStore.path()))),S.default.tryAddFiles(W,(function(){c.UploaderActions.addFilesToPLU({files:W,dropTarget:e.target||void 0})}));for(var z=0,K=W;z<K.length;z++){var j=K[z];p.logUploadAction({user:m,action:C.WebUploadActionEvent.UPLOAD_ATTEMPT,upload:j,chooser_type:_,upload_method:T.UploadMethod.DRAG,num_files:W.length,uploadPath:h})}}else F.msie&&u&&0===u.length&&(_=T.ChooserType.FOLDER,I.Snackbar.show(o.default.createElement(I.Snackbar,{title:P.intl.formatMessage({id:"XFHH8i",defaultMessage:"Can’t upload folders in Internet Explorer. Upload the files separately or try another browser."}),variant:"fail",closeButtonText:"Close",id:"upload-error-internet-explorer"})),p.logUploadAction({user:m,action:D.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,chooser_type:_,upload_method:T.UploadMethod.DRAG}))},l.handleExternalDrop=function(e,t){return a.__awaiter(l,void 0,void 0,(function(){var s,n,l,d,u,c,m,h,_,f,g,E,S,b;return a.__generator(this,(function(A){switch(A.label){case 0:return(s=this.props.uploadConsumerInterface)?[4,s.handleDrop(e,y.uploaderStore.path())]:[3,2];case 1:if(n=A.sent(),l=n.items,d=n.errors,!l.length)return[2];for(u=r.partition(l,(function(e){return e.isDir})),c=u[0],m=u[1],h=c.length?m.length?T.ChooserType.FILE_FOLDER:T.ChooserType.FOLDER:T.ChooserType.FILE,_=y.uploaderStore.user(),f=y.uploaderStore.path(),p.logUploadAction({user:_,action:D.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,chooser_type:h,upload_method:T.UploadMethod.DRAG}),i.TeamsWebActionsLogger.log("drag_and_drop_files",a.__assign({file_type:h},v.getUploadLocationMetadataToLog(_,y.uploaderStore.path()))),s.startUploading(),g=0,E=m;g<E.length;g++)(S=E[g]).file&&(b=a.__assign(a.__assign({},S.file),{batchId:t,chooserType:h}),p.logUploadAction({user:_,action:C.WebUploadActionEvent.UPLOAD_ATTEMPT,upload:b,chooser_type:h,upload_method:T.UploadMethod.DRAG,num_files:m.length+d.length,uploadPath:f,useUploadKit:!0}));c.length&&p.logUploadAction({user:_,action:C.WebUploadActionEvent.UPLOAD_ATTEMPT,chooser_type:h,upload_method:T.UploadMethod.DRAG,num_dirs:c.length,batchId:t,uploadPath:f,useUploadKit:!0}),F.msie&&!m.length&&I.Snackbar.show(o.default.createElement(I.Snackbar,{title:P.intl.formatMessage({id:"XFHH8i",defaultMessage:"Can’t upload folders in Internet Explorer. Upload the files separately or try another browser."}),variant:"fail",closeButtonText:"Close",id:"upload-error-internet-explorer"})),A.label=2;case 2:return[2]}}))}))},l.handleDrop=function(e){var t=l.props,a=t.useUploadKit,r=t.uploadConsumerInterface,o=e.dataTransfer,s=v.generateBatchId();l.setState({fileWasDragged:!0,lastFileUploadMethod:"dnd"}),e.preventDefault(),e.stopPropagation(),l._dragEnterCount=0,l._lastEnteredElement=null,c.UploaderActions.setNumDraggingFiles({numDraggingFiles:0});var i,d=o&&o.getData(F.INTERNAL_FILE_DATA_TRANSFER_TYPE);if(!d||(i=l.handleInternalDrop(e,d)))if(R.Viewer.get_viewer().team_is_locked)l.showOQModal({forceLocked:!0,context:E.UploaderOverQuotaModalContexts.LOCKED_TEAM_DRAG_AND_DROP});else if(l.state.hasPermissionToUploadToFolder||l.state.isMovingIntoVault){if(l.state.overQuotaStatus!==h.OverQuotaStatusType.BASIC_OVER_QUOTA){if(!a||!r){var u=n.getDraggedLink(o);if(u)return l.handleDraggedLink(e,u,s)}return l.verifyDataTransferItems(e,i),a&&r?void l.handleExternalDrop(o,s):l.legacyHandleExernalDrop(e,s,i)}l.showOQModal({context:E.UploaderOverQuotaModalContexts.ALREADY_OQ_DRAG_AND_DROP})}},l.state=a.__assign(a.__assign({},l.getStateFromStores()),{isTeamOnboarding:!1,userQuotaUsageRatio:0,tsdQuotaUsageRatio:0,inExcludedNses:!1,numTeamMembers:0,numTeamAdmins:0,teamAdminEmail:"",teamAdminFname:"",promptAdminToUpgradeEmailTemplateUrl:"",overQuotaStatus:h.OverQuotaStatusType.NONE,fileWasDragged:!1,isInlineStatusShowing:!1}),l}return a.__extends(B,t),B.prototype.getStateFromStores=function(){return{path:y.uploaderStore.path(),user:y.uploaderStore.user(),hasOverquotaError:y.uploaderStore.hasOverquotaError(),fileList:y.uploaderStore.fileList(),numDraggingFiles:y.uploaderStore.numDraggingFiles(),isInternalTransfer:y.uploaderStore.isInternalTransfer(),currentUpload:y.uploaderStore.currentUpload(),isUploadModalOpen:y.uploaderStore.isUploadModalOpen(),numSecondsLeft:y.uploaderStore.numSecondsLeft(),allUploadsComplete:y.uploaderStore.allUploadsComplete(),inlineStatusShouldBeDismissed:y.uploaderStore.inlineStatusShouldBeDismissed(),hasPermissionToUploadToFolder:y.uploaderStore.hasPermissionToUploadToFolder(),isMovingIntoVault:y.uploaderStore.isMovingIntoVault(),isPermissionsAtUploadModalOpen:y.uploaderStore.isPermissionsAtUploadModalOpen()}},B.showModal=function(){k&&k.showModal()},B.showOQModal=function(e){void 0===e&&(e={}),k&&k.showOQModal(e)},B.showModalWithTeamOnboarding=function(){k&&k.setState({isTeamOnboarding:!0},k.showModal)},B.prototype.handleUploadButtonClick=function(e,t){var a=y.uploaderStore.user();this.setState({lastFileUploadMethod:"upm"}),this.state.overQuotaStatus!==h.OverQuotaStatusType.NONE&&this.state.overQuotaStatus!==h.OverQuotaStatusType.BASIC_NEAR_QUOTA?this.showModal():(A.prewarmFolderDialog(),t&&(this.onNextFileUploadComplete=t),e?(this.chooseFolder(),p.logUploadAction({user:a,action:D.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,chooser_type:T.ChooserType.FOLDER,upload_method:T.UploadMethod.CHOOSER}),i.TeamsWebActionsLogger.log("upload_folder_clk",v.getUploadLocationMetadataToLog(a,y.uploaderStore.path()))):(this.chooseFiles(),p.logUploadAction({user:a,action:D.WebUserActionLogEvent.UPLOAD_FILES_CLICK,chooser_type:T.ChooserType.FILE,upload_method:T.UploadMethod.CHOOSER}),i.TeamsWebActionsLogger.log("upload_file_clk",v.getUploadLocationMetadataToLog(a,y.uploaderStore.path()))))},B.prototype.showModal=function(){this.setState({fileWasDragged:!1}),this.fetchQuotaUpsellInfo(),R.Viewer.get_viewer().team_is_locked?this.showOQModal({forceLocked:!0,context:E.UploaderOverQuotaModalContexts.LOCKED_TEAM_CLICK_BUTTON}):(this.state.fileList.count()||this.state.overQuotaStatus!==h.OverQuotaStatusType.NONE&&this.state.overQuotaStatus!==h.OverQuotaStatusType.BASIC_NEAR_QUOTA)&&(M.Modal.showInstance(o.default.createElement(_.FileUploaderModal,{dragAndDropEnabled:!!this.props.dragAndDropEnabled,shouldShowDestinationLink:!!this.props.shouldShowDestinationLink,onModalDismissed:this.onModalDismissed,isTeamOnboarding:this.state.isTeamOnboarding,isContentManager:!!this.props.isContentManager,getCMUriForFqPath:this.props.getCMUriForFqPath,numTeamMembers:this.state.numTeamMembers,numTeamAdmins:this.state.numTeamAdmins,teamAdminEmail:this.state.teamAdminEmail,teamAdminFname:this.state.teamAdminFname,promptAdminToUpgradeEmailTemplateUrl:this.state.promptAdminToUpgradeEmailTemplateUrl,overQuotaStatus:this.state.overQuotaStatus,lastFileUploadMethod:this.state.lastFileUploadMethod,handleFileChoose:this.chooseFiles,handleFolderChoose:this.chooseFolder,handleCancelUpload:this.cancelUpload})),c.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!0}),this.state.overQuotaStatus===h.OverQuotaStatusType.BASIC_OVER_QUOTA&&i.NQOQLogger.logViewModal("wb_oq_upm",{modal_type:"utility"}))},B.prototype.showOQModal=function(e){void 0===e&&(e={});var t=e.forceLocked||!1,a=this.state.fileList.toArray().filter((function(e){return e.errorType===h.UploadErrorType.OVER_QUOTA_ERROR||e.errorType===h.UploadErrorType.GENERIC||e.errorType===h.UploadErrorType.LOCKED_TEAM_ERROR})),r=a&&a[a.length-1]?a[a.length-1].name:P.intl.formatMessage({id:"X79zCh",defaultMessage:"this file"}),s=t||this.state.fileList.toArray().filter((function(e){return e.errorType===h.UploadErrorType.LOCKED_TEAM_ERROR})).length>0;M.Modal.showInstance(o.default.createElement(g.OQDragDropModal,{oqFilename:r,isLockedTeam:s,isContentManager:!!this.props.isContentManager,isTeamUser:!!this.state.user.is_team,context:e.context||E.UploaderOverQuotaModalContexts.UNKNOWN,initialOverQuotaStatus:this.initialOverQuotaStatus||h.OverQuotaStatusType.NONE})),i.NQOQLogger.logViewModal("wb_oq_dnd",{modal_type:"billboard"})},B.prototype.UNSAFE_componentWillMount=function(){if(k)throw new Error("Only one FileUploader component may be rendered to the page at any time.You have tried to instantiate multiple uploaders.");k=this},B.prototype.componentDidMount=function(){var e=this.props,t=e.ajaxInterceptor,a=e.autoTeamGroupId,r=e.chooseDestination,o=e.dragAndDropEnabled,s=e.isContentManager,i=e.getBrowseContext,n=e.rootNSIDForCM,l=e.uploaderPostTTIExperiments,d=void 0===l?{}:l,u=e.handleClickNewFolder,p=e.useUploadKit,m=void 0!==p&&p,h=e.uploadConsumerInterface,_=e.parallelFileUploads,f=d.expGrowthActSmbTsaPermUpload,g=d.expGrowthActSmbTsaPermUploadMulti,E=d.expGrowthActSmbTsaPermUploadNested;y.uploaderStore.add_change_listener(this.handleStoreChanged),c.UploaderActions.initPLU({chooseDestination:r,isContentManager:s,rootNSIDForCM:n,autoTeamGroupId:a,expGrowthActSmbTsaPermUpload:f,expGrowthActSmbTsaPermUploadMulti:g,expGrowthActSmbTsaPermUploadNested:E,getBrowseContext:i,handleClickNewFolder:u,useUploadKit:m,uploadConsumerInterface:h,parallelFileUploads:_}),c.UploaderActions.setAjaxInterceptor(t),c.UploaderActions.setIsContentManager(s),this._dragEnterCount=0,this._lastEnteredElement=null,o&&(this.listeners.push([document,"dragover",this.handleDragOver]),this.listeners.push([document,"dragenter",this.handleDragEnter]),this.listeners.push([document,"dragleave",this.handleDragLeave]),this.listeners.push([document,"drop",this.handleDrop])),this.listeners.push([window,"beforeunload",this.handleUnload]),this.state.user&&this.fetchQuotaUpsellInfo(),this.listeners.forEach((function(e){var t=e[0],a=e[1],r=e[2];t.addEventListener(a,r)}))},B.prototype.UNSAFE_componentWillUpdate=function(e,t){(!t.currentUpload&&this.state.currentUpload&&(this.props.onFileUploadComplete&&this.props.onFileUploadComplete(this.state.currentUpload),this.onNextFileUploadComplete&&(this.onNextFileUploadComplete(this.state.currentUpload),this.onNextFileUploadComplete=null),this.state.isTeamOnboarding&&i.TeamsWebActionsLogger.log("uploaded_file")),t.fileList!==this.state.fileList)&&(!this.isSomethingUploading(t)&&t.fileList.count()&&(t.fileWasDragged||u.maybeShowClientDownloadModal(!1),this.props.onAllFileUploadsComplete&&this.props.onAllFileUploadsComplete(this.state.fileList)))},B.prototype.componentDidUpdate=function(e,t){var a=this.state,r=a.hasOverquotaError,o=a.isMovingIntoVault,s=a.hasPermissionToUploadToFolder,i=a.isInternalTransfer,n=a.isUploadModalOpen,l=a.numDraggingFiles,d=a.user;if(l&&!i){if(!n)if(!s&&o)this.notifyLockedVault();else if(s)if(R.Viewer.get_viewer().team_is_locked)N.Notify.error(P.intl.formatMessage({id:"tQ1bJN",defaultMessage:"Can’t upload. Your team no longer has full use of {trademark_business} features."},{trademark_business:O.TRADEMARK_BUSINESS}));else{var u=P.intl.formatMessage({id:"PLAAYq",defaultMessage:"Drop your files to {upload_action}"},{upload_action:this.makeUploadSnippet(1e3)});N.Notify.success(u,60)}else N.Notify.error(P.intl.formatMessage({id:"rFwHYL",defaultMessage:"You don’t have permission to add to this folder."}))}else!l&&t.numDraggingFiles&&N.Notify.clear();if(this.updateInlineStatus(),!t.user&&d&&this.fetchQuotaUpsellInfo(),!t.hasOverquotaError&&r&&this.showOQModal({context:E.UploaderOverQuotaModalContexts.WENT_OQ_DURING_UPLOAD}),this.props.useUploadKit&&e.uploadConsumerInterface&&this.props.uploadConsumerInterface){var p=U.anyFileUploading(e.uploadConsumerInterface.uploadItems),c=U.anyFileUploading(this.props.uploadConsumerInterface.uploadItems);p&&!c&&m.ActionsAdapter.emit("uploadComplete",{})}},B.prototype.fetchQuotaUpsellInfo=function(){var e=this;w.assert(null!=this.state.user,"user is null"),s.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:this.state.user.id},success:function(t){try{t=JSON.parse(t),e.setState({userQuotaUsageRatio:t.user_quota_usage_ratio,tsdQuotaUsageRatio:t.tsd_quota_usage_ratio,inExcludedNses:t.in_excluded_nses,promptAdminToUpgradeEmailTemplateUrl:t.prompt_admin_to_upgrade_email_template_url,numTeamMembers:t.num_team_members,numTeamAdmins:t.num_team_admins,teamAdminEmail:t.team_admin_email,teamAdminFname:t.team_admin_fname},(function(){var t=void 0===e.initialOverQuotaStatus,a=e.determineOverQuotaStatus();e.setState({overQuotaStatus:a}),t&&(e.initialOverQuotaStatus=a)}))}catch(e){w.reportException({err:e,severity:"non-critical",exc_extra:{data:t}})}}})},B.prototype.determineOverQuotaStatus=function(){var e=this.state,t=e.path,a=e.tsdQuotaUsageRatio,r=e.inExcludedNses,o=e.user,s=e.userQuotaUsageRatio;if(w.assert(null!=o,"user is null"),o.paid||r)return h.OverQuotaStatusType.NONE;if("personal"===o.role){if(s>1)return h.OverQuotaStatusType.BASIC_OVER_QUOTA;if(s>.9)return h.OverQuotaStatusType.BASIC_NEAR_QUOTA}if(o.is_team&&R.Viewer.get_viewer().team_is_limited){var i=o.cdm_tmf_path;if(!o.is_cdm_member||i&&t.startsWith(i)){if(s>1)return h.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA}else if(a>1)return h.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA}return o.is_team&&R.Viewer.get_viewer().team_is_locked?h.OverQuotaStatusType.LOCKED_TEAM_USER_OVER_QUOTA:h.OverQuotaStatusType.NONE},B.prototype.componentWillUnmount=function(){y.uploaderStore.remove_change_listener(this.handleStoreChanged),this.listeners.forEach((function(e){var t=e[0],a=e[1],r=e[2];t.removeEventListener(a,r)})),k=null},B.prototype.isSomethingUploading=function(e){return e.fileList.some((function(e){return e.status===h.FileStatusType.PENDING||e.status===h.FileStatusType.UPLOADING}))},B.prototype.makeUploadSnippet=function(e){var t,a=this.state,r=a.user,o=a.path,s=R.Viewer.get_viewer();return w.assert(null!=r,"user is null"),s.is_paired&&r.is_team&&(t=s.team_name),(this.props.uploaderPostTTIExperiments||{}).expSmbFirstTask&&r.is_team&&"/"===o?P.intl.formatMessage({id:"rN5x2A",defaultMessage:"upload to your team’s workspace"}):s.is_paired?r.is_team?this.makeTeamSnippet(o,e,t):this.makePersonalSnippet(o,e):this.makeUnpairedSnippet(o,e)},B.prototype.makeTeamSnippet=function(e,t,a){var r=l.Emstring.em_snippet(d.filename(e),t);return"/"===e?P.intl.formatMessage({id:"3yCzsM",defaultMessage:"upload to your {team_name} Dropbox"},{team_name:a}):P.intl.formatMessage({id:"qT7k0C",defaultMessage:"upload to the folder ‘{folder}’ in your {team_name} Dropbox"},{folder:r,team_name:a})},B.prototype.makePersonalSnippet=function(e,t){var a=l.Emstring.em_snippet(d.filename(e),t);return"/"===e?P.intl.formatMessage({id:"2NsS1B",defaultMessage:"upload to your personal Dropbox"}):P.intl.formatMessage({id:"JwMP6F",defaultMessage:"upload to the folder ‘{folder}’ in your personal Dropbox"},{folder:a})},B.prototype.makeUnpairedSnippet=function(e,t){var a=l.Emstring.em_snippet(d.filename(e),t);return"/"===e?P.intl.formatMessage({id:"JVgEKY",defaultMessage:"upload to your Dropbox"}):P.intl.formatMessage({id:"fZwvxY",defaultMessage:"upload to the folder ‘{folder}’"},{folder:a})},B.prototype.isInternalTransfer=function(e){return e instanceof DOMStringList?e.contains("Text")||e.contains("text/plain"):e.includes(F.INTERNAL_FILE_DATA_TRANSFER_TYPE)||e.includes("text/plain")},B.prototype.render=function(){return o.default.createElement("div",null)},B.defaultProps={dragAndDropEnabled:!0,shouldShowDestinationLink:!0,isContentManager:!1,chooseDestination:!1},B})(o.default.PureComponent);t.FileUploader=B})),define("modules/clean/react/file_uploader/oq_drag_drop_modal",["require","exports","tslib","react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react/modal","modules/clean/analytics","modules/clean/react/file_uploader/utils","modules/clean/static_urls","modules/constants/payments","modules/constants/trademark","modules/clean/viewer","modules/clean/react/file_uploader/constants"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),p=a.__importStar(p);var _=(function(e){function t(t){var a=e.call(this,t)||this;return a.trackClose=function(){l.NQOQLogger.logCloseModal("wb_oq_dnd",{modal_type:"billboard"});var e=a.getButtonProps().locationCode;a.logProEventIfLocationCode(e,"close")},a.logProEventIfLocationCode=function(e,t){if(["ho","fb"].includes(e)){var r=void 0;switch(a.props.initialOverQuotaStatus){case h.OverQuotaStatusType.BASIC_NEAR_QUOTA:r="near";break;case h.OverQuotaStatusType.BASIC_OVER_QUOTA:r="over";break;case h.OverQuotaStatusType.NONE:r="under";break;default:r=void 0}var o=a.getButtonProps(),s=o.trackingButtonLabel,i=o.buttonUrl;l.GrowthEventsLogger.log("wb_oq_dnd_"+e,{action:t,button_text:s,destination_url:i.split("?")[0],location:"overlay",quota_status:"over",upsell_type:"modal",initial_quota_status:r})}},a.trackCTAClick=function(){var e=a.getButtonProps(),t=e.locationCode,r=e.trackingButtonLabel;l.NQOQLogger.logAcceptModal("wb_oq_dnd",{modal_type:"billboard",cta_text:r}),a.logProEventIfLocationCode(t,"click")},a.trackOpen=function(){var e=d.getOQmodalOQALocationCode(a.props.pathname);a.logProEventIfLocationCode(e,"view")},a.state={showTeamMemberContent:a.props.isTeamUser&&!a.props.isContentManager},a}return a.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){this.setState({showTeamMemberContent:e.isTeamUser&&!e.isContentManager})},t.prototype.render=function(){return r.default.createElement("div",{className:"drag-drop-oq"},r.default.createElement(n.Modal,{style:"clean",className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480,onDismiss:this.trackClose,onShow:this.trackOpen},r.default.createElement("div",null,r.default.createElement(s.Image,{src:u.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:u.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})),this.renderTitle(),this.renderBody()))},t.prototype.renderBody=function(){var e=i.intl.formatMessage({id:"kDhrxK",defaultMessage:"In order to finish uploading {filename}, you need to add more storage to your Dropbox."},{filename:this.props.oqFilename});if(this.props.isLockedTeam){var t=m.Viewer.get_viewer().work_user;e=t&&t.is_team_admin?i.intl.formatMessage({id:"9xkxHM",defaultMessage:"Your team no longer has full use of {trademark_business} features. Add your billing info now and you can pick up right where you left off."},{trademark_business:c.TRADEMARK_BUSINESS}):i.intl.formatMessage({id:"Iccom6",defaultMessage:"Your team no longer has full use of {trademark_business} features. To keep using {trademark_business}, contact your admin."},{trademark_business:c.TRADEMARK_BUSINESS})}else this.state.showTeamMemberContent&&(e=i.intl.formatMessage({id:"5pKEiG",defaultMessage:"Your Dropbox account is full. To add this file, remove files or ask your admin for more space."}));return r.default.createElement("div",{className:"drag-drop-oq--copy"},e)},t.prototype.renderTitle=function(){var e=i.intl.formatMessage({id:"0eDgXK",defaultMessage:"Your Dropbox is full"});return this.props.isLockedTeam?e=i.intl.formatMessage({id:"qtEHDj",defaultMessage:"Can’t upload to Dropbox"}):this.state.showTeamMemberContent&&(e=i.intl.formatMessage({id:"xW4p7B",defaultMessage:"Can’t upload file"})),r.default.createElement("div",{className:"drag-drop-oq--header"},e)},t.prototype.getButtonProps=function(){var e=d.getOQmodalOQALocationCode(this.props.pathname),t=p.OUT_OF_SPACE_URL+"?oqa=wb_oq_dnd_"+e,a=i.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"}),r="get more space";return this.props.isLockedTeam?(t="/team/decide",a=i.intl.formatMessage({id:"yHR5ks",defaultMessage:"See next steps"}),r="see next steps"):this.state.showTeamMemberContent&&(t="/help/business/space-limit-full",a=i.intl.formatMessage({id:"K2PjtT",defaultMessage:"Learn more about Dropbox space"}),r="learn more about dropbox space"),{buttonUrl:t,buttonLabel:a,locationCode:e,trackingButtonLabel:r}},t.prototype.renderButtons=function(){var e=this.getButtonProps(),t=e.buttonUrl,a=e.buttonLabel;return r.default.createElement("div",{className:"drag-drop-oq--buttons"},r.default.createElement("a",{href:t,onClick:this.trackCTAClick,className:"drag-drop-oq--button c-btn c-btn--primary"},a))},t})(r.default.Component);t.OQDragDropModalComponent=_,t.OQDragDropModal=o.requireCssWithComponent(_,["/static/css/browse/oq_drag_drop_upsell-vflNUG-aS.css"])})),define("modules/clean/react/file_uploader/oq_drag_drop_modal_types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.UNKNOWN="unknown",e.WENT_OQ_DURING_UPLOAD="went_oq_during_upload",e.ALREADY_OQ_DRAG_AND_DROP="already_oq_drag_and_drop",e.ALREADY_OQ_CLICK_BUTTON="already_oq_upload_button",e.LOCKED_TEAM_DRAG_AND_DROP="locked_team_drag_and_drop",e.LOCKED_TEAM_CLICK_BUTTON="locked_team_click_button"})(t.UploaderOverQuotaModalContexts||(t.UploaderOverQuotaModalContexts={}))})),define("modules/clean/react/file_uploader/nearquota_upload_alt_action",["require","exports","tslib","react","modules/clean/react/css","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],(function(e,t,a,r,o,s,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),t.getNearquotaUploadAltActionOQA=function(e,t){return e&&t?"wb_nq_"+e+"_"+("/h"===t?"ho":"fb"):"upl_nq"};var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){var e=this.props.oqa?"?oqa="+this.props.oqa:"";return r.default.createElement("div",{className:"nearquota-alt-action"},r.default.createElement("div",null,r.default.createElement(s.Image,{className:"nearquota-alt-action__warning",src:i.static_url("/static/images/browse/warning-vflZsXcW-.svg"),alt:n.intl.formatMessage({id:"6cRVYz",defaultMessage:"Warning"})})),r.default.createElement("p",{className:"nearquota-alt-action__copy"},n.intl.formatMessage({id:"2LVZs5",defaultMessage:"Thanks for adding stuff to Dropbox! Just so you know, you’re getting close to your space limit. <overQuotaLink>Learn more</overQuotaLink> about what to do if you run out of space."},{overQuotaLink:function(t){return r.default.createElement("a",{key:"nq-link",href:"/low-space"+e},t)}})))},t})(r.default.Component);t.NearquotaUploadAltAction=o.requireCssWithComponent(l,["/static/css/nearquota_upload_alt_action-vfld1u9EQ.css"])})),define("modules/clean/react/file_uploader/file_uploader_modal",["require","exports","tslib","classnames","react","react-dom","jquery","modules/core/browser","modules/clean/browse_interface","modules/clean/css","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/analytics","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/utils","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/nearquota_upload_alt_action","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/uploader_modal","modules/clean/react/flag","modules/clean/react/icon/icon_helper","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/static_urls","modules/clean/viewer","modules/constants/payments","modules/constants/trademark","modules/core/exception","modules/core/i18n","modules/core/uri"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T,v,b,A,M,I,U,R,C,D,O,L,F){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),s=a.__importStar(s),i=a.__importDefault(i),n=a.__importStar(n),d=a.__importStar(d),u=a.__importStar(u),p=a.__importStar(p),m=a.__importStar(m),v=a.__importStar(v),C=a.__importStar(C);var w=function(e){var t,a,r=e.user,o=e.path,s=e.maxLength,i=void 0===s?1e3:s,n=R.Viewer.get_viewer();if(n.is_paired&&r.is_team&&(t=n.team_name),"/"===o)a=n.is_paired?r.is_team?L.intl.formatMessage({id:"3yCzsM",defaultMessage:"upload to your {team_name} Dropbox"},{team_name:t}):L.intl.formatMessage({id:"2NsS1B",defaultMessage:"upload to your personal Dropbox"}):L.intl.formatMessage({id:"JVgEKY",defaultMessage:"upload to your Dropbox"});else{var l=c.Emstring.em_snippet(m.filename(o),i);a=n.is_paired?r.is_team?L.intl.formatMessage({id:"qT7k0C",defaultMessage:"upload to the folder ‘{folder}’ in your {team_name} Dropbox"},{folder:l,team_name:t}):L.intl.formatMessage({id:"JwMP6F",defaultMessage:"upload to the folder ‘{folder}’ in your personal Dropbox"},{folder:l}):L.intl.formatMessage({id:"fZwvxY",defaultMessage:"upload to the folder ‘{folder}’"},{folder:l})}return a},P=(function(e){function t(a){var n=e.call(this,a)||this;return n._onUploaderStoreChanged=function(){n.setState(n._get_state_from_store())},n.logProEventIfLocationCode=function(e,t,a,r){["ho","fb"].includes(e)&&h.GrowthEventsLogger.log("wb_oq_upm_"+e,{action:t,button_text:a,destination_url:r,location:"overlay",quota_status:"over",upsell_type:"modal"})},n._focusChooseButton=function(){var e=s.findDOMNode(n.refs.pluFileChooseButton);i.default(e).focus()},n.isSomethingUploading=function(){return n.state.fileList.find((function(e){return e.status===g.FileStatusType.PENDING||e.status===g.FileStatusType.UPLOADING}))},n._handleClose=function(){n.isSomethingUploading()||_.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0}),_.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),A.Modal.close(),n.props.onModalDismissed&&n.props.onModalDismissed(),h.NQOQLogger.logCancelModal("wb_oq_upm",{modal_type:"utility"})},n._handleOnDismiss=function(e){_.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),h.NQOQLogger.logCloseModal("wb_oq_upm",{modal_type:"utility"})},n._limitedTeamOverquotaLink=function(e){var t,a=n.state.user;return a.is_cdm_member&&!a.is_team_admin&&n.props.numTeamAdmins>0?n.props.promptAdminToUpgradeEmailTemplateUrl:(t=1===n.props.numTeamMembers?"/plans":"/team/upgrade",new F.URI({path:t,query:{_tk:"over_quota",_camp:"upload_modal",oqa:e?"upl":"upl_b"}}).toString())},n.trackCTAClick=function(e,t){return function(){var a=n.getButtonProps().tracking_upgrade_CTA;h.NQOQLogger.logAcceptModal("wb_oq_upm_"+n.OQALocationCode,{modal_type:"utility",cta_text:a}),n.logProEventIfLocationCode(n.OQALocationCode,"click",e,t)}},n._renderIntroModalButtons=function(){var e,t=n.getButtonProps().upgrade_CTA,a=o.default.createElement("div",{className:"u-font-medium"},n.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA?L.intl.formatMessage({id:"oor0f7",defaultMessage:"Before you can upload files, you need to <a>get more space</a>."},{a:function(e){return o.default.createElement("a",{"aria-label":L.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"}),className:"upload-overquota-banner__link overquota-uploader-link",href:"/out-of-space?oqa=wb_oq_upm_"+n.OQALocationCode,onClick:n.trackCTAClick("get more space","http://www.dropbox.com/out-of-space")},e)}}):n.state.user.is_cdm_member&&[g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(n.props.overQuotaStatus)?"":n.props.overQuotaStatus===g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA?L.intl.formatMessage({id:"oor0f7",defaultMessage:"Before you can upload files, you need to <a>get more space</a>."},{a:function(e){return o.default.createElement("a",{"aria-label":L.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"}),className:"upload-overquota-banner__link overquota-uploader-link",href:n._limitedTeamOverquotaLink(!0)},e)}}):L.intl.formatMessage({id:"uY/bLP",defaultMessage:"Having problems? Please try again."})),r=null;if(n.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA){var s=C.OUT_OF_SPACE_URL+"?oqa=wb_oq_upm_"+n.OQALocationCode;r=o.default.createElement("a",{className:"dbmodal-button c-btn c-btn--primary",href:s,onClick:n.trackCTAClick("Upgrade to Upload","http://www.dropbox.com/out-of-space")},t)}else r=[g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(n.props.overQuotaStatus)?o.default.createElement("a",{className:"dbmodal-button c-btn c-btn--primary",href:n._limitedTeamOverquotaLink(!1)},t):o.default.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary",onClick:n.props.handleFileChoose},L.intl.formatMessage({id:"WRCs8D",defaultMessage:"Choose files"}));if(e=o.default.createElement("button",{className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:n._handleClose},L.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),n.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA||n.props.overQuotaStatus===g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA&&!n.state.user.is_cdm_member){return o.default.createElement("div",{className:"u-mar-vertical-l clearfix"},o.default.createElement("div",{className:"u-l-fr"},r,e),o.default.createElement("div",{className:"upload-overquota-banner__container"},o.default.createElement("div",{id:"upload-overquota-banner",className:"c-banner c-banner--warning upload-overquota-banner__content"},a)))}return o.default.createElement("div",{className:"u-mar-top-l"},o.default.createElement(T.Flag,{spacing:"s",rightAttachment:o.default.createElement("div",null,r,e)},a))},n._renderFileListModalButtons=function(){var e=n.state.fileList.find((function(e){return e.status===g.FileStatusType.PENDING||e.status===g.FileStatusType.UPLOADING})),t=e?"tertiary":"primary",a=o.default.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary",onClick:n.props.handleFileChoose},L.intl.formatMessage({id:"y1ySNn",defaultMessage:"Add more files"})),r=o.default.createElement("button",{className:"dbmodal-button c-btn c-btn--"+t,onClick:n._handleClose},e?L.intl.formatMessage({id:"NNi2D+",defaultMessage:"Hide"}):L.intl.formatMessage({id:"6bRQ0U",defaultMessage:"Done"}));return o.default.createElement("div",{className:"u-mar-top-s"},o.default.createElement(T.Flag,{spacing:"s",leftAttachment:a,rightAttachment:r},o.default.createElement("div",{className:"u-font-small"},!e&&L.intl.formatMessage({id:"uY/bLP",defaultMessage:"Having problems? Please try again."}))))},n._renderIntroMessage=function(){var e=w({user:n.state.user,path:n.state.path}),t=R.Viewer.get_viewer().team_name;if(n.state.user.is_cdm_member&&[g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(n.props.overQuotaStatus)){var a=void 0;return a=n.props.overQuotaStatus===g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA?L.intl.formatMessage({id:"YBc5zy",defaultMessage:"Your member folder is full, so no new files can be added"}):L.intl.formatMessage({id:"y3tz33",defaultMessage:"The {team_name} shared workspace is full, so no new files can be added"},{team_name:t}),n.state.user.is_team_admin||!n.props.numTeamAdmins?L.intl.formatMessage({id:"y/lF1K",defaultMessage:"{count, plural, one{{dropbox_full_message}. To get more space, <upgradeLink>upgrade your account </upgradeLink>.} other{{dropbox_full_message}. To get more space, <upgradeLink>upgrade to {trademark_business}</upgradeLink>.}}"},{count:n.props.numTeamMembers,dropbox_full_message:a,trademark_business:D.TRADEMARK_BUSINESS,upgradeLink:function(e){return o.default.createElement("a",{href:n._limitedTeamOverquotaLink(!1)},e)}}):L.intl.formatMessage({id:"0QCr8R",defaultMessage:"{count, plural, one{{dropbox_full_message}. To get more space, ask your Dropbox admin ({admin_email}).} other{{dropbox_full_message}. To get more space, ask your Dropbox admins ({admin_email} and {num_other_admins} others).}}"},{count:n.props.numTeamAdmins,dropbox_full_message:a,admin_email:n.props.teamAdminEmail,num_other_admins:n.props.numTeamAdmins-1})}return[g.OverQuotaStatusType.BASIC_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA].includes(n.props.overQuotaStatus)?L.intl.formatMessage({id:"FRK0o9",defaultMessage:"You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."}):n.props.isTeamOnboarding?L.intl.formatMessage({id:"rSHYZt",defaultMessage:"Choose files to add to the {team_name} team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the {team_name} Dropbox will have access to files in the team folder."},{team_name:t}):n.props.dragAndDropEnabled?L.intl.formatMessage({id:"PpRjFS",defaultMessage:"Choose files to {upload_folder_name}. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading."},{upload_folder_name:e}):L.intl.formatMessage({id:"BQ5Ax0",defaultMessage:"Choose files to {upload_folder_name}. You can select more than one file at a time."},{upload_folder_name:e})},n._renderDropzone=function(){return o.default.createElement("div",{ref:"dropzone",id:t.DROPZONE_ID,style:{display:"none"}},o.default.createElement("div",null,L.intl.formatMessage({id:"Q7DkIp",defaultMessage:"{count, plural, one{Drop your file to {upload_action}} other{Drop your files to {upload_action}}}"},{count:n.state.numDraggingFiles,upload_action:w({user:n.state.user,path:n.state.path,maxLength:20})})))},n._renderFileListRowStatus=function(e){return e.status===g.FileStatusType.UPLOADING&&100===e.percentUploaded?o.default.createElement(b.Image,{src:U.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:U.static_url("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):e.status===g.FileStatusType.PENDING||e.status===g.FileStatusType.UPLOADING?o.default.createElement("button",{className:"button-as-link uploader-modal-row-cancel-button",onClick:function(t){return t.preventDefault(),n.props.handleCancelUpload(e)}},o.default.createElement(M.Sprite,{group:"web",name:"xclose",alt:L.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})})):e.status===g.FileStatusType.COMPLETE?o.default.createElement(M.Sprite,{group:"web",name:"s_check",alt:L.intl.formatMessage({id:"2tVWPi",defaultMessage:"Upload successful"})}):e.status===g.FileStatusType.CANCELLED?o.default.createElement(b.Image,{src:U.static_url("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:U.static_url("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:L.intl.formatMessage({id:"hsvG4I",defaultMessage:"Upload cancelled"})}):e.status===g.FileStatusType.FAILED?o.default.createElement(b.Image,{src:U.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:U.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:L.intl.formatMessage({id:"fy9qFc",defaultMessage:"Error"})}):void 0},n._renderFileListRowError=function(e){var t=e.errorMessage||L.intl.formatMessage({id:"RVsdJD",defaultMessage:"Something went wrong while uploading this file."});return o.default.createElement("div",{className:"error-col"},o.default.createElement("span",{className:"error-msg"},e.errorType===g.UploadErrorType.FILE_SIZE_ERROR?L.intl.formatMessage({id:"oHBKTq",defaultMessage:"File too large"}):L.intl.formatMessage({id:"GWmSVK",defaultMessage:"Upload Error"}),o.default.createElement("span",{className:"error-details"},o.default.createElement(I.Tooltip,{position:I.TooltipPosition.RIGHT,tooltip_contents:o.default.createElement("div",null,t),tooltip_classname:"upload-error-tooltip"},o.default.createElement(M.Sprite,{group:"web",name:"information",alt:L.intl.formatMessage({id:"+SX5vq",defaultMessage:"More information"})})))))},n._renderFileListRowDest=function(e){if(e.status===g.FileStatusType.CANCELLED)return L.intl.formatMessage({id:"+ECsZb",defaultMessage:"Canceled"});var a=void 0,r=R.Viewer.get_viewer().get_user_by_id(e.userId);return a=n.props.isContentManager?"":l.get_browse_root_name(r),o.default.createElement("a",{href:l.browse_uri_for_fq_path(r,e.dest).toString()},c.Emstring.em_snippet(""+a+e.dest,t.DEST_SNIPPET_LENGTH,0))},n._renderFileListRow=function(e,a){var s=e.status===g.FileStatusType.UPLOADING?e.percentUploaded:e.status===g.FileStatusType.PENDING?0:100,i={"upload-file":!0,complete:e.status===g.FileStatusType.COMPLETE,cancelled:e.status===g.FileStatusType.CANCELLED,error:e.status===g.FileStatusType.FAILED};return o.default.createElement("li",{className:r.default(i),key:e.uploadId,style:{backgroundSize:s+"% 100%"}},o.default.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},o.default.createElement("div",{className:"filename-col"},o.default.createElement(M.Sprite,{group:"web",name:v.file_icon(e.name),alt:""}),o.default.createElement("span",{className:"filename"},c.Emstring.em_snippet(e.name,t.FILENAME_SNIPPET_LENGTH)),null!=e.size&&o.default.createElement("span",{className:"size"}," - ",p.format_bytes(e.size))),e.status!==g.FileStatusType.FAILED&&a&&o.default.createElement("div",{className:"dest-col"},n._renderFileListRowDest(e)),e.status===g.FileStatusType.FAILED&&n._renderFileListRowError(e),o.default.createElement("div",{className:"status-col"},n._renderFileListRowStatus(e))))},n._renderFileList=function(e,t){return void 0===t&&(t=!0),o.default.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map((function(e){return n._renderFileListRow(e,t)})))},n._renderTimeLeft=function(){var e=n.isSomethingUploading()&&n.state.numSecondsLeft?u.format_time_remaining(n.state.numSecondsLeft):"";return o.default.createElement("div",{style:{marginTop:8,textAlign:"right",minHeight:"1.25em",lineHeight:"1.25"}},e)},n.state=n._get_state_from_store(),n.OQALocationCode=f.getOQmodalOQALocationCode(a.pathname),n}return a.__extends(t,e),t.prototype._get_state_from_store=function(){var e=S.uploaderStore.user();return O.assert(null!==e,"Expected non-null user in file_uploader_modal"),{user:e,path:S.uploaderStore.path(),fileList:S.uploaderStore.fileList(),numDraggingFiles:S.uploaderStore.numDraggingFiles(),currentUpload:S.uploaderStore.currentUpload(),numSecondsLeft:S.uploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:S.uploaderStore.hasPermissionToUploadToFolder()}},t.prototype.componentDidMount=function(){var e=this;S.uploaderStore.add_change_listener(this._onUploaderStoreChanged),this._usingFileUploaderModal()&&(d.require_css("/static/css/scooter/scooter-scoped-vfljL5ijS.css"),this._focusChooseButton(),setTimeout((function(){return e.forceUpdate()}),250),i.default(window).on("resize.uploaderModal",(function(){e._focusChooseButton()}))),this.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA&&this.logProEventIfLocationCode(this.OQALocationCode,"view","Upgrade to Upload","http://www.dropbox.com/out-of-space")},t.prototype.componentDidUpdate=function(e,a){if(this._usingFileUploaderModal()){if(this._focusChooseButton(),this.state.numDraggingFiles)i.default(s.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+t.DROPZONE_ID).length||i.default("#"+t.DROPZONE_ID).clone().prependTo(i.default(s.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1);else i.default(s.findDOMNode(this.refs.modal)).find("#"+t.DROPZONE_ID).remove();if(this.state.fileList.count()>a.fileList.count()){var r=i.default(s.findDOMNode(this.refs.uploadFilesList)),o=r.find(".upload-file")?r.find(".upload-file").eq(a.fileList.count()):void 0;o&&o.length&&r.scrollTop(r.scrollTop()+o.position().top)}}},t.prototype.componentWillUnmount=function(){S.uploaderStore.remove_change_listener(this._onUploaderStoreChanged),i.default(window).off("resize.uploaderModal")},t.prototype._usingFileUploaderModal=function(){return 0===this.state.fileList.count()},t.prototype.getButtonProps=function(){var e=L.intl.formatMessage({id:"qIBZpx",defaultMessage:"Upgrade to Upload"}),t="upgrade to upload";return this.state.user.is_cdm_member&&(this.state.user.is_team_admin||0===this.props.numTeamAdmins?(e=L.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"}),t="get more space"):(e=L.intl.formatMessage({id:"h8VnsZ",defaultMessage:"Ask for more space"}),t="ask for more space")),{upgrade_CTA:e,tracking_upgrade_CTA:t}},t.prototype.render=function(){var e;e=this.props.isTeamOnboarding?L.intl.formatMessage({id:"RW3b5j",defaultMessage:"Which files would you like to add?"}):!this.state.user.is_cdm_member||this.props.overQuotaStatus!==g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA&&this.props.overQuotaStatus!==g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA?L.intl.formatMessage({id:"Wy6QpH",defaultMessage:"Upload to Dropbox"}):L.intl.formatMessage({id:"s2XJI8",defaultMessage:"More space needed"});var t=null;if(null!=this.state.fileList.find((function(e){return e.status===g.FileStatusType.COMPLETE}))&&this.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_NEAR_QUOTA){var a=E.getNearquotaUploadAltActionOQA(this.props.lastFileUploadMethod,n.get_uri().path);t=o.default.createElement(E.NearquotaUploadAltAction,{oqa:a})}return o.default.createElement("div",{ref:"container"},this._renderDropzone(),this._usingFileUploaderModal()?o.default.createElement(A.Modal,{ref:"modal",title:e,showX:!1,id:"file-uploader-modal",clickOutToClose:!0,altAction:t,buttonComponent:0===this.state.fileList.count()?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:this._handleOnDismiss},0===this.state.fileList.count()?o.default.createElement("span",null,this._renderIntroMessage()):this._renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this._renderTimeLeft()):o.default.createElement(y.UploaderModal,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,overQuotaStatus:this.props.overQuotaStatus,isContentManager:this.props.isContentManager,getCMUriForFqPath:this.props.getCMUriForFqPath,isTeamOnboarding:this.props.isTeamOnboarding,lastFileUploadMethod:this.props.lastFileUploadMethod,handleFileChoose:this.props.handleFileChoose,handleFolderChoose:this.props.handleFolderChoose,handleCancelUpload:this.props.handleCancelUpload}))},t.DROPZONE_ID="upload-modal-dropzone",t.FILENAME_SNIPPET_LENGTH=15,t.DEST_SNIPPET_LENGTH=13,t})(o.default.PureComponent);t.FileUploaderModal=P})),define("modules/clean/react/file_uploader/inline_upload_status",["require","exports","tslib","react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/file_uploader/actions","modules/clean/react/snackbar","modules/clean/react/file_uploader/constants","modules/core/i18n","modules/constants/trademark","modules/core/accessible_announce"],(function(e,t,a,r,o,s,i,n,l,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importStar(o);var c;function m(e){return e.some((function(e){return e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING}))?c.UPLOADING:e.some((function(e){return e.status===l.FileStatusType.FAILED}))?c.ERROR:c.COMPLETE}function h(e,t){var a=m(e);return a===c.UPLOADING&&t?t.percentUploaded:a===c.COMPLETE||a===c.ERROR?100:0}function _(e,t){return e.count((function(e){return e.status===t}))}function f(e){return e.count((function(e){return e.status!==l.FileStatusType.CANCELLED}))}function g(e){switch(e){case l.UploadErrorType.OVER_QUOTA_ERROR:return d.intl.formatMessage({id:"uVZpJw",defaultMessage:"out of space"});case l.UploadErrorType.FILE_SIZE_ERROR:return d.intl.formatMessage({id:"tsdRAZ",defaultMessage:"file too large"});case l.UploadErrorType.CONNECTION_ERROR:return d.intl.formatMessage({id:"vfWhT4",defaultMessage:"lost connection"});case l.UploadErrorType.HTTP_ERROR:return d.intl.formatMessage({id:"b/nZwr",defaultMessage:"server error"});case l.UploadErrorType.EMPTY_OR_FOLDER:return d.intl.formatMessage({id:"Gi+irE",defaultMessage:"can’t upload folders or empty files"});case l.UploadErrorType.FOLDER_SAFARI:return d.intl.formatMessage({id:"Y5AhQP",defaultMessage:"try uploading files separately"});case l.UploadErrorType.PACKAGE_FILE:return d.intl.formatMessage({id:"HjCRjv",defaultMessage:"OSX package file"});case l.UploadErrorType.UPLOAD_PRECHECK_INVALID_CHAR_ERROR:return d.intl.formatMessage({id:"f98azI",defaultMessage:"filename contains invalid character"});case l.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR:return d.intl.formatMessage({id:"K+VjRY",defaultMessage:"could not apply permissions"});case l.UploadErrorType.BLOCKS_MISSING_ERROR:case l.UploadErrorType.COMMIT_HTTP_ERROR:case l.UploadErrorType.UPLOAD_BLOCK_ERROR:case l.UploadErrorType.SERVER_RESPONSE_ERROR:case l.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR:case l.UploadErrorType.SERVER_TOKENS_MISSING_ERROR:case l.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case l.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case l.UploadErrorType.HASHES_NOT_EQUAL_ERROR:case l.UploadErrorType.UPLOAD_PRECHECK_ERROR:return d.intl.formatMessage({id:"b/nZwr",defaultMessage:"server error"});case l.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case l.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case l.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case l.UploadErrorType.BLOCK_INDEX_ERROR:case l.UploadErrorType.BLOCK_EMPTY_ERROR:case l.UploadErrorType.BLOB_EMPTY_ERROR:case l.UploadErrorType.BLOB_MISSING_ERROR:case l.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case l.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:case l.UploadErrorType.COMMIT_READINESS_ERROR:return d.intl.formatMessage({id:"NpsjeY",defaultMessage:"upload processing error"});default:return""}}function E(e){var t=_(e,l.FileStatusType.PENDING),a=d.intl.formatMessage({id:"MZCMJM",defaultMessage:"{count, plural, one{{count} file left} other{{count} files left}}"},{count:t});return t>0?a:d.intl.formatMessage({id:"ut04US",defaultMessage:"View details"})}function S(e,t){var a=m(e);return t||a!==c.ERROR?(function(e,t){var a=m(e),r=f(e);if(t)return d.intl.formatMessage({id:"UhMk+M",defaultMessage:"Uploading {filename}"},{filename:s.Emstring.em_snippet(t.name,20)});if(a===c.UPLOADING)return d.intl.formatMessage({id:"sHyWgn",defaultMessage:"Starting upload..."});if(a===c.COMPLETE){if(r>1)return d.intl.formatMessage({id:"1I2L6w",defaultMessage:"Uploaded {num_files} files"},{num_files:r});if(1===r){var o=e.filter((function(e){return e.status!==l.FileStatusType.CANCELLED})).last();return d.intl.formatMessage({id:"JS4aqp",defaultMessage:"Uploaded {filename}"},{filename:s.Emstring.em_snippet(o.name,20)})}return d.intl.formatMessage({id:"5B2AGb",defaultMessage:"Upload canceled"})}return""})(e,t):(function(e){var t=f(e),a=_(e,l.FileStatusType.FAILED);if(t>1){var r=_(e,l.FileStatusType.COMPLETE);return d.intl.formatMessage({id:"bfG+or",defaultMessage:"{count, plural, one{Uploaded {count} of {num_files} files} other{Uploaded {count} of {num_files} files}}"},{count:r,num_files:t})+" - "+d.intl.formatMessage({id:"lTOxVL",defaultMessage:"{count, plural, one{{count} error} other{{count} errors}}"},{count:a})}var o=e.last().errorType;return o===l.UploadErrorType.GENERIC?d.intl.formatMessage({id:"KbJSNk",defaultMessage:"Unable to upload {filename}"},{filename:s.Emstring.em_snippet(e.last().name,20)}):o===l.UploadErrorType.LOCKED_TEAM_ERROR?d.intl.formatMessage({id:"tQ1bJN",defaultMessage:"Can’t upload. Your team no longer has full use of {trademark_business} features."},{trademark_business:u.TRADEMARK_BUSINESS}):d.intl.formatMessage({id:"XwpHsG",defaultMessage:"Unable to upload {filename}: {reason}"},{filename:s.Emstring.em_snippet(e.last().name,20),reason:g(o)})})(e)}(function(e){e.UPLOADING="uploading",e.ERROR="error",e.COMPLETE="complete"})(c||(c={})),t.showInlineUploadStatusSnackbar=function(e){var t,s=e.fileList,u=e.currentUpload,_=e.numSecondsLeft,f=e.onViewDetails,g=e.onShown,y=e.onClosed,T=e.parallelFileUploads,v=m(s);t=v===c.UPLOADING?"sync":v===c.ERROR?"fail":"complete";var b="";v===c.UPLOADING&&_&&(b=" - "+o.format_time_remaining(_));var A=d.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"});v===c.UPLOADING&&(A="");var M=T?s.find((function(e){return e.status===l.FileStatusType.UPLOADING})):u,I=S(s,M);n.Snackbar.manager||"complete"!==t&&"fail"!==t||p.AccessibleAnnounce.polite(I);var U={closeButtonText:A,onCloseClick:function(){i.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0})},onTimeout:function(){i.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0})},actionButtonText:E(s),onActionClick:f,title:I+b,variant:t,timeoutDelayMsForCompleteVariant:15e3,externalProgress:h(s,M),onClosed:y,onShown:g,id:"inline-upload-snackbar",isLowPriority:!0,accessibleAnnouncement:I};n.Snackbar.manager&&(U.timeoutDelayMsForCompleteVariant=void 0),n.Snackbar.update(r.default.createElement(n.Snackbar,a.__assign({},U)))}})),define("modules/clean/react/file_uploader/uploader_modal",["require","exports","tslib","classnames","jquery","react-dom","react","spectrum/button","spectrum/file_icon","spectrum/icon_action","spectrum/icon_chooser","spectrum/icon_inline","spectrum/icon_status","spectrum/modal","spectrum/popover","spectrum/tooltip","modules/clean/browse_interface","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/nearquota_upload_alt_action","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/types","modules/clean/ux_analytics_modal_tracking","modules/clean/viewer","modules/clean/web_user_action_events","modules/core/browser","modules/core/browser_detection","modules/core/exception","modules/core/i18n","retrieval-components/truncated-string"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T,v,b,A,M,I,U,R,C,D,O,L,F,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),s=a.__importStar(s),i=a.__importDefault(i),g=a.__importStar(g),E=a.__importStar(E),y=a.__importStar(y),T=a.__importStar(T),D=a.__importStar(D);var P=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return i.default.createElement("div",{onKeyDown:function(e){27===e.keyCode&&e.isDefaultPrevented()&&e.stopPropagation()},style:{display:"inline-block"}},this.props.children)},t.Capture=function(e){return i.default.createElement("div",{onKeyDown:function(e){27===e.keyCode&&e.preventDefault()}},e.children)},t})(i.default.Component),N=(function(e){function t(t){var a=e.call(this,t)||this;return a.focusChooseButton=function(){o.default(".mc-util-modal-actions-buttons .mc-button-primary").focus()},a.handleStoreChanged=function(){a.setState(a.getStateFromStores())},a.handleFileChoose=function(e){var t=M.uploaderStore.user();e?(a.props.handleFolderChoose(),t&&T.logUploadAction({user:t,action:C.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,chooser_type:I.ChooserType.FOLDER,upload_method:I.UploadMethod.CHOOSER})):(a.props.handleFileChoose(),t&&T.logUploadAction({user:t,action:C.WebUserActionLogEvent.UPLOAD_FILES_CLICK,chooser_type:I.ChooserType.FILE,upload_method:I.UploadMethod.CHOOSER}))},a.handleDone=function(){var e=a.isSomethingUploading(),t=M.uploaderStore.user();e||v.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0}),t&&T.logUploadAction({user:t,action:C.WebUserActionLogEvent.CLOSE_MODAL_CLICK}),a.closeModal()},a.handleCancel=function(e){var t=M.uploaderStore.user();t&&T.logUploadAction({user:t,action:C.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK}),a.props.handleCancelUpload(e)},a.closeModal=function(){v.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),a.props.onModalDismissed&&a.props.onModalDismissed()},a.renderLink=function(e){return i.default.createElement("div",{className:"upload-modal-link"},F.intl.formatMessage({id:"Mhdr6D",defaultMessage:"Having problems? Please try again or see our Help center <a>here</a>."},{a:function(e){return i.default.createElement("a",{href:"/help/space/upload-limitations",rel:"noopener noreferrer",target:"_blank"},e)}}))},a.logAddMoreFilesClick=function(){var e=M.uploaderStore.user();e&&T.logUploadAction({user:e,action:C.WebUserActionLogEvent.ADD_MORE_FILES_CLICK})},a.handleAddMoreToggle=function(e){e.isOpen&&a.logAddMoreFilesClick()},a.renderAddMoreFilesButton=function(e){return i.default.createElement(P,null,i.default.createElement(h.Popover,{onSelection:a.handleFileChoose,onMenuToggle:a.handleAddMoreToggle},i.default.createElement(h.PopoverTrigger,null,i.default.createElement(n.Button,{variant:"secondary",tagName:"span"},F.intl.formatMessage({id:"y1ySNn",defaultMessage:"Add more files"}))),i.default.createElement(h.PopoverContent,{position:"above"},i.default.createElement(P.Capture,null,i.default.createElement(h.PopoverContentItem,{key:"Files",value:!1,className:"action-upload-files",disabled:!1},i.default.createElement(d.IconAction,{name:"upload-file",className:"popover-item-icon"}),F.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"})),i.default.createElement(h.PopoverContentItem,{key:"Folder",value:!0,className:"action-upload-folder",disabled:!1},i.default.createElement(d.IconAction,{name:"upload-folder",className:"popover-item-icon"}),F.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"}))))))},a.handleFileChooseOnlyFiles=function(){a.handleFileChoose(!1),a.logAddMoreFilesClick()},a.state=a.getStateFromStores(),a}return a.__extends(t,e),t.prototype.getStateFromStores=function(){return{path:M.uploaderStore.path(),user:M.uploaderStore.user(),fileList:M.uploaderStore.fileList(),numDraggingFiles:M.uploaderStore.numDraggingFiles(),currentUpload:M.uploaderStore.currentUpload(),numSecondsLeft:M.uploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:M.uploaderStore.hasPermissionToUploadToFolder(),isUploadModalOpen:M.uploaderStore.isUploadModalOpen()}},t.prototype.componentDidMount=function(){M.uploaderStore.add_change_listener(this.handleStoreChanged)},t.prototype.componentDidUpdate=function(e,t){var a=this,r=o.default(".mc-modal").find("#upload-modal-dropzone");this.state.numDraggingFiles?r.length||o.default("#upload-modal-dropzone").clone().prependTo(o.default(".mc-modal")).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1):r.remove(),this.state.fileList.count()>t.fileList.count()&&(this.focusChooseButton(),setTimeout((function(){var e,r=o.default(s.findDOMNode(a.refs.uploadFilesList));r.find(".upload-file")&&(e=r.find(".upload-file").eq(t.fileList.count())),e&&e.length&&r.scrollTop(r.scrollTop()+e.position().top)}),0))},t.prototype.componentWillUnmount=function(){M.uploaderStore.remove_change_listener(this.handleStoreChanged),o.default(window).off("resize.uploaderModal")},t.prototype.isSomethingUploading=function(){return this.state.fileList.some((function(e){return e.status===b.FileStatusType.PENDING||e.status===b.FileStatusType.UPLOADING}))},t.prototype.makeUploadSnippet=function(e){var t,a=this.state,r=a.user,o=a.path,s=R.Viewer.get_viewer();return L.assert(null!=r,"user is null"),s.is_paired&&r.is_team&&(t=s.team_name),s.is_paired?r.is_team?this.makeTeamSnippet(o,e,t):this.makePersonalSnippet(o,e):this.makeUnpairedSnippet(o,e)},t.prototype.makeTeamSnippet=function(e,t,a){var r=S.Emstring.em_snippet(y.filename(e),t);return"/"===e?F.intl.formatMessage({id:"3yCzsM",defaultMessage:"upload to your {team_name} Dropbox"},{team_name:a}):F.intl.formatMessage({id:"qT7k0C",defaultMessage:"upload to the folder ‘{folder}’ in your {team_name} Dropbox"},{folder:r,team_name:a})},t.prototype.makePersonalSnippet=function(e,t){var a=S.Emstring.em_snippet(y.filename(e),t);return"/"===e?F.intl.formatMessage({id:"2NsS1B",defaultMessage:"upload to your personal Dropbox"}):F.intl.formatMessage({id:"JwMP6F",defaultMessage:"upload to the folder ‘{folder}’ in your personal Dropbox"},{folder:a})},t.prototype.makeUnpairedSnippet=function(e,t){var a=S.Emstring.em_snippet(y.filename(e),t);return"/"===e?F.intl.formatMessage({id:"JVgEKY",defaultMessage:"upload to your Dropbox"}):F.intl.formatMessage({id:"fZwvxY",defaultMessage:"upload to the folder ‘{folder}’"},{folder:a})},t.prototype.renderDropzone=function(){var e=F.intl.formatMessage({id:"Q7DkIp",defaultMessage:"{count, plural, one{Drop your file to {upload_action}} other{Drop your files to {upload_action}}}"},{count:this.state.numDraggingFiles,upload_action:this.makeUploadSnippet(20)});return i.default.createElement("div",{ref:"dropzone",id:"upload-modal-dropzone",style:{display:"none"}},e)},t.prototype.createCancelFileHandler=function(e){var t=this;return function(a){return a.preventDefault(),t.handleCancel(e)}},t.prototype.renderFileListRowStatus=function(e){return e.status===b.FileStatusType.UPLOADING&&100===e.percentUploaded?i.default.createElement("div",{className:"status-col"},i.default.createElement(c.IconStatus,{name:"sync"})):e.status===b.FileStatusType.PENDING||e.status===b.FileStatusType.UPLOADING?i.default.createElement("div",{className:"status-col"},i.default.createElement(n.Button,{variant:"borderless",className:"upload-cancel-button",onClick:this.createCancelFileHandler(e)},i.default.createElement(u.IconChooser,{name:"search-cancel","aria-label":F.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})}))):e.status===b.FileStatusType.COMPLETE?i.default.createElement("div",{className:"status-col"},i.default.createElement(c.IconStatus,{name:"complete","aria-label":F.intl.formatMessage({id:"F5izuk",defaultMessage:"Completed"}),role:"status"})):e.status===b.FileStatusType.CANCELLED?i.default.createElement("div",{className:"status-col"},i.default.createElement(c.IconStatus,{name:"warn","aria-label":F.intl.formatMessage({id:"5B2AGb",defaultMessage:"Upload canceled"}),role:"status"})):e.status===b.FileStatusType.FAILED?i.default.createElement("div",{className:"status-col"},i.default.createElement(c.IconStatus,{name:"fail","aria-label":F.intl.formatMessage({id:"fy9qFc",defaultMessage:"Error"}),role:"status"})):i.default.createElement("div",{className:"status-col"})},t.prototype.renderFileListRowError=function(e){var t,a;return t=e.errorMessage&&e.errorMessage.length>0?e.errorMessage:F.intl.formatMessage({id:"RVsdJD",defaultMessage:"Something went wrong while uploading this file."}),a=e.errorType===b.UploadErrorType.FILE_SIZE_ERROR?F.intl.formatMessage({id:"oHBKTq",defaultMessage:"File too large"}):F.intl.formatMessage({id:"GWmSVK",defaultMessage:"Upload Error"}),L.assert(null!=this.state.user,"user is null"),this.state.user.is_team&&e.errorType===b.UploadErrorType.OVER_QUOTA_ERROR&&!this.props.isContentManager&&(t=F.intl.formatMessage({id:"5pKEiG",defaultMessage:"Your Dropbox account is full. To add this file, remove files or ask your admin for more space."}),a=F.intl.formatMessage({id:"xW4p7B",defaultMessage:"Can’t upload file"})),i.default.createElement("div",{className:"error-col"},i.default.createElement("span",{className:"error-msg"},a),i.default.createElement("span",{className:"error-details"},i.default.createElement(_.Tooltip,{positioning:"right",tooltipContent:t},i.default.createElement("div",{className:"error-details-tooltip-target",tabIndex:0},i.default.createElement(p.IconInline,{name:"info","aria-label":F.intl.formatMessage({id:"+SX5vq",defaultMessage:"More information"})})))))},t.prototype.renderFileListRowDest=function(e){if(e.status===b.FileStatusType.CANCELLED)return i.default.createElement("div",{className:"dest-col"},F.intl.formatMessage({id:"+ECsZb",defaultMessage:"Canceled"}));var t=void 0,a=void 0,r=R.Viewer.get_viewer().get_user_by_id(e.userId);return this.props.isContentManager?(t="",a=this.props.getCMUriForFqPath(e.dest)):(t=f.get_browse_root_name(r),a=f.browse_uri_for_fq_path(r,e.dest).toString()),i.default.createElement("div",{className:"dest-col"},i.default.createElement("a",{href:a},i.default.createElement(w.TruncatedString,{text:""+t+e.dest,variant:w.TruncatedStringVariant.TRUNCATED_STRING_START})))},t.prototype.renderFileListRowContent=function(e,t){return e.status!==b.FileStatusType.FAILED&&t?this.renderFileListRowDest(e):this.renderFileListRowError(e)},t.prototype.renderFileListRow=function(e,t){var a;a=e.status===b.FileStatusType.UPLOADING?e.percentUploaded:e.status===b.FileStatusType.PENDING?0:100;var o={"upload-file":!0,complete:e.status===b.FileStatusType.COMPLETE,cancelled:e.status===b.FileStatusType.CANCELLED,error:e.status===b.FileStatusType.FAILED},s=r.default(o),n=S.Emstring.em_snippet(e.name,15),d=e.size?E.format_bytes(e.size):"";return i.default.createElement("li",{className:s,key:e.uploadId,style:{backgroundSize:a+"% 4px"}},i.default.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},i.default.createElement("div",{className:"filename-col"},i.default.createElement(l.FileIcon,{className:"brws-file-name-cell-icon",path:e.name,role:"presentation"}),i.default.createElement("span",{className:"filename"}," ",n," "),i.default.createElement("span",{className:"size"}," ",d," ")),this.renderFileListRowContent(e,t),this.renderFileListRowStatus(e)))},t.prototype.renderFileList=function(e,t){var a=this;return i.default.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map((function(e){return a.renderFileListRow(e,t)})))},t.prototype.renderTimeLeft=function(){var e=this.isSomethingUploading()&&this.state.numSecondsLeft?g.format_time_remaining(this.state.numSecondsLeft):"";return i.default.createElement("div",{style:{marginTop:8,textAlign:"right",minHeight:"1.25em",lineHeight:"1.25"}},e)},t.prototype.renderTitle=function(){return L.assert(null!=this.state.user,"user is null"),this.props.isTeamOnboarding?F.intl.formatMessage({id:"RW3b5j",defaultMessage:"Which files would you like to add?"}):this.state.user.is_cdm_member&&this.props.overQuotaStatus in[b.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,b.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA]?F.intl.formatMessage({id:"s2XJI8",defaultMessage:"More space needed"}):F.intl.formatMessage({id:"J7yt8I",defaultMessage:"Upload details"})},t.prototype.getAltAction=function(){if(this.state.fileList.some((function(e){return e.status===b.FileStatusType.COMPLETE}))&&this.props.overQuotaStatus===b.OverQuotaStatusType.BASIC_NEAR_QUOTA){var e=A.getNearquotaUploadAltActionOQA(this.props.lastFileUploadMethod,D.get_uri().path);return i.default.createElement(A.NearquotaUploadAltAction,{oqa:e})}return null},t.prototype.render=function(){var e=this.isSomethingUploading()?F.intl.formatMessage({id:"NNi2D+",defaultMessage:"Hide"}):F.intl.formatMessage({id:"6bRQ0U",defaultMessage:"Done"}),t=this.renderTitle(),r=O.is_input_webkitdirectory_supported()?{secondaryAction:this.renderAddMoreFilesButton}:{secondaryAction:F.intl.formatMessage({id:"y1ySNn",defaultMessage:"Add more files"}),onSecondaryAction:this.handleFileChooseOnlyFiles};return i.default.createElement("div",{ref:"container"},this.renderDropzone(),i.default.createElement(m.UtilityModal,a.__assign({},r,{ariaLabel:t,title:t,open:this.state.isUploadModalOpen,width:"640px",overlayClickClose:!0,shouldRequestCloseOnActions:!1,onRequestClose:this.closeModal,primaryAction:e,onPrimaryAction:this.handleDone,link:this.renderLink,onReady:this.focusChooseButton,appElement:document.getElementById("embedded-app"),shouldFocusAfterRender:!0}),i.default.createElement(U.UXAnalyticsModalTracking,{id:"uploader-modal"}),this.renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this.renderTimeLeft(),this.getAltAction()))},t})(i.default.PureComponent);t.UploaderModal=N})),define("modules/clean/react/overquota_modal",["require","exports","tslib","react","spectrum/tertiary_link","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/analytics","modules/clean/static_urls","spectrum-sharing/utils/sharing_constants","modules/clean/react/modal","modules/constants/payments","modules/clean/react/overquota_modal_helpers","modules/clean/react/teams/over_quota_join_team/constants"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),c=a.__importStar(c);var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dismiss=function(){p.Modal.close(),t.trackCancel(),t.props.onClose&&t.props.onClose()},t.trackCTAClick=function(){var e=t.props.ctaTextUntranslated,a=e?e.toLowerCase():"";t.trackShareTibEvent("OUT_OF_QUOTA_MODAL_UPGRADE"),l.NQOQLogger.logAcceptModal(t.props.oqa,{modal_type:"billboard",cta_text:a}),t.props.isRequestModal&&l.GrowthEventsLogger.log("oq_fr",{action:"click",button_text:"Get more space",destination_url:"http://www.dropbox.com/upgrade",location:"overlay",quota_status:"over",upsell_type:"modal"}),t.props.onSubmit&&t.props.onSubmit()},t.trackShareTibEvent=function(e){var a=t.props.ctaTextUntranslated;if(t.props.activeUser){var r=u.SHARE_ACTION_ORIGIN_TYPE.SYNC_MODAL,o=h.constructJoinTeamLandingPageUri(t.props.nsId,h.OqNqJoinTeamOriginType.SHARE_EMAIL);l.ShareTibEventLogger.log(t.props.activeUser.id,e,r,{ns_id:t.props.nsId,usage_remaining:t.props.usageRemaining,usage_needed:t.props.usageNeeded,cta_text:a?a.toLowerCase():"",cta_url:o,referrer:u.SHARE_ACTION_ORIGIN_TYPE.SHARE_PAGE_FROM_EMAIL})}},t.onClose=function(){t.trackClose(),t.props.onClose&&t.props.onClose()},t.trackClose=function(){l.NQOQLogger.logCloseModal(t.props.oqa,{modal_type:"billboard"})},t.trackCancel=function(){l.NQOQLogger.logCancelModal(t.props.oqa,{modal_type:"billboard"})},t._renderButtons=function(){return r.default.createElement(p.ModalButtons,{className:"oq-modal__buttons"},r.default.createElement("a",{href:t.getMoreSpaceUrl(),id:"oq-cta-button",className:"mc-button mc-button-primary",onClick:t.trackCTAClick},t.props.ctaText))},t}return a.__extends(t,e),t.prototype.getMoreSpaceUrl=function(){if(this.props.ctaUrl)return this.props.ctaUrl;var e=this.props.oqa;return-1!==e.search("_nq_")?c.LOW_SPACE_URL+"?oqa="+e:c.OUT_OF_SPACE_URL+"?oqa="+e},t.prototype._renderAltAction=function(){return this.props.dismissText?r.default.createElement("div",{className:"overquota_modal__alt-action-container"},r.default.createElement(o.TertiaryLink,{onClick:this.dismiss},this.props.dismissText)):null},t.prototype._renderContentTitle=function(){return r.default.createElement("p",{className:"oq-modal__content--title"},this.props.headline)},t.prototype._renderImage=function(){if(this.props.imageObject){var e=this.props.imageObject,t=e.height,a=e.width,o=e.src,s=e.srcHiRes;return r.default.createElement(i.Image,{height:t,width:a,src:d.static_url(o),srcHiRes:d.static_url(s)})}},t.prototype.render=function(){return r.default.createElement(p.Modal,{className:"overquota_modal",title:this.props.headline,buttonComponent:this._renderButtons(),altAction:this._renderAltAction(),style:"clean",showX:this.props.showX,onDismiss:this.onClose},r.default.createElement("div",{className:"oq-modal__content"},this._renderImage(),this._renderContentTitle(),r.default.createElement("p",null,this.props.tagline)))},t.defaultProps={headline:n.intl.formatMessage({id:"0eDgXK",defaultMessage:"Your Dropbox is full"}),tagline:n.intl.formatMessage({id:"/5zkWm",defaultMessage:"Before you can update or move your files, you need more space."}),imageObject:m.constructImageObject(),oqa:"",ctaText:n.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"}),ctaTextUntranslated:"Get more space",showX:!0},t})(r.default.Component);t.OverquotaModalElement=_,t.OverquotaModal=s.requireCssWithComponent(_,["/static/css/react/overquota_modal-vflQ8B8Ly.css"])})),define("modules/clean/sharing/out_of_quota_modal",["require","exports","tslib","modules/clean/analytics","modules/clean/display_format","modules/clean/em_string","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/overquota_modal","modules/clean/react/overquota_modal_helpers","modules/clean/react/sprite","modules/clean/react/teams/over_quota_join_team/constants","spectrum-sharing/utils/sharing_constants","modules/clean/sharing/views/hover_close_button","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/payments","modules/core/browser","modules/core/i18n","modules/core/uri","react"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=a.__importStar(o),m=a.__importDefault(m),_=a.__importStar(_),f=a.__importStar(f),g=a.__importStar(g);var T=(function(e){function t(t){var a=e.call(this,t)||this;return a.ASK="ask",a.ASKING="asking",a.handleModalClose=function(){var e=a.props.queryParams;r.NQOQLogger.logCloseModal(e,{modal_type:"billboard"}),a.refs.modal.close(),a.logClose()},a.onDismiss=function(){var e=a.props.queryParams;r.NQOQLogger.logCloseModal(e,{modal_type:"billboard"}),a.logClose()},a.logClose=function(){var e=_.start_time(),t=(new Date).getTime();r.ShareTibEventLogger.log(a.props.activeUser.id,"OUT_OF_QUOTA_MODAL_CLOSE",c.SHARE_ACTION_ORIGIN_TYPE.OUT_OF_QUOTA_MODAL,{timing:t-e,ns_id:a.props.nsId})},a._handleDismissText=function(){n.Modal.close(),a.onDismiss()},a.renderContents=function(){var e=a.state.showX;return y.default.createElement("div",{className:"content-link-sync-modal__content u-mar-bottom-xs"},y.default.createElement("div",{className:"content-link-sync-modal__top-panel u-pad-s"},y.default.createElement("div",{className:"content-link-sync-modal__icon"},y.default.createElement(u.Sprite,{alt:"",group:"web",name:"folder_user_32"})),y.default.createElement("div",{className:"content-link-sync-modal__name-size u-l-ib u-pad-left-xs u-pad-top-xs o-flag__flex"},y.default.createElement("h3",{className:"u-font-strong"},s.Emstring.em_snippet(a.props.folderName,c.SNIPPET_SIZES.OUT_OF_QUOTA_FOLDER_NAME)),y.default.createElement("h4",{className:"u-trim-margin u-font-meta"},o.format_bytes(a.props.folderSize))),e&&y.default.createElement("div",{className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},y.default.createElement(m.default,{onClick:a.handleModalClose}))),y.default.createElement("div",{className:"content-link-sync-modal__tip-panel"},y.default.createElement("div",{className:"content-link-sync-modal__access-text"},a.getTitleText()),y.default.createElement("div",{className:"content-link-sync-modal__tip-body"},a.getTipText())))},a.getTipText=function(){return a.isLimitedCdmTeam()?a.getLimitedCdmTeamMessage():a.props.activeUser.is_team?y.default.createElement("div",null,y.default.createElement("div",null,E.intl.formatMessage({id:"CyRaJu",defaultMessage:"Your Dropbox account is full."})),y.default.createElement("div",null,E.intl.formatMessage({id:"N4ec+j",defaultMessage:"To add this folder, remove files or ask your admin for more space."}))):a.props.usageRemaining>0?E.intl.formatMessage({id:"ARfvq4",defaultMessage:"To add this folder, you’ll need {needed} of space in your Dropbox. You currently have {remaining} of space left."},{remaining:o.format_bytes(a.props.usageRemaining),needed:o.format_bytes(a.props.usageNeeded)}):E.intl.formatMessage({id:"wZBdwd",defaultMessage:"To add this folder, you’ll need {needed} of space in your Dropbox. You currently have no space left."},{needed:o.format_bytes(a.props.usageNeeded)})},a.renderButtons=function(){var e=a.getCtaText();return y.default.createElement("div",{className:"content-link-sync-modal__buttons u-mar-bottom-s"},y.default.createElement(i.button,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:a.state.state===a.ASKING,onClick:a.onUpgradeButtonClicked},e),a._renderDismissButton())},a.onUpgradeButtonClicked=function(){a.setState({state:a.ASKING}),a.isLimitedCdmTeamMember()&&(window.location.href=a.props.promptAdminToUpgradeEmailUrl);var e=a.props.queryParams,t={oqa:e},o="wb_nq_shm_share_w"===e||"wb_nq_shm_share_ro"===e?f.LOW_SPACE_URL:f.OUT_OF_SPACE_URL,s=h.Viewer.get_viewer();a.props.activeUser.is_team&&s.team_is_limited&&a.props.numMembersOnTeam>1?(o="/team/upgrade",a.props.activeUser.is_team_admin||(t.open_admin_prompt_modal="1")):a.props.activeUser.is_team?(o="/help/business/space-limit-full",t={}):r.NQOQLogger.logAcceptModal(e,{modal_type:"billboard",cta_text:"upgrade to add folder"});var i=c.SHARE_ACTION_ORIGIN_TYPE.OUT_OF_QUOTA_MODAL;r.ShareTibEventLogger.log(a.props.activeUser.id,"OUT_OF_QUOTA_MODAL_UPGRADE",i,{ns_id:a.props.nsId,cta_text:"upgrade to add folder",cta_url:o,usage_remaining:a.props.usageRemaining,usage_needed:a.props.usageNeeded}),g.redirect(new S.URI({path:o}).updateQuery(t).toString())},a.getLimitedCdmTeamMessage=function(){var e=E.intl.formatMessage({id:"rzQc7n",defaultMessage:"You need an additional {space_needed} in your Dropbox to add this folder."},{space_needed:o.format_bytes(a.props.usageNeeded)});return a.props.activeUser.is_team_admin||!a.props.teamAdminInfo.num_admins?e:E.intl.formatMessage({id:"ceBnJy",defaultMessage:"{space_needed_sentence} To get more space, ask your Dropbox admin ({admin_email})."},{space_needed_sentence:e,admin_email:a.props.teamAdminInfo.admin_email})},a.getTitleText=function(){return a.isLimitedCdmTeam()?E.intl.formatMessage({id:"s2XJI8",defaultMessage:"More space needed"}):a.props.activeUser.is_team?E.intl.formatMessage({id:"++wAXq",defaultMessage:"Can’t add folder"}):E.intl.formatMessage({id:"R4XFxQ",defaultMessage:"Not enough space"})},a.getCtaText=function(){return a.isLimitedCdmTeam()?a.props.activeUser.is_team_admin||!a.props.teamAdminInfo.num_admins?E.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"}):E.intl.formatMessage({id:"ZRqrRy",defaultMessage:"Email {admin_fname}"},{admin_fname:a.props.teamAdminInfo.admin_fname}):a.props.activeUser.is_team?E.intl.formatMessage({id:"K2PjtT",defaultMessage:"Learn more about Dropbox space"}):E.intl.formatMessage({id:"TZD+x6",defaultMessage:"Upgrade to add folder"})},a.isLimitedCdmTeam=function(){return a.props.activeUser.is_cdm_member&&h.Viewer.get_viewer().team_is_limited},a.isLimitedCdmTeamMember=function(){return a.isLimitedCdmTeam()&&!a.props.activeUser.is_team_admin&&a.props.teamAdminInfo.num_admins>0},a.state={state:a.ASK,showX:!0},a}return a.__extends(t,e),t.prototype.componentWillMount=function(){var e=_.start_time(),t=(new Date).getTime(),o=h.Viewer.get_viewer().get_users(),s=o.length>0?o[0].id:null,i=null;if(this.props.expBasicNearOrOverQuotaJoinTeam&&(i=p.getModalConfigNearOrOverQuotaJoinTeam()),this.setState(a.__assign({},i)),s){var n=c.SHARE_ACTION_ORIGIN_TYPE.OUT_OF_QUOTA_MODAL;r.ShareTibEventLogger.log(s,"OUT_OF_QUOTA_MODAL_RENDER",n,{cta_text:(null==i?void 0:i.buttonTextUntranslated)||this.getCtaText(),timing:t-e,ns_id:this.props.nsId})}},t.prototype._renderDismissButton=function(){return this.state.secondaryCtaText&&this.state.secondaryCtaText.length?y.default.createElement("button",{className:"content-link-sync-modal__not-now-label button-as-link",onClick:this._handleDismissText},this.state.secondaryCtaText):null},t.prototype.render=function(){return y.default.createElement(n.Modal,{autoClose:!1,buttonComponent:this.renderButtons(),className:"content-link-sync-modal",clickOutToClose:!1,ref:"modal",showX:!1,title:"",onDismiss:this.onDismiss},this.renderContents())},t.displayName="OutOfQuotaModal",t})((y=a.__importDefault(y)).default.Component);t.OutOfQuotaModal=T;t.showOutOfQuotaModal=function(e){var t=e.expBasicNearOrOverQuotaJoinTeam?p.getModalConfigNearOrOverQuotaJoinTeam():{buttonText:E.intl.formatMessage({id:"TZD+x6",defaultMessage:"Upgrade to add folder"}),buttonTextUntranslated:"Upgrade to add folder"},a=t.buttonText,o=t.buttonTextUntranslated,s=e.queryParams,i=d.constructImageObject();n.Modal.showInstance(y.default.createElement(l.OverquotaModal,{headline:E.intl.formatMessage({id:"R4XFxQ",defaultMessage:"Not enough space"}),tagline:E.intl.formatMessage({id:"TGEyA+",defaultMessage:"To add this folder, you’ll need more space in your Dropbox."}),oqa:s,imageObject:i,ctaText:a,ctaTextUntranslated:o,showX:!0,activeUser:e.activeUser,nsId:e.nsId,usageRemaining:e.usageRemaining,usageNeeded:e.usageNeeded})),r.NQOQLogger.logViewModal(s,{modal_type:"billboard"})}})),define("modules/clean/sharing/share_page/actions",["require","exports","tslib","react","react-dom","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/api_v2/user_client","modules/clean/display_format","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/clean/history","modules/clean/react/modal","modules/clean/sharing/api/client","modules/clean/sharing/async_share_modal_util","modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal","modules/clean/sharing/confirmation_modals/reset_access_modal","spectrum-sharing/utils/sharing_constants","modules/clean/sharing/share_page/action_types","modules/clean/sharing/share_page/store","modules/clean/sharing/share_page/tab_actions","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/share_page_redesign","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/viewer","modules/clean/web_timing_logger","modules/core/browser","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E,S,y,T,v,b,A,M,I,U,R,C,D){"use strict";var O;Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),s=a.__importStar(s),d=a.__importStar(d),c=a.__importDefault(c),_=a.__importStar(_),f=a.__importStar(f),b=a.__importStar(b),R=a.__importStar(R),C=a.__importStar(C),t.FileListingFetcher=T.FileListingFetcher,t.FolderListingFetcher=T.FolderListingFetcher,t.RecentFileListingFetcher=T.RecentFileListingFetcher,t.RecentFolderListingFetcher=T.RecentFolderListingFetcher;var L=v.SharePageTab.RECENT,F={initialize:function(e){var t=(e=e||{}).containerId,a=e.groupsEnabled||!1,r=e.activeUserId||null,s=e.expProShareUpsellModalFileAttr||null,i=e.expSubgrowthProShareModalIllustration||null,n=e.numMembersOnTeam||0,d=null!=e.pageSize?e.pageSize:100,p=e.teamAdminInfo||null,m=e.promptAdminToUpgradeEmailUrl||null,_=e.disablePrefetchFallback||!1,f=e.searchBarExperiments||null,g=!0===e.logSharePageApplicationCodeStart,E=e.expBasicNearOrOverQuotaJoinTeam||null,y={variant:e.expSubgrowthProSharePageUpdates&&e.expSubgrowthProSharePageUpdates.variant?e.expSubgrowthProSharePageUpdates.variant:"CONTROL",quotaType:e.expSubgrowthProSharePageUpdates&&e.expSubgrowthProSharePageUpdates.quotaType?e.expSubgrowthProSharePageUpdates.quotaType:null},v=e.viewer||null;if(g&&R.log_js_modules_application_code_start(),this.expProShareUpsellModalFileAttr=s,this.expSubgrowthProShareModalIllustration=i,this.pageSize=d,this.disablePrefetchFallback=_,this.searchBarExperiments=f,this.expBasicNearOrOverQuotaJoinTeam=E,this.expSubgrowthProSharePageUpdates=y,a&&"groups"===C.get_hash())return R.set_tti_exclusion_flow("groups_tab_redirect"),void C.redirect("/team#groups");null==v&&(v=U.Viewer.get_viewer()),u.Dispatcher.dispatch({type:S.SharePageActionTypes.INITIALIZE,viewer:v});var b=null!=v?v.get_users():void 0;this.folderRowActionsByUserId={},this.fileRowActionsByUserId={},this.folderShareApiClientByUserId={},this.fileShareApiClientByUserId={};for(var A=0,M=b;A<M.length;A++){var I=M[A];this.folderShareApiClientByUserId[I.id]=new h.FolderShareApiClient({userId:I.id,client:new l.UserApiV2Client}),this.folderRowActionsByUserId[I.id]=new w({user:I,client:this.folderShareApiClientByUserId[I.id],expProShareUpsellModalFileAttr:this.expProShareUpsellModalFileAttr,expSubgrowthProShareModalIllustration:this.expSubgrowthProShareModalIllustration,expSubgrowthProSharePageUpdates:this.expSubgrowthProSharePageUpdates,numMembersOnTeam:n,teamAdminInfo:p,promptAdminToUpgradeEmailUrl:m}).actions,this.fileShareApiClientByUserId[I.id]=new h.FileShareApiClient({userId:I.id,client:new l.UserApiV2Client}),this.fileRowActionsByUserId[I.id]=new N({user:I,client:this.fileShareApiClientByUserId[I.id]}).actions}return T.SharePageTabActions.initialize({pageSize:this.pageSize,disablePrefetchFallback:this.disablePrefetchFallback,folderShareApiClientByUserId:this.folderShareApiClientByUserId,fileShareApiClientByUserId:this.fileShareApiClientByUserId}),u.Dispatcher.dispatch({type:S.SharePageActionTypes.SWITCH_USER,userId:r}),c.default.add_callback("/share",this.handleHistoryChange.bind(this),!1),this._fetchInitialData(b),o.default.render(F.getPageElement(),document.getElementById(t))},getPageElement:function(){var e=p.listenToStores(A.SharePageRedesign,{SharePageStore:y.SharePageStore},x);return r.default.createElement(e,{fileTabActions:{onEmailWantToVerify:this.handleEmailWantToVerify.bind(this,s.GENERIC)},fileRowActionsByUserId:this.fileRowActionsByUserId,folderRowActionsByUserId:this.folderRowActionsByUserId,folderTabActions:{onEmailWantToVerify:this.handleEmailWantToVerify.bind(this,s.SHARE_FOLDER),onNewSharedFolderClick:I.asyncShowShareAFolderWizardModal},recentTabActions:{onEmailWantToVerify:this.handleEmailWantToVerify.bind(this,s.SHARE_FOLDER)},linkTabActions:{onEmailWantToVerify:this.handleEmailWantToVerify.bind(this,s.GENERIC)},isMaestroDesign:!0,onChangeTab:function(e){return T.SharePageTabActions.handleChangeTab(e)},searchBarExperiments:this.searchBarExperiments,expSubgrowthProSharePageUpdates:this.expSubgrowthProSharePageUpdates,expBasicNearOrOverQuotaJoinTeam:this.expBasicNearOrOverQuotaJoinTeam})},_fetchInitialData:function(e){for(var t=0,a=e;t<a.length;t++){var r=a[t];this._fetchTeamPolicy(r,3)}var o=C.get_uri().getPath();if(0===o.indexOf("/share")){var s=o.substr("/share".length+1);return this.handleHistoryChange(s,{})}return T.SharePageTabActions.handleChangeTab(L,!0,!1)},_fetchTeamPolicy:function(e,t,a){var r=this;return t<=0?(M.sharingNotificationError(D.intl.formatMessage({id:"A4nKxB",defaultMessage:"There was an error retrieving your account information."})),void("function"==typeof a&&a())):(u.Dispatcher.dispatch({type:S.SharePageActionTypes.FETCH_TEAM_POLICY_REQUEST,user:e}),this.folderShareApiClientByUserId[e.id].getCurrentAccountCached().then((function(t){return u.Dispatcher.dispatch({type:S.SharePageActionTypes.FETCH_TEAM_POLICY_SUCCESS,teamPolicy:null!=t.team?t.team.sharing_policies:void 0,user:e}),"function"==typeof a?a():void 0})).catch(n.catchApiError((function(o){return u.Dispatcher.dispatch({type:S.SharePageActionTypes.FETCH_TEAM_POLICY_ERROR,user:e}),r._fetchTeamPolicy(e,t-1,a)}))))},handleHistoryChange:function(e,t){var a=B[e];return null==a&&(c.default.replace_state("/share/"+k[L]),a=L),T.SharePageTabActions.handleChangeTab(a,!0,!1)},handleEmailWantToVerify:function(t){var r=y.SharePageStore.getCurrentUser();return new Promise((function(t,a){e(["modules/clean/account/email"],t,a)})).then(a.__importStar).then((function(e){e.EmailVerification.get_for_user(r).verified_or_send_and_show(t,r.is_email_verified?void 0:C.reload)}))}};t.SharePageActions=F;var w=(function(){function t(e){e=e||{},this.logClickFolder=this.logClickFolder.bind(this),this.user=e.user,this.client=e.client||null,this.expBasicNearOrOverQuotaJoinTeam=e.expBasicNearOrOverQuotaJoinTeam,this.expProShareUpsellModalFileAttr=e.expProShareUpsellModalFileAttr||null,this.expSubgrowthProShareModalIllustration=e.expSubgrowthProShareModalIllustration||null,this.expSubgrowthProSharePageUpdates=e.expSubgrowthProSharePageUpdates||null,this.numMembersOnTeam=e.numMembersOnTeam||0,this.teamAdminInfo=e.teamAdminInfo||null,this.promptAdminToUpgradeEmailUrl=e.promptAdminToUpgradeEmailUrl||null,null==this.client&&(this.client=new h.FolderShareApiClient({userId:this.user.id,client:new l.UserApiV2Client})),this.actions={logClickFolder:this.logClickFolder,onMountClick:this.handleMountClickRedesign.bind(this),onRelinquishMembershipClick:this.handleRelinquishMembershipClick.bind(this),onDownloadClick:this.handleDownloadClick.bind(this),onShareClick:this.handleShareClick.bind(this),onUnmountClick:this.handleUnmountClick.bind(this),onUnshareClick:this.handleUnshareClick.bind(this),onViewFolderClick:this.handleViewFolderClick.bind(this)}}return t.prototype.handleMountClick=function(t){var r=this;return u.Dispatcher.dispatch({type:S.SharePageActionTypes.MOUNT_FOLDER_REQUEST,metadata:t,user:this.user}),this.client.mount({contentId:t.shared_folder_id}).then((function(o){return new Promise((function(t,a){e(["modules/clean/sharing/shared_content_link_handle_folder_mount_done"],t,a)})).then(a.__importStar).then((function(e){(0,e.handleFolderMountDone)(r.user,o,t.is_team_folder,t.can_mount||!1,t.folder_size,t.permissions)}))})).catch(n.catchApiError((function(o){if(u.Dispatcher.dispatch({type:S.SharePageActionTypes.MOUNT_FOLDER_ERROR,user:r.user,metadata:t}),"insufficient_quota"===(null!=o.error?o.error[".tag"]:void 0)&&null!=(null!=o.error?o.error.space_left:void 0)){var s=b.getOutOfQuotaVars(t,o);return s.numMembersOnTeam=r.numMembersOnTeam,s.teamAdminInfo=r.teamAdminInfo,s.promptAdminToUpgradeEmailUrl=r.promptAdminToUpgradeEmailUrl,s.activeUser=r.user,s.expProShareUpsellModalFileAttr=r.expProShareUpsellModalFileAttr,s.expSubgrowthProShareModalIllustration=r.expSubgrowthProShareModalIllustration,s.expBasicNearOrOverQuotaJoinTeam=r.expBasicNearOrOverQuotaJoinTeam,new Promise((function(t,a){e(["modules/clean/sharing/out_of_quota_modal"],t,a)})).then(a.__importStar).then((function(e){(0,e.showOutOfQuotaModal)(s)}))}return M.sharingNotificationError(D.intl.formatMessage({id:"1dh2zK",defaultMessage:"We were unable to complete your request."}))})))},t.prototype.handleMountClickRedesign=function(t,r){var o;return a.__awaiter(this,void 0,void 0,(function(){var s,i,n,l,u,p,c,m,h,_=this;return a.__generator(this,(function(f){return s="reader"===r.access_type?"can_view":"can_edit",i=r.name,n=r.folder_size?r.folder_size:0,l=d.format_bytes(n,2),u=r.shared_folder_id,p=r.preview_url,c=null===(o=r.can_mount)||void 0===o||o,m={access_level:s,sync_folder_name:i,sync_folder_size:l,sync_ns_id:u,sync_preview_url:p,sync_role:t.role,sync_out_of_quota_qp:!c,exp_basic_near_or_over_quota_join_team:this.expBasicNearOrOverQuotaJoinTeam},h={activeUserId:t.id,isPagelet:!0,isMaestroDesign:!0,loadSharePageInBackground:!1,logSharePageApplicationCodeStart:!1,syncVars:m,metadata:r},[2,new Promise((function(t,a){e(["modules/clean/sharing/async_shared_content_link_sync_utils"],t,a)})).then(a.__importStar).then((function(e){return e.asyncSharedContentLinkSyncUtilsInitialize.bind(_,h)()}))]}))}))},t.prototype.handleRelinquishMembershipClick=function(e){var t=this,a=null!=e.parent_shared_folder_id,r=null!=e.path_lower;return f.showRelinquishMembershipConfirmationModal(!0,a,(function(){return t.relinquishMembership(e),m.Modal.close()}),P,r)},t.prototype.relinquishMembership=function(e){var t=this;return u.Dispatcher.dispatch({type:S.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_REQUEST,metadata:e,user:this.user}),this.client.relinquishMembership({contentId:e.shared_folder_id}).then((function(){return M.sharingNotificationSuccess(D.intl.formatMessage({id:"tCwBHH",defaultMessage:"You have removed your own access to this folder."})),u.Dispatcher.dispatch({type:S.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS,metadata:e,user:t.user})})).catch(n.catchApiError((function(){return M.sharingNotificationError(D.intl.formatMessage({id:"nZhREZ",defaultMessage:"We were unable to complete your request."})),u.Dispatcher.dispatch({type:S.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_ERROR,metadata:e,user:t.user})})))},t.prototype.handleShareClick=function(e){return _.asyncShowShareModal(this.user,{fqPath:e.path_lower,isFolder:!0,isTeamSharedFolder:e.is_team_folder,origin:E.SHARE_ACTION_ORIGIN_TYPE.SHARE,targetNsId:e.shared_folder_id})},t.prototype.handleUnmountClick=function(e){var t=this;return u.Dispatcher.dispatch({type:S.SharePageActionTypes.UNMOUNT_FOLDER_REQUEST,metadata:e,user:this.user}),this.client.unmount({contentId:e.shared_folder_id}).then((function(){var a=e.set("path_lower",null).setIn(["permissions","unmount","allow"],!1);return u.Dispatcher.dispatch({type:S.SharePageActionTypes.UNMOUNT_FOLDER_SUCCESS,metadata:a,user:t.user}),M.sharingNotificationSuccess(D.intl.formatMessage({id:"1PU8LZ",defaultMessage:"This folder has been successfully removed from your Dropbox."}))})).catch(n.catchApiError((function(a){return u.Dispatcher.dispatch({type:S.SharePageActionTypes.UNMOUNT_FOLDER_ERROR,metadata:e,user:t.user}),M.sharingNotificationError(D.intl.formatMessage({id:"viK6c+",defaultMessage:"We were unable to complete your request."}))})))},t.prototype.handleUnshareClick=function(e){var t=this;return g.confirmResetAccess({allowLeaveACopy:null!=e.permissions.leave_a_copy?e.permissions.leave_a_copy.allow:void 0,contentName:e.name,isFolder:!0,isNestedSharedFolder:null!=e.parent_shared_folder_id,onCancel:P,onConfirm:function(a){return t.unshareFolder(e,a),m.Modal.close()}})},t.prototype.unshareFolder=function(e,t){var a=this;return void 0===t&&(t=!1),u.Dispatcher.dispatch({type:S.SharePageActionTypes.UNSHARE_FOLDER_REQUEST,metadata:e,user:this.user}),this.client.unshare({contentId:e.shared_folder_id,leaveACopy:t}).then((function(){return u.Dispatcher.dispatch({type:S.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS,metadata:e,user:a.user}),M.sharingNotificationSuccess(D.intl.formatMessage({id:"O4leSN",defaultMessage:"This folder has been successfully unshared."}))})).catch(n.catchApiError((function(t){return u.Dispatcher.dispatch({type:S.SharePageActionTypes.UNSHARE_FOLDER_ERROR,metadata:e,user:a.user}),M.sharingNotificationError(D.intl.formatMessage({id:"rhXtn/",defaultMessage:"We were unable to complete your request."}))})))},t.prototype.handleViewFolderClick=function(e){return this.logClickFolder(e),C.open_tab(e.preview_url)},t.prototype.handleDownloadClick=function(t){return a.__awaiter(this,void 0,void 0,(function(){var r=this;return a.__generator(this,(function(o){return new Promise((function(t,a){e(["modules/clean/react/share_download/api"],t,a)})).then(a.__importStar).then((function(o){var s=o.fetchDownloadUrl;return a.__awaiter(r,void 0,void 0,(function(){var r;return a.__generator(this,(function(o){switch(o.label){case 0:return[4,s(t.preview_url)];case 1:return r=o.sent(),new Promise((function(t,a){e(["modules/clean/downloads"],t,a)})).then(a.__importStar).then((function(e){(0,e.get)({url:r})})),[2]}}))}))})),[2]}))}))},t.prototype.logClickFolder=function(e){var t=E.SHARE_ACTION_ORIGIN_TYPE.SHARE;return i.ShareTibEventLogger.log(this.user.id,"SHARE_PAGE_CLICK_FOLDER",t,{ns_id:e.shared_folder_id})},t})();function P(){return m.Modal.close()}t.FolderRowActions=w;var N=(function(){function t(e){e=e||{},this.user=e.user,this.client=e.client||null,null==this.client&&(this.client=new h.FileShareApiClient({userId:this.user.id,client:new l.UserApiV2Client})),this.actions={onRelinquishMembershipClick:this.handleRelinquishMembershipClick.bind(this),onDownloadClick:this.handleDownloadClick.bind(this),onCommentClick:this.handleCommentClick.bind(this),onViewFileClick:this.handleViewFileClick.bind(this)}}return t.prototype.handleViewFileClick=function(e){var t=E.SHARE_ACTION_ORIGIN_TYPE.SHARE;return i.ShareTibEventLogger.log(this.user.id,"SHARE_PAGE_CLICK_FILE",t,{file_id:e.id}),C.open_tab(e.preview_url)},t.prototype.handleDownloadClick=function(t){return a.__awaiter(this,void 0,void 0,(function(){var r=this;return a.__generator(this,(function(o){return new Promise((function(t,a){e(["modules/clean/react/share_download/api"],t,a)})).then(a.__importStar).then((function(o){var s=o.fetchDownloadUrl;return a.__awaiter(r,void 0,void 0,(function(){var r;return a.__generator(this,(function(o){switch(o.label){case 0:return[4,s(t.preview_url)];case 1:return r=o.sent(),new Promise((function(t,a){e(["modules/clean/downloads"],t,a)})).then(a.__importStar).then((function(e){(0,e.get)({url:r})})),[2]}}))}))})),[2]}))}))},t.prototype.handleCommentClick=function(e){C.redirect(e.preview_url)},t.prototype.handleRelinquishMembershipClick=function(e){var t=this;return f.showRelinquishMembershipConfirmationModal(!1,!1,(function(){return t.relinquishMembership(e),m.Modal.close()}),P,!1)},t.prototype.relinquishMembership=function(e){var t=this;return u.Dispatcher.dispatch({type:S.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_REQUEST,metadata:e,user:this.user}),this.client.relinquishMembership({contentId:e.id}).then((function(){return u.Dispatcher.dispatch({type:S.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_SUCCESS,metadata:e,user:t.user}),M.sharingNotificationSuccess(D.intl.formatMessage({id:"7O9HTU",defaultMessage:"You have removed your own access to this file."}))})).catch(n.catchApiError((function(){return u.Dispatcher.dispatch({type:S.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_ERROR,metadata:e,user:t.user}),M.sharingNotificationError(D.intl.formatMessage({id:"uQ9oGF",defaultMessage:"We were unable to complete your request."}))})))},t})();t.FileRowActions=N;var x=function(e,t){var r=t.SharePageStore.getCurrentUser(),o={fileRowActions:e.fileRowActionsByUserId[r.id],fileTabActions:e.fileTabActions,folderRowActions:e.folderRowActionsByUserId[r.id],folderTabActions:e.folderTabActions,linkTabActions:e.linkTabActions,isMaestroDesign:!0,isTeamPolicyLoaded:t.SharePageStore.isTeamPolicyLoaded(r.id),listing:new v.SharedContentListing,listingFolders:new v.SharedContentListing,listingFiles:new v.SharedContentListing,onChangeTab:e.onChangeTab,teamPolicy:t.SharePageStore.getCurrentTeamPolicy(r.id),user:r,viewingTab:t.SharePageStore.state.viewingTab,searchBarExperiments:e.searchBarExperiments,expSubgrowthProSharePageUpdates:e.expSubgrowthProSharePageUpdates,expBasicNearOrOverQuotaJoinTeam:e.expBasicNearOrOverQuotaJoinTeam};return o.listingFolders=t.SharePageStore.getCurrentFoldersListing(),o.listingFiles=t.SharePageStore.getCurrentFilesListing(),a.__assign(a.__assign({},o),{recentTabActions:e.recentTabActions})};t.sharePagePropsFromStores=x;var k=((O={})[v.SharePageTab.RECENT]="recents",O[v.SharePageTab.FOLDER]="folders",O[v.SharePageTab.FILE]="files",O[v.SharePageTab.LINK]="links",O),B={recent:v.SharePageTab.RECENT,folders:v.SharePageTab.FOLDER,files:v.SharePageTab.FILE,links:v.SharePageTab.LINK}})),define("modules/clean/sharing/share_page/store",["require","exports","tslib","immutable","modules/clean/flux/dispatcher","modules/clean/flux/base_store","modules/clean/sharing/share_page/action_types","modules/clean/sharing/share_page/types","modules/clean/viewer"],(function(e,t,a,r,o,s,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r);var d=n.SharePageTab.RECENT,u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.getCurrentListing=function(){return this.getListing(this.state.viewingTab,this.state.viewingUserId)},t.prototype.getCurrentFoldersListing=function(){return this.getListing(n.SharePageTab.FOLDER,this.state.viewingUserId)},t.prototype.getCurrentFilesListing=function(){return this.getListing(n.SharePageTab.FILE,this.state.viewingUserId)},t.prototype.getCurrentUser=function(){return this.state.viewer.get_user_by_id(this.state.viewingUserId)},t.prototype.getCurrentTeamPolicy=function(e){return this.state.teamPolicy[e]},t.prototype.isTeamPolicyLoaded=function(e){return e in this.state.teamPolicy},t.prototype.getListing=function(e,t){var a=this.state.listingByUserByType.getIn([e,t]);return null!=a?a:new n.SharedContentListing},t.prototype._init=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a=e[0],o=null!=a?a:{},s=o.viewer,i=o.viewingRole,u=null!=i?i:null,p=o.viewingTab,c=null!=p?p:d,m=null!=s?s:null;null==m&&(m=l.Viewer.get_viewer());var h=null!=m?m.get_users():void 0,_=null;if(null!=m&&h.length>0){if(null!=u){var f=m.get_user_by_role(u);null!=f&&(_=f.id)}null==_&&(_=m.get_users()[0].id)}return this.state={listingByUserByType:r.Map([[n.SharePageTab.FOLDER,r.Map()],[n.SharePageTab.FILE,r.Map()]]),teamPolicy:{},viewer:m,viewingTab:c,viewingUserId:_}},t.prototype._new_payload=function(e){switch(e.action.type){case i.SharePageActionTypes.INITIALIZE:return this._init(e.action),this.emit_change();case i.SharePageActionTypes.EMAIL_UNVERIFIED:return this._setEmailUnverified(e.action.user.id),this.emit_change();case i.SharePageActionTypes.RECENT_TAB_EMAIL_UNVERIFIED:return this._setRecentTabEmailUnverified(e.action.user.id),this.emit_change();case i.SharePageActionTypes.SWITCH_TAB:return this.state.viewingTab=e.action.viewingTab,this.emit_change();case i.SharePageActionTypes.SWITCH_ROLE:var t=this.state.viewer.get_user_by_role(e.action.role);return this.state.viewingUserId=t.id,this.emit_change();case i.SharePageActionTypes.SWITCH_USER:return this.state.viewingUserId=e.action.userId,this.emit_change();case i.SharePageActionTypes.LOAD_PRE_FOLDER_DATA_REQUEST:return this._loadPreViewDataRequest(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.LOAD_PRE_FOLDER_DATA_SUCCESS:return this._loadPreViewDataSuccess(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.LOAD_PRE_FOLDER_DATA_ERROR:return this._loadPreViewDataError(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.LOAD_FOLDER_DATA_REQUEST:return this._loadDataRequest(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.LOAD_FOLDER_DATA_SUCCESS:return this._loadDataSuccess(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.LOAD_FOLDER_DATA_ERROR:return this._loadDataError(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.LOAD_PRE_FILE_DATA_REQUEST:return this._loadPreViewDataRequest(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.LOAD_PRE_FILE_DATA_SUCCESS:return this._loadPreViewDataSuccess(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.LOAD_PRE_FILE_DATA_ERROR:return this._loadPreViewDataError(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.LOAD_FILE_DATA_REQUEST:return this._loadDataRequest(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.LOAD_FILE_DATA_SUCCESS:return this._loadDataSuccess(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.LOAD_FILE_DATA_ERROR:return this._loadDataError(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.MOUNT_FOLDER_REQUEST:return this._mountFolderRequest(e.action);case i.SharePageActionTypes.MOUNT_FOLDER_SUCCESS:return this._mountFolderSuccess(e.action);case i.SharePageActionTypes.MOUNT_FOLDER_ERROR:return this._mountFolderError(e.action);case i.SharePageActionTypes.UNMOUNT_FOLDER_REQUEST:return this._unmountFolderRequest(e.action);case i.SharePageActionTypes.UNMOUNT_FOLDER_SUCCESS:return this._unmountFolderSuccess(e.action);case i.SharePageActionTypes.UNMOUNT_FOLDER_ERROR:return this._unmountFolderError(e.action);case i.SharePageActionTypes.UNSHARE_FOLDER_REQUEST:return this._unshareFolderRequest(e.action);case i.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS:return this._unshareFolderSuccess(e.action);case i.SharePageActionTypes.UNSHARE_FOLDER_ERROR:return this._unshareFolderError(e.action);case i.SharePageActionTypes.FETCH_TEAM_POLICY_REQUEST:return delete this.state.teamPolicy[e.action.user.id],this.emit_change();case i.SharePageActionTypes.FETCH_TEAM_POLICY_SUCCESS:return this._fetchTeamPolicySuccess(e.action);case i.SharePageActionTypes.FETCH_TEAM_POLICY_ERROR:return null;case i.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS:return this._fetchFolderPolicySuccess(e.action);case i.SharePageActionTypes.FETCH_METADATA_SUCCESS:return this._fetchMetadataSuccess(e.action);case i.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_REQUEST:return this._relinquishMembershipRequest(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS:return this._relinquishMembershipSuccess(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_ERROR:return this._relinquishMembershipError(n.SharePageTab.FOLDER,e.action);case i.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_REQUEST:return this._relinquishMembershipRequest(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_SUCCESS:return this._relinquishMembershipSuccess(n.SharePageTab.FILE,e.action);case i.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_ERROR:return this._relinquishMembershipError(n.SharePageTab.FILE,e.action)}},t.prototype._setListing=function(e,t,a){return this.state.listingByUserByType=this.state.listingByUserByType.setIn([e,t],a)},t.prototype._loadPreViewDataRequest=function(e,t){var a=this.getListing(e,t.user.id).set("state",n.ListingState.PREFETCH_FETCHING);return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._loadPreViewDataSuccess=function(e,t){var a=this.getListing(e,t.user.id).listingEntries.merge(t.entries),r=new n.SharedContentListing({cursor:t.cursor,listingEntries:a,nextResultCallback:t.nextResultCallback,state:null!=t.cursor?n.ListingState.NEEDS_LOAD:n.ListingState.FINISHED});return this._setListing(e,t.user.id,r),this.emit_change()},t.prototype._loadPreViewDataError=function(e,t){var a=this.getListing(e,t.user.id).set("state",n.ListingState.ERROR);return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._loadDataRequest=function(e,t){var a=this.getListing(e,t.user.id).set("state",n.ListingState.FETCHING);return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._loadDataSuccess=function(e,t){var a=this.getListing(e,t.user.id),r=new n.SharedContentListing({cursor:t.cursor,listingEntries:a.listingEntries.merge(t.entries),nextResultCallback:t.nextResultCallback,state:null!=t.cursor?n.ListingState.NEEDS_LOAD:n.ListingState.FINISHED});return this._setListing(e,t.user.id,r),this.emit_change()},t.prototype._loadDataError=function(e,t){var a=this.getListing(e,t.user.id).set("state",n.ListingState.ERROR);return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._setEmailUnverified=function(e){var t=this.state.viewingTab,a=this.getListing(t,e).set("state",n.ListingState.EMAIL_UNVERIFIED);return this._setListing(t,e,a)},t.prototype._setRecentTabEmailUnverified=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e).set("state",n.ListingState.EMAIL_UNVERIFIED);this._setListing(n.SharePageTab.FOLDER,e,t);var a=this.getListing(n.SharePageTab.FILE,e).set("state",n.ListingState.EMAIL_UNVERIFIED);return this._setListing(n.SharePageTab.FILE,e,a)},t.prototype._mountFolderRequest=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).setIn(["entryPendingStates",e.metadata.shared_folder_id],n.EntryPendingState.MOUNTING);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._mountFolderSuccess=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).setIn(["listingEntries",e.metadata.shared_folder_id],e.metadata).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._mountFolderError=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unmountFolderRequest=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).setIn(["entryPendingStates",e.metadata.shared_folder_id],n.EntryPendingState.UNMOUNTING);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unmountFolderSuccess=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).setIn(["listingEntries",e.metadata.shared_folder_id],e.metadata).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unmountFolderError=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unshareFolderRequest=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).setIn(["entryPendingStates",e.metadata.shared_folder_id],n.EntryPendingState.UNSHARING);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unshareFolderSuccess=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).removeIn(["listingEntries",e.metadata.shared_folder_id]).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unshareFolderError=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(n.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._fetchTeamPolicySuccess=function(e){return this.state.teamPolicy[e.user.id]=e.teamPolicy,this.emit_change()},t.prototype._fetchMetadataSuccess=function(e){var t=e.metadata.isSharedFolder()?n.SharePageTab.FOLDER:n.SharePageTab.FILE,a=this._getContentId(t,e),r=this.getListing(t,e.user.id),o=r.set("listingEntries",r.listingEntries.set(a,e.metadata));return this._setListing(t,e.user.id,o),this.emit_change()},t.prototype._fetchFolderPolicySuccess=function(e){var t=this.getListing(n.SharePageTab.FOLDER,e.user.id),a=t.listingEntries.get(e.metadata.shared_folder_id);a=a.set("policy",e.folderPolicy);var r=t.set("listingEntries",t.listingEntries.set(e.metadata.shared_folder_id,a));return this._setListing(n.SharePageTab.FOLDER,e.user.id,r),this.emit_change()},t.prototype._relinquishMembershipRequest=function(e,t){var a=this._getContentId(e,t),r=this.getListing(e,t.user.id).setIn(["entryPendingStates",a],n.EntryPendingState.RELINQUISHING_MEMBERSHIP);return this._setListing(e,t.user.id,r),this.emit_change()},t.prototype._relinquishMembershipSuccess=function(e,t){var a=this._getContentId(e,t),r=this.getListing(e,t.user.id).removeIn(["listingEntries",a]).removeIn(["entryPendingStates",a]);return this._setListing(e,t.user.id,r),this.emit_change()},t.prototype._relinquishMembershipError=function(e,t){var a=this._getContentId(e,t),r=this.getListing(e,t.user.id).removeIn(["entryPendingStates",a]);return this._setListing(e,t.user.id,r),this.emit_change()},t.prototype._getContentId=function(e,t){switch(e){case n.SharePageTab.FOLDER:return t.metadata.shared_folder_id;case n.SharePageTab.FILE:return t.metadata.id}},t})(s.Store);t.SharePageStore=new u(o.Dispatcher)})),define("modules/clean/sharing/share_page/types",["require","exports","tslib","immutable","modules/clean/sharing/share_page/constants","modules/clean/sharing/share_page/constants"],(function(e,t,a,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),(function(e){e.MOUNTING="unmounting",e.UNMOUNTING="unmounting",e.UNSHARING="unsharing",e.RELINQUISHING_MEMBERSHIP="relinquishing-membership"})(t.EntryPendingState||(t.EntryPendingState={}));var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t})(r.Record({cursor:null,listingEntries:r.Map(),entryPendingStates:r.Map(),nextResultCallback:null,state:o.ListingState.NEEDS_LOAD},"SharedContentListing"));t.SharedContentListing=i,(function(e){e.NAME="name",e.TIME_INVITED="time_invited"})(t.SortField||(t.SortField={})),t.SharePageTab=s.SharePageTab,t.ListingState=s.ListingState})),define("modules/clean/sharing/share_page/util",["require","exports","modules/clean/sharing/access_level","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/views/share_column_header","modules/core/i18n"],(function(e,t,a,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return null!=e.path_lower};t.isMetadataMounted=i;t.groupEntriesByMounted=function(e){return e.groupBy(i)};t.convertShareColumnHeaderKeyToLinkField=function(e){return"time_invited"===e?"created_ts":"filename"};t.sortedEntries=function(e,t,a,s){void 0===s&&(s=null);var i=(function(){if(t===r.SortField.TIME_INVITED)return function(e){return e.time_invited};if(t===r.SortField.NAME||t===r.SortField.INVITER)return function(e){return e.name.toLowerCase()};throw Error("Unexpected sort field")})(),n=a===o.SortDirection.DESCENDING?function(e,t){return t<e?-1:e===t?0:1}:function(e,t){return e<t?-1:e===t?0:1},l=e.sortBy(i,n);return null!=s?l.take(s).valueSeq():l.valueSeq()};t.getOutOfQuotaVars=function(e,t){var r="wb"+(0===t.error.space_left?"_oq":"_nq")+"_shm_share"+(e.access_type===a.ACCESS_LEVEL.READER?"_ro":"_w");return{folderName:e.name,folderSize:t.error.space_needed,queryParams:r,usageRemaining:t.error.space_left,usageNeeded:t.error.space_needed,nsId:e.shared_folder_id}};t.getOQA=function(e){return["oq","nq","uq"].includes(e)?"wb_"+e+"_share":""},t.expSubgrowthProSharePageUpdatesUntranslatedButtonText="Get more space",t.expSubgrowthProSharePageUpdatesButtonText=s.intl.formatMessage({id:"iIucBq",defaultMessage:"Get more space"}),t.QOUTA_TYPE={OVER:"over",UNDER:"under",NEAR:"near"},t.ACTION_TYPE={VIEW:"view",CLICK:"click"};t.getOQALoggingData=function(e){var a=e.eventName,r=e.action,o=void 0===r?t.ACTION_TYPE.VIEW:r,s=e.destinationUrl,i=void 0===s?"/low-space-sharing":s;return{wb_uq_share:{action:o,button_text:t.expSubgrowthProSharePageUpdatesButtonText,destination_url:i,location:"in_product",quota_status:t.QOUTA_TYPE.UNDER,upsell_type:"button"},wb_nq_share:{action:o,button_text:t.expSubgrowthProSharePageUpdatesButtonText,destination_url:i,location:"in_product",quota_status:t.QOUTA_TYPE.NEAR,upsell_type:"button"},wb_oq_share:{action:o,button_text:t.expSubgrowthProSharePageUpdatesButtonText,destination_url:i,location:"in_product",quota_status:t.QOUTA_TYPE.OVER,upsell_type:"button"}}[a]}})),define("modules/clean/sharing/share_page/views/file_listing_redesign",["require","exports","tslib","classnames","react","modules/clean/react/columnheader","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/file_row_redesign","modules/clean/sharing/share_page/views/share_column_header","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r);var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={sortDirection:t.props.initialSortDirection,sortField:t.props.initialSortField},t.handlePopoverSelection=function(e){return t._handleSortChange(e.newSortField,e.newSortDirection)},t._renderNewColumnHeader=function(e){return e.label?o.default.createElement(d.ShareColumnHeader,{headerClassName:e.headerClassName,onSelection:t.handlePopoverSelection,sortField:e.sortField,activeSortField:t.state.sortField,label:e.label,activeSortDirection:t.state.sortDirection}):o.default.createElement("span",null)},t.renderHeader=function(){var e;e=[];for(var a=0,r=Array.from(t._getColumns());a<r.length;a++){var s=r[a];e.push(t._renderNewColumnHeader(s))}return o.default.createElement("thead",{className:"mcl-style-header u-trim-margin u-trim-padding"},o.default.createElement("tr",null,e))},t._getColumns=function(){return[{canToggleSortDirection:!0,headerClassName:r.default("filename-col","filename-col--pagelet"),label:t.props.label,sortField:i.SortField.NAME,type:s.ColumnTypes.SINGLE},{canToggleSortDirection:!0,headerClassName:r.default("time-invited-col","time-invited-col--pagelet"),label:u.intl.formatMessage({id:"2ADqSr",defaultMessage:"Shared on"}),sortField:i.SortField.TIME_INVITED,type:s.ColumnTypes.SINGLE},{headerClassName:r.default("actions-col","actions-col--pagelet"),label:null,type:s.ColumnTypes.STATIC}]},t._getSortedEntries=function(){return n.sortedEntries(t.props.entries,t.state.sortField,t.state.sortDirection)},t._handleSortChange=function(e,a){return t.setState({sortDirection:a,sortField:e})},t._handlePreRedesignSortChange=function(e,a){return t._handleSortChange(e,t._convertBrowseSortDirectionToShareSortDirection(a))},t._convertShareSortDirectionToBrowseSortDirection=function(e){return e===d.SortDirection.DESCENDING?s.SortDirections.DESCENDING:s.SortDirections.ASCENDING},t._convertBrowseSortDirectionToShareSortDirection=function(e){return e===s.SortDirections.DESCENDING?d.SortDirection.DESCENDING:d.SortDirection.ASCENDING},t}return a.__extends(t,e),t.prototype.render=function(){var e=this;return o.default.createElement("table",{className:"mu-mar-bottom-5x share-page-table"},this.renderHeader(),o.default.createElement("tbody",{className:"o-list-ui o-list-ui--dividers u-trim-margin"},this._getSortedEntries().map((function(t){return o.default.createElement(l.FileRowRedesign,a.__assign({key:t.id,metadata:t,pendingState:e.props.entryPendingStates.get(t.id)},e.props.fileRowActions))})).toArray()))},t.displayName="FileListing",t.defaultProps={initialSortDirection:d.SortDirection.DESCENDING,initialSortField:i.SortField.TIME_INVITED},t})((o=a.__importDefault(o)).default.Component);t.FileListingRedesign=p})),define("modules/clean/sharing/share_page/views/file_row_redesign",["require","exports","tslib","classnames","react","modules/clean/datetime","modules/clean/react/css","modules/clean/sharing/share_page/views/row_actions","modules/clean/sharing/share_page/views/shared_file_icon","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),s=a.__importStar(s);var u=o.default.createElement,p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHovered:!1},t._handleMouseEnter=function(){return t.setState({isHovered:!0})},t._handleMouseLeave=function(){return t.setState({isHovered:!1})},t._renderIconAndName=function(){return[u(l.SharedFileIcon,{sharedFileMetadata:t.props.metadata,className:r.default("share-page-file-row__file-icon","u-l-ib","u-l-ib--m","u-mar-right-xs","mu-mar-right-2x")}),o.default.createElement("span",{className:r.default("share-page-file-row__file-name","u-l-ib","u-l-ib--m"),key:"file-row-name"},t.props.metadata.name)]},t._renderFileActions=function(){var e=[];return t.props.metadata.permissions&&(t.props.metadata.permissions.relinquish_membership&&t.props.metadata.permissions.relinquish_membership.allow&&t.props.onRelinquishMembershipClick&&e.push({label:d.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"}),key:"relinquish-membership",performAction:t.props.onRelinquishMembershipClick.bind(t,t.props.metadata)}),t.props.onDownloadClick&&t.props.metadata.preview_url&&e.push({label:d.intl.formatMessage({id:"pHnJw0",defaultMessage:"Download"}),key:"download",performAction:t.props.onDownloadClick.bind(t,t.props.metadata)}),t.props.onCommentClick&&t.props.metadata.preview_url&&e.push({label:d.intl.formatMessage({id:"fTdk5C",defaultMessage:"Add comment"}),key:"comment",performAction:t.props.onCommentClick.bind(t,t.props.metadata)})),o.default.createElement(n.RowActions,{disabled:null!=t.props.pendingState,importance:"secondary",overflowActions:e,rowIsHovered:t.state.isHovered})},t}return a.__extends(t,e),t.prototype.render=function(){var e=new Date(this.props.metadata.time_invited);return o.default.createElement("tr",{className:r.default(["share-page-file-row",["mu-height-8x","mu-pad-horizontal-2x"]]),key:"shared-file-"+this.props.metadata.id,title:this.props.metadata.name,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave},o.default.createElement("td",{className:r.default("filename-col u-l-ib u-l-ib--m","filename-col--pagelet")},o.default.createElement("button",{className:"u-l-b button-as-link share-page-file-row__file-name-col",onClick:null!=this.props.onViewFileClick?this.props.onViewFileClick.bind(this,this.props.metadata):void 0},this._renderIconAndName())),o.default.createElement("td",{className:r.default("share-page-file-row__time-invited","time-invited-col","time-invited-col--pagelet","u-l-ib","u-l-ib--m","u-font-meta"),title:null!=this.props.metadata.time_invited?s.ago(e):void 0},null!=this.props.metadata.time_invited?s.format_date(e,s.localized_datetime_format):""),o.default.createElement("td",{className:r.default("actions-col u-l-ib u-l-ib--m u-font-right","actions-col--pagelet")},this._renderFileActions()))},t.displayName="FileRow",t})(o.default.Component);t.FileRowRedesign=i.requireCssWithComponent(p,["/static/css/sharing/share_page-vflwcnY8R.css","/static/css/scooter/scooter-scoped-vfljL5ijS.css"])})),define("modules/clean/sharing/share_page/views/files_tab_redesign",["require","exports","tslib","react","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/views/file_listing_redesign","modules/clean/sharing/share_page/views/tab_states","modules/core/i18n"],(function(e,t,a,r,o,s,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return r.default.createElement("div",{className:"redesign"},r.default.createElement(i.PageTab,{className:"share-page-files-tab",header:null,listingState:this.props.listing.state,onEmailWantToVerify:this.props.onEmailWantToVerify,user:this.props.user,tabType:o.SharePageTab.FILE},this.props.listing.listingEntries.count()>0?r.default.createElement(s.FileListingRedesign,{entries:this.props.listing.listingEntries,entryPendingStates:this.props.listing.entryPendingStates,fileRowActions:this.props.fileRowActions,label:n.intl.formatMessage({id:"icJd4i",defaultMessage:"Name"})}):null))},t.displayName="FilesTab",t})((r=a.__importDefault(r)).default.Component);t.FilesTab=l})),define("modules/clean/sharing/share_page/views/folder_icon_from_metadata",["require","exports","tslib","react","spectrum/icon_content","modules/clean/sharing/ui_util"],(function(e,t,a,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),s=a.__importStar(s),t.FolderIconFromMetadata=function(e){var t=e.className,a=e.metadata,i=(e.group,e.showUnmountedAsDisabled),n=s.spectrumFolderIconForMetadata(a),l=null==a.path_lower&&i;return r.default.createElement(o.IconContent,{className:t,disabled:l,name:n,"aria-label":a.name,role:"img"})}})),define("modules/clean/sharing/share_page/views/folder_listing_redesign",["require","exports","tslib","classnames","react","modules/clean/react/columnheader","modules/clean/react/sprite","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/folder_row_redesign","modules/clean/sharing/share_page/views/share_column_header","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r);var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={collapsed:null!=t.props.maxInitialDisplay,sortDirection:t.props.initialSortDirection,sortField:t.props.initialSortField},t.handlePopoverSelection=function(e){return t._handleSortChange(e.newSortField,e.newSortDirection)},t._renderNewColumnHeader=function(e){return e.label?o.default.createElement(u.ShareColumnHeader,{headerClassName:e.headerClassName,onSelection:t.handlePopoverSelection,sortField:e.sortField,activeSortField:t.state.sortField,label:e.label,activeSortDirection:t.state.sortDirection,showSort:e.showSort}):o.default.createElement("span",null)},t.renderHeader=function(){return o.default.createElement("thead",{className:"mcl-style-header u-trim-margin u-trim-padding"},o.default.createElement("tr",null,t._getColumns().map((function(e){return t._renderNewColumnHeader(e)}))))},t._numberToHide=function(){if(!t.state.collapsed||null==t.props.maxInitialDisplay)return 0;var e=t.props.entries.count();return e<=t.props.maxInitialDisplay?0:e-t.props.maxInitialDisplay},t._getColumns=function(){var e=t.props.expSubgrowthProSharePageUpdates&&t.props.expSubgrowthProSharePageUpdates.variant&&"V1"===t.props.expSubgrowthProSharePageUpdates.variant,a=p.intl.formatMessage({id:"FAd9tz",defaultMessage:"Name"}),o={canToggleSortDirection:!0,headerClassName:r.default("filename-col",e?"filename-col--subgrowth_pro_share_page_updates":void 0,t.props.isMaestroDesign?"filename-col--pagelet":void 0),label:a,sortField:n.SortField.NAME,type:s.ColumnTypes.SINGLE},i=p.intl.formatMessage({id:"2ADqSr",defaultMessage:"Shared on"}),l={canToggleSortDirection:!0,headerClassName:r.default("time-invited-col",t.props.isMaestroDesign?"time-invited-col--pagelet":void 0),label:i,sortField:n.SortField.TIME_INVITED,type:s.ColumnTypes.SINGLE},d=null;if(e){var u=p.intl.formatMessage({id:"/eW+X1",defaultMessage:"Size"});d={canToggleSortDirection:!1,headerClassName:r.default("size-col",t.props.isMaestroDesign?"size-col--pagelet":void 0),label:u,sortField:null,type:s.ColumnTypes.SINGLE,showSort:!1}}return[o,d,l,{headerClassName:r.default("actions-col",t.props.isMaestroDesign?"actions-col--pagelet":void 0),label:null,type:s.ColumnTypes.STATIC}].filter((function(e){return e}))},t._getSortedEntries=function(){return l.sortedEntries(t.props.entries,t.state.sortField,t.state.sortDirection,t.state.collapsed?t.props.maxInitialDisplay:null)},t._handleShowAllFoldersClick=function(){return t.setState({collapsed:!1})},t._handleSortChange=function(e,a){return t.setState({sortDirection:a,sortField:e})},t._handlePreRedesignSortChange=function(e,a){return t._handleSortChange(e,t._convertBrowseSortDirectionToShareSortDirection(a))},t._convertShareSortDirectionToBrowseSortDirection=function(e){return e===u.SortDirection.DESCENDING?s.SortDirections.DESCENDING:s.SortDirections.ASCENDING},t._convertBrowseSortDirectionToShareSortDirection=function(e){return e===s.SortDirections.DESCENDING?u.SortDirection.DESCENDING:u.SortDirection.ASCENDING},t}return a.__extends(t,e),t.prototype.render=function(){var e=this,t=this._numberToHide();return o.default.createElement("table",{className:"mu-mar-bottom-5x share-page-table"},this.renderHeader(),o.default.createElement("tbody",{className:"o-list-ui o-list-ui--dividers u-trim-margin"},this._getSortedEntries().map((function(t){return o.default.createElement(d.FolderRow,a.__assign({isMaestroDesign:e.props.isMaestroDesign,key:t.shared_folder_id,metadata:t,pendingState:e.props.entryPendingStates.get(""+t.shared_folder_id),user:e.props.user,isTeamPolicyLoaded:e.props.isTeamPolicyLoaded,expBasicNearOrOverQuotaJoinTeam:e.props.expBasicNearOrOverQuotaJoinTeam,expSubgrowthProSharePageUpdates:e.props.expSubgrowthProSharePageUpdates},e.props.folderRowActions))})).toArray(),t?o.default.createElement("tr",{className:"u-pad-vertical-s"},o.default.createElement("button",{className:"share-page-folder-listing__show-more button-as-link",onClick:this._handleShowAllFoldersClick},o.default.createElement("div",{className:"u-l-ib u-mar-right-xs mu-trim-margin"},o.default.createElement("button",{className:r.default("share-page-folder-listing__show-more-caret","mu-width-8x","mu-trim-padding","mu-mar-horizontal-auto","u-pad-horizontal-xxs","u-mar-horizontal-xxs","u-l-ib"),onClick:this._handleShowAllFoldersClick},o.default.createElement(i.Sprite,{alt:"",group:"web",name:"caret_gray"}))),o.default.createElement("span",null,p.intl.formatMessage({id:"SLwrSx",defaultMessage:"{count, plural, one{Show one more folder} other{Show {count} more folders}}"},{count:t})))):void 0))},t.displayName="FolderListingRedesign",t.defaultProps={initialSortDirection:u.SortDirection.DESCENDING,initialSortField:n.SortField.TIME_INVITED,maxInitialDisplay:void 0},t})((o=a.__importDefault(o)).default.Component);t.FolderListingRedesign=c})),define("modules/clean/sharing/share_page/views/folder_row_redesign",["require","exports","tslib","classnames","react","modules/clean/analytics","modules/clean/browse_interface","modules/clean/datetime","modules/clean/display_format","modules/clean/react/css","modules/clean/react/teams/over_quota_join_team/constants","spectrum-sharing/utils/sharing_constants","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/folder_icon_from_metadata","modules/clean/sharing/share_page/views/row_actions","modules/core/browser","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),n=a.__importStar(n),l=a.__importStar(l),_=a.__importStar(_);var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHovered:!1,buttonViewEventAlreadyFired:!1},t.handleOnClick=function(e){return function(){if(t.hasQuotaType()){var a=c.getOQA(t.props.expSubgrowthProSharePageUpdates.quotaType),r=c.getOQALoggingData({eventName:a,action:c.ACTION_TYPE.CLICK,destinationUrl:"https://www.dropbox.com"+e});s.ProEventsLogger.log(a,r)}var o=t.getOqaParams(),i=""+e+o;s.ShareTibEventLogger.log(t.props.user.id,"OUT_OF_QUOTA_MODAL_UPGRADE",p.SHARE_ACTION_ORIGIN_TYPE.SHARE,{ns_id:t.props.metadata.shared_folder_id,cta_text:c.expSubgrowthProSharePageUpdatesUntranslatedButtonText,cta_url:i}),_.redirect(i)}},t.handleJoinTeamOnClick=function(){return function(){var e=u.constructJoinTeamLandingPageUri(t.props.metadata.shared_folder_id.toString(),u.OqNqJoinTeamOriginType.SHARE_PAGE);s.ShareTibEventLogger.log(t.props.user.id,"OUT_OF_QUOTA_MODAL_UPGRADE",p.SHARE_ACTION_ORIGIN_TYPE.SHARE,{ns_id:t.props.metadata.shared_folder_id,cta_text:u.OQ_NQ_JOIN_TEAM_CTA_UNTRANSLATED_TEXT,cta_url:e}),_.redirect(e)}},t.handleMouseEnter=function(){return t.props.metadata.can_mount||t.state.buttonViewEventAlreadyFired||(t.proEventsLogButtonViewEvent(),t.shareTibEventsLogOverquotaRender()),t.setState({isHovered:!0,buttonViewEventAlreadyFired:!0})},t.handleMouseLeave=function(){return t.setState({isHovered:!1})},t.getMoreSpaceRoute=function(){return"https://www.dropbox.com/low-space-sharing"},t.proEventsLogButtonViewEvent=function(){if("V1"===t.props.expSubgrowthProSharePageUpdates.variant&&t.hasQuotaType()){var e=t.props.expSubgrowthProSharePageUpdates.quotaType,a=c.getOQA(e),r=c.getOQALoggingData({eventName:a,action:c.ACTION_TYPE.VIEW,destinationUrl:t.getMoreSpaceRoute()});s.ProEventsLogger.log(a,r)}},t.shareTibEventsLogOverquotaRender=function(){var e=p.SHARE_ACTION_ORIGIN_TYPE.SHARE;s.ShareTibEventLogger.log(t.props.user.id,"OUT_OF_QUOTA_MODAL_RENDER",e,{ns_id:t.props.metadata.shared_folder_id,cta_text:t.canJoinTeamForSpace()?u.OQ_NQ_JOIN_TEAM_CTA_UNTRANSLATED_TEXT:c.expSubgrowthProSharePageUpdatesUntranslatedButtonText,cta_url:t.canJoinTeamForSpace()?u.constructJoinTeamLandingPageUri(t.props.metadata.shared_folder_id.toString(),u.OqNqJoinTeamOriginType.SHARE_PAGE):t.getMoreSpaceRoute()})},t.renderIconAndNameForUnmountedFolders=function(){return[t.getIcon(),o.default.createElement("span",{className:"share-page-folder-row share-page-folder-row__name-width u-l-ib u-l-ib--m",key:"folder-row-name"},o.default.createElement("span",{className:"share-page-folder-row__unmounted-folder-name u-l-ib u-l-ib--m"},t.props.metadata.name),o.default.createElement("span",{className:"share-page-folder-row__folder-subtext u-l-ib u-l-ib--m"},f.intl.formatMessage({id:"pWUWWJ",defaultMessage:"Not added"})))]},t.renderIconAndNameForMountedFolders=function(){return[t.getIcon(),o.default.createElement("span",{className:"share-page-folder-row share-page-folder-row__name-width u-l-ib u-l-ib--m",key:"folder-row-name"},o.default.createElement("span",{className:"share-page-folder-row__folder-name u-l-ib u-l-ib--m",key:"folder-row-name"},t.props.metadata.name))]},t.getIcon=function(){return o.default.createElement(m.FolderIconFromMetadata,{className:"u-l-ib u-l-ib--m u-mar-right-xs mu-mar-right-2x",metadata:t.props.metadata,group:"web",showUnmountedAsDisabled:!1})},t.renderMountedFolderActions=function(){var e=[],a=t.props.metadata.permissions;return a&&(a.change_options&&a.change_options.allow&&t.props.isTeamPolicyLoaded&&e.push({label:f.intl.formatMessage({id:"3QmSF8",defaultMessage:"Folder settings"}),key:"folder-settings",disabled:!t.props.isTeamPolicyLoaded,performAction:t.bindHandler(t.props.onFolderSettingsClick)}),t.props.metadata.preview_url&&e.push({label:f.intl.formatMessage({id:"pHnJw0",defaultMessage:"Download"}),key:"download",performAction:t.bindHandler(t.props.onDownloadClick)}),a.unmount&&a.unmount.allow&&e.push({label:f.intl.formatMessage({id:"Iq7/TN",defaultMessage:"Remove from Dropbox"}),key:"unmount",className:"u-font-error",performAction:t.bindHandler(t.props.onUnmountClick)})),e.unshift({label:f.intl.formatMessage({id:"CcpVyl",defaultMessage:"Share"}),key:"share",performAction:t.bindHandler(t.props.onShareClick)}),o.default.createElement(h.RowActions,{importance:"tertiary",overflowActions:e,rowIsHovered:t.state.isHovered})},t.getOqaParams=function(){var e="";return t.hasQuotaType()&&(e=c.getOQA(t.props.expSubgrowthProSharePageUpdates.quotaType)),e?"?oqa="+e:""},t.canJoinTeamForSpace=function(){var e=t.props.metadata.can_mount,a=t.props.expBasicNearOrOverQuotaJoinTeam;return!e&&a&&"owner"!==t.props.metadata.access_type},t.renderUnmountedFolderActions=function(){var e=t.props.metadata.can_mount,a=t.props.expSubgrowthProSharePageUpdates&&t.props.expSubgrowthProSharePageUpdates.variant&&"V1"===t.props.expSubgrowthProSharePageUpdates.variant,r=[],s={disabled:null!=t.props.pendingState,label:f.intl.formatMessage({id:"Qfg7UG",defaultMessage:"Add"}),onClick:t.bindHandlerForShowAddContentModel(t.props.onMountClick)};if(t.canJoinTeamForSpace())s={disabled:null!=t.props.pendingState,label:u.OQ_NQ_JOIN_TEAM_CTA_TEXT,onClick:t.handleJoinTeamOnClick()};else if(a&&!e&&"owner"!==t.props.metadata.access_type){s={disabled:null!=t.props.pendingState,label:c.expSubgrowthProSharePageUpdatesButtonText,onClick:t.handleOnClick("/low-space-sharing")}}var i=t.props.metadata.permissions;return i&&(i.edit_contents&&!i.edit_contents.allow&&r.push({label:f.intl.formatMessage({id:"GW4cXr",defaultMessage:"View folder"}),key:"view-folder",performAction:t.bindHandler(t.props.onViewFolderClick)}),i.relinquish_membership&&i.relinquish_membership.allow&&r.push({label:f.intl.formatMessage({id:"6WOQfa",defaultMessage:"Remove"}),key:"relinquish-membership",performAction:t.bindHandler(t.props.onRelinquishMembershipClick)}),i.unshare&&i.unshare.allow&&r.push({label:f.intl.formatMessage({id:"z/VsbM",defaultMessage:"Unshare folder"}),key:"unshare-folder",className:"u-font-error",performAction:t.bindHandler(t.props.onUnshareClick)})),o.default.createElement(h.RowActions,{disabled:null!=t.props.pendingState,importance:"secondary",mainAction:s,overflowActions:r,rowIsHovered:t.state.isHovered})},t.bindHandler=function(e){return null!=e?e.bind(t,t.props.metadata):null},t.bindHandlerForShowAddContentModel=function(e){return null!=e?e.bind(t,t.props.user,t.props.metadata):null},t}return a.__extends(t,e),t.prototype.render=function(){var e=this,t=null!=this.props.metadata.path_lower,a=this.props.metadata.time_invited,s=this.props.metadata.folder_size,d=this.props.metadata.can_mount,u=this.props.expSubgrowthProSharePageUpdates&&this.props.expSubgrowthProSharePageUpdates.variant&&"V1"===this.props.expSubgrowthProSharePageUpdates.variant;return u&&!s&&(s=0),o.default.createElement("tr",{className:r.default("share-page-folder-row",t?"share-page-folder-row--mounted":"share-page-folder-row--invitation",this.props.isMaestroDesign?["mu-height-8x","mu-pad-horizontal-2x"]:"u-pad-vertical-xs"),key:"shared-folder-"+this.props.metadata.shared_folder_id,title:this.props.metadata.name,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},o.default.createElement("td",{className:r.default("filename-col u-l-ib u-l-ib--m",u?"filename-col--subgrowth_pro_share_page_updates":void 0,this.props.isMaestroDesign?"filename-col--pagelet":void 0)},t?o.default.createElement("a",{className:"u-l-b mu-height-8x",href:i.browse_uri_for_fq_path(this.props.user,this.props.metadata.path_lower).toString(),onClick:function(){return e.props.logClickFolder(e.props.metadata)},target:"_blank",rel:"noreferrer"},this.renderIconAndNameForMountedFolders()):this.renderIconAndNameForUnmountedFolders()),u&&o.default.createElement("td",{className:r.default("size-col",this.props.isMaestroDesign?"size-col--pagelet":void 0,"u-l-ib","u-l-ib--m","u-font-meta"),title:l.format_bytes(s,0)},o.default.createElement("span",{className:"share-page-folder-row share-page-folder-row__name-width u-l-ib u-l-ib--m",key:"folder-row-size"},o.default.createElement("span",{className:r.default(d||t?"share-page-folder-row__size-text":"share-page-folder-row__size-text-warning","u-l-ib","u-l-ib--m")},l.format_bytes(s,0)),!d&&!t&&o.default.createElement("span",{className:r.default("share-page-folder-row__not-enough-space","u-l-ib","u-l-ib--m")},f.intl.formatMessage({id:"h4S9M8",defaultMessage:"Not enough space to access folder"})))),o.default.createElement("td",{className:r.default("time-invited-col",this.props.isMaestroDesign?"time-invited-col--pagelet":void 0,"u-l-ib","u-l-ib--m","u-font-meta"),title:a&&n.ago(a)},a&&n.format_date(a,n.localized_datetime_format)),o.default.createElement("td",{className:r.default("actions-col u-l-ib u-l-ib--m u-font-right",this.props.isMaestroDesign?"actions-col--pagelet":void 0)},t?this.renderMountedFolderActions():this.renderUnmountedFolderActions()))},t.prototype.hasQuotaType=function(){return this.props.expSubgrowthProSharePageUpdates&&this.props.expSubgrowthProSharePageUpdates.quotaType},t.displayName="FolderRow",t.defaultProps={logClickFolder:function(){return!0}},t})(o.default.Component);t.FolderRow=d.requireCssWithComponent(g,["/static/css/sharing/share_page-vflwcnY8R.css","/static/css/scooter/scooter-scoped-vfljL5ijS.css"])})),define("modules/clean/sharing/share_page/views/folders_tab_redesign",["require","exports","tslib","react","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/folder_listing_redesign","modules/clean/sharing/share_page/views/tab_states"],(function(e,t,a,r,o,s,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderListing=function(){if(0===t.props.listing.listingEntries.count())return null;var e=s.groupEntriesByMounted(t.props.listing.listingEntries),a=e.has(!1)||e.has(!0);if(!a||0===t.props.listing.listingEntries.count())return null;var o=r.default.createElement(i.FolderListingRedesign,{entries:t.props.listing.listingEntries,entryPendingStates:t.props.listing.entryPendingStates,folderRowActions:t.props.folderRowActions,isMaestroDesign:!0,maxInitialDisplay:void 0,user:t.props.user,expBasicNearOrOverQuotaJoinTeam:t.props.expBasicNearOrOverQuotaJoinTeam,expSubgrowthProSharePageUpdates:t.props.expSubgrowthProSharePageUpdates});return a?r.default.createElement("div",null,o):r.default.createElement("div",null,void 0)},t}return a.__extends(t,e),t.prototype.render=function(){return r.default.createElement("div",{className:"redesign"},r.default.createElement(n.PageTab,{className:"share-page-folders-tab",header:void 0,listingState:this.props.listing.state,onEmailWantToVerify:this.props.onEmailWantToVerify,user:this.props.user,tabType:o.SharePageTab.FOLDER},this._renderListing()))},t.displayName="FoldersTab",t})((r=a.__importDefault(r)).default.Component);t.FoldersTab=l})),define("modules/clean/sharing/share_page/views/share_column_header",["require","exports","tslib","classnames","react","spectrum/icon_form","spectrum/popover","modules/core/i18n"],(function(e,t,a,r,o,s,i,n){"use strict";var l;Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),(function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"})(l=t.SortDirection||(t.SortDirection={}));var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return o.default.createElement("th",{className:this.props.headerClassName},o.default.createElement(i.Popover,{onSelection:this.props.onSelection},o.default.createElement(i.PopoverTrigger,{className:r.default({"column-header-menu-trigger-active":this.props.sortField===this.props.activeSortField}),title:this.props.label},o.default.createElement("span",null,this.props.label),this.props.showSort&&o.default.createElement("span",{className:"column-header-menu-label-icon-wrapper"},o.default.createElement(s.IconForm,{name:this.computeSortIcon()}))),this.props.showSort&&o.default.createElement(i.PopoverContent,null,o.default.createElement(i.PopoverItemGroup,null,o.default.createElement(i.PopoverItemGroupTitle,null,n.intl.formatMessage({id:"HXV3TA",defaultMessage:"Order"})),o.default.createElement(i.PopoverSelectableItem,{selected:this.isSortingByThisColumn(l.ASCENDING),value:{newSortDirection:l.ASCENDING,newSortField:this.props.sortField}},n.intl.formatMessage({id:"KyJseU",defaultMessage:"Ascending"})),o.default.createElement(i.PopoverSelectableItem,{selected:this.isSortingByThisColumn(l.DESCENDING),value:{newSortDirection:l.DESCENDING,newSortField:this.props.sortField}},n.intl.formatMessage({id:"Njd630",defaultMessage:"Descending"}))))))},t.prototype.isSortingByThisColumn=function(e){return this.props.sortField===this.props.activeSortField&&e===this.props.activeSortDirection},t.prototype.computeSortIcon=function(){return this.isSortingByThisColumn(l.ASCENDING)?"sort-arrow-up":this.isSortingByThisColumn(l.DESCENDING)?"sort-arrow-down":"caret-down"},t.defaultProps={showSort:!0},t})(o.default.Component);t.ShareColumnHeader=d})),define("modules/clean/sharing/share_page/views/share_page_redesign",["require","exports","tslib","classnames","react","modules/clean/pagelet_logger","modules/clean/react/app_actions_view","modules/clean/react/async/loadable","modules/clean/react/css","modules/clean/react/maestro/components/tab_nav","modules/clean/react/maestro/layout/chrome","modules/clean/react/maestro/layout/header","modules/clean/react/tabs/tab_util","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/views/files_tab_redesign","modules/clean/sharing/share_page/views/folders_tab_redesign","modules/clean/sharing/share_page/views/recents_tab","modules/clean/web_timing_logger","modules/core/i18n"],(function(e,t,a,r,o,s,i,n,l,d,u,p,c,m,h,_,f,g,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),o=a.__importDefault(o),g=a.__importStar(g);var S=n.Loadable({loader:function(){return a.__awaiter(void 0,void 0,void 0,(function(){return a.__generator(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,a){e(["modules/clean/sharing/share_page/views/links_tab"],t,a)})).then(a.__importStar)];case 1:return[2,t.sent().LinksTab]}}))}))}}),y=(function(e){function t(t){var a=e.call(this,t)||this;return a._createSharedFolderHandler=function(){a.props.folderTabActions&&a.props.folderTabActions.onNewSharedFolderClick&&a.props.folderTabActions.onNewSharedFolderClick.bind(a,a.props.user,null)()},a._renderActionMenu=function(){return o.default.createElement(i.AppActionsView,{primaryMenuItems:[{displayName:E.intl.formatMessage({id:"g0jUpN",defaultMessage:"Create shared folder"}),handleClick:a._createSharedFolderHandler,key:"created-shared-folder"}]})},a._handleTabSelect=function(e){return a.props.onChangeTab(e)},a.pageletLogger=new s.PageletLogger("sharing",["SharePage"]),a}return a.__extends(t,e),t.prototype.checkTTI=function(){if(this.props.viewingTab!==m.SharePageTab.LINK)return g.mark_time_to_view(),(this.props.viewingTab!==m.SharePageTab.FOLDER||"finished"!==this.props.listingFolders.state&&0===this.props.listingFolders.listingEntries.count())&&(this.props.viewingTab!==m.SharePageTab.FILE||"finished"!==this.props.listingFiles.state&&0===this.props.listingFiles.listingEntries.count())&&(this.props.viewingTab!==m.SharePageTab.RECENT||"finished"!==this.props.listingFiles.state&&0===this.props.listingFiles.listingEntries.count()||"finished"!==this.props.listingFolders.state&&0===this.props.listingFolders.listingEntries.count())?void 0:this.pageletLogger.componentReady(t.displayName)},t.prototype.componentDidMount=function(){this.checkTTI()},t.prototype.componentDidUpdate=function(){this.checkTTI()},t.prototype.render=function(){var e=this.props,t=e.user,a=e.isMaestroDesign,r=e.searchBarExperiments;return a?o.default.createElement(u.MaestroChrome,{user:t,titleRegion:o.default.createElement(p.MaestroHeaderTitle,null,E.intl.formatMessage({id:"UNDY3R",defaultMessage:"Shared"})),embeddedAppRegion:this._renderBody(),actionSidebarRegion:this._renderActionMenu(),searchBarProps:{searchBarExperiments:r}}):o.default.createElement("div",{className:"share-page"},o.default.createElement("main",null,this._renderBody()))},t.prototype._renderBody=function(){var e,t=[{value:m.SharePageTab.RECENT,label:E.intl.formatMessage({id:"hDgBBt",defaultMessage:"Recents"})},{value:m.SharePageTab.FOLDER,label:E.intl.formatMessage({id:"Ga3Ee+",defaultMessage:"Folders"})},{value:m.SharePageTab.FILE,label:E.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"})}];switch(this.props.isMaestroDesign&&t.push({value:m.SharePageTab.LINK,label:E.intl.formatMessage({id:"AUvNZU",defaultMessage:"Links"})}),this.props.viewingTab){case m.SharePageTab.RECENT:e=0;break;case m.SharePageTab.FOLDER:e=1;break;case m.SharePageTab.FILE:e=2;break;case m.SharePageTab.LINK:e=3;break;default:e=0}return o.default.createElement(d.TabNav,{className:r.default({"share-page-view":!0,"maestro-pagelet-tab-nav":this.props.isMaestroDesign}),defaultSelectedIndex:e,onChange:this._handleTabSelect,tabs:t,variant:c.TabVariant.UNDERLINE},this._renderTab())},t.prototype._renderTab=function(){switch(this.props.viewingTab){case m.SharePageTab.RECENT:return o.default.createElement(f.RecentsTab,a.__assign({folderRowActions:this.props.folderRowActions,fileRowActions:this.props.fileRowActions,listingFolders:this.props.listingFolders,listingFiles:this.props.listingFiles,user:this.props.user,isTeamPolicyLoaded:this.props.isTeamPolicyLoaded,expBasicNearOrOverQuotaJoinTeam:this.props.expBasicNearOrOverQuotaJoinTeam,expSubgrowthProSharePageUpdates:this.props.expSubgrowthProSharePageUpdates},this.props.recentTabActions));case m.SharePageTab.FOLDER:return o.default.createElement(_.FoldersTab,a.__assign({folderRowActions:this.props.folderRowActions,listing:this.props.listingFolders,user:this.props.user,isTeamPolicyLoaded:this.props.isTeamPolicyLoaded,expBasicNearOrOverQuotaJoinTeam:this.props.expBasicNearOrOverQuotaJoinTeam,expSubgrowthProSharePageUpdates:this.props.expSubgrowthProSharePageUpdates},this.props.folderTabActions,this.props.fileTabActions));case m.SharePageTab.FILE:return o.default.createElement(h.FilesTab,a.__assign({fileRowActions:this.props.fileRowActions,listing:this.props.listingFiles,user:this.props.user},this.props.fileTabActions));case m.SharePageTab.LINK:return o.default.createElement(S,a.__assign({user:this.props.user},this.props.linkTabActions));default:return}},t.displayName="SharePage",t.defaultProps={fileTabActions:{},folderTabActions:{},recentTabActions:{},inviteCount:0,isTeamPolicyLoaded:!1,linkTabActions:{}},t})(o.default.Component);t.SharePageRedesign=l.requireCssWithComponent(y,["/static/css/scooter/scooter-scoped-vfljL5ijS.css","/static/css/sharing/maestro-components-vfl9VVHw4.css","/static/css/sharing/maestro-layout-vflvEmc2B.css","/static/css/sharing/share_page-vflwcnY8R.css"],[i.AppActionsView,h.FilesTab,_.FoldersTab,f.RecentsTab,d.TabNav])})),define("modules/clean/sharing/share_page/views/shared_file_icon",["require","exports","tslib","react","spectrum/file_icon"],(function(e,t,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return r.default.createElement(o.FileIcon,{path:this.props.sharedFileMetadata.name,"aria-label":this.props.sharedFileMetadata.name,role:"img",className:this.props.className})},t})((r=a.__importDefault(r)).default.Component);t.SharedFileIcon=s}));
//# sourceMappingURL=pkg-file_uploader_and_sharing.min.js-vfljbmBc0.map