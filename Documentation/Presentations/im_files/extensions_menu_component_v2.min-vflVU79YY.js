define(["require","exports","tslib","classnames","react","react-redux","dig-components/buttons","dig-components/menu","spectrum/button","spectrum/tertiary_link","modules/clean/file_store/utils","modules/clean/integrations/data/selectors","modules/clean/react/app_actions/apis","modules/clean/react/app_actions/shared_file_popover_content_component","modules/clean/react/app_actions/telemetry_client","modules/clean/react/css","modules/clean/react/extensions/data/action_creators","modules/clean/react/extensions/data/helpers","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/types","modules/clean/react/extensions/extensions_popover_content_component_v2","modules/clean/react/extensions/extensions_utils","modules/clean/react/extensions/file","modules/clean/react/extensions/tooltips","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/open_button/types","modules/clean/react/file_viewer/unity/with_unity","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/core/i18n","spectrum/tooltip","modules/constants/file_viewer"],(function(e,t,n,o,r,i,a,s,l,p,c,u,d,g,f,m,_,h,T,y,v,w,C,E,S,x,B,O,b,A,P,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),r=n.__importDefault(r);var D="TOOLTIP_ONLY"===k.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,I="COPY_AND_TOOLTIP"===k.FILES_2_COLLAPSED_SHARE_COPY_TOOLTIP_CHANGES,F=(function(e){function t(t){var o=e.call(this,t)||this;return o.openOptionsArgs=function(){var e=o.props.telemetryContext,t=e?e.surface:void 0;return n.__assign(n.__assign({},o.props),{isCloudEditorDisabled:!0,surface:t})},o.handleButtonClick=function(e){e.preventDefault(),e.stopPropagation()},o.handleMenuClick=function(e){e.preventDefault(),e.stopPropagation()},o.handleHover=function(){o.currentSession&&o.currentSession.event("trigger_hover")},o.setBigTooltip=function(e){return n.__awaiter(o,void 0,void 0,(function(){var t,o,r,i,a,s,l,p,c;return n.__generator(this,(function(n){switch(n.label){case 0:return t=this.props,o=t.file,r=t.appActions,i=t.featureFlags,a=C.getFileExt(o)||"",(s=r.length>0)?[4,d.getTooltipHistory(e,["open_with_edu"])]:[3,2];case 1:l=n.sent(),p=E.allowedTooltips(s,a,i),c=p.find((function(e){return void 0!==l[e]&&!l[e]})),this.setState({bigTooltipName:c}),n.label=2;case 2:return[2]}}))}))},o.markBigTooltipViewed=function(){var e=!1,t=[];o.state.bigTooltipName&&(t.push(d.markTooltipViewed(o.props.user.id,o.state.bigTooltipName)),e=!0),e&&(Promise.all(t).then((function(){o.props.showBigTooltip&&o.setBigTooltip(o.props.user.id)})),o.setState({bigTooltipName:void 0}))},o.handleSelectAction=function(e,t){t.preventDefault(),e.handler(),o.props.onExtensionClick&&o.props.onExtensionClick(e.actionName||e.userAction),o.logToPreviews(e,!1),t.stopPropagation()},o.logToPreviews=function(e,t){if(o.props.telemetryContext&&"previews"===o.props.telemetryContext.surface&&e.userAction){var n=t?S.UserActionContext.TitleBarMain:S.UserActionContext.TitleBarSplitButton,r=e.actionName?{app_action_name:e.actionName}:{};c.isBrowseFile(o.props.file)&&o.props.file.read_only&&(r.readOnly=!0),x.logUserAction(e.userAction,n,r)}},o.renderTrigger=function(e){var t=null;switch(o.props.triggerType){case y.TriggerType.SidebarLink:t=r.default.createElement(p.TertiaryLink,n.__assign({className:"app-action-open-with-menu__trigger app-action-open-with-menu__trigger-link",icon:"open-with"},e),o.triggerText());break;case y.TriggerType.OpacityButton:t=r.default.createElement(a.Button,n.__assign({variant:"opacity",className:"app-action-open-with-menu__trigger app-action-open-with-menu__trigger-button"},e),o.renderTriggerButtonContent());break;default:t=r.default.createElement(l.Button,n.__assign({className:"app-action-open-with-menu__trigger app-action-open-with-menu__trigger-button",variant:o.props.triggerType===y.TriggerType.SecondaryButton||o.props.triggerType===y.TriggerType.CollapsedButton?"secondary":"primary"},e),o.renderTriggerButtonContent())}return r.default.createElement("div",n.__assign({onMouseDown:o.markBigTooltipViewed,onMouseEnter:o.handleHover},e),t)},o.renderExtensionPopoverV2Content=function(e){return function(){var t=o.props,n=t.file,i=t.user,a=t.appActions,s=t.bylines,l=t.categoryInfos,p=t.featureFlags,u=t.telemetryContext,d=w.getCategoryIdToInfos(l);if(c.isBrowseFile(n)&&(a.length>0||e.length>0))return r.default.createElement(v.ExtensionsPopoverV2WithUnity,{file:n,user:i,openOptions:e,appActions:a,bylines:s,categoryIdToInfos:d,featureFlags:p,updateLinkState:o.handleUpdateLinkState,telemetryContext:u,currentSession:o.currentSession});if(c.isSharedFile(n)){var f=h.partitionActions(a).cloudEditors;return r.default.createElement(g.SharedFilePopoverContent,{openOptions:e,cloudEditorAppActions:f,file:n,user:i,currentSession:o.currentSession})}return null}},o.renderMenu=function(e){return r.default.createElement(s.Menu.Wrapper,{onSelection:o.handleSelectAction,onToggle:o.onPopoverToggle,isPortaled:!1},(function(t){var i=t.getContentProps,a=t.getTriggerProps;return r.default.createElement(r.default.Fragment,null,o.renderTrigger(a({onClick:o.handleButtonClick})),r.default.createElement(s.Menu.Content,n.__assign({},i({}),{onClick:o.handleMenuClick,placement:"bottom-end"}),o.renderExtensionPopoverV2Content(e)()))}))},o.onPopoverToggle=function(e){var t=e.isOpen;t&&o.props.onDropdownOpen?o.props.onDropdownOpen():!t&&o.props.onDropdownClose&&o.props.onDropdownClose(),o.currentSession&&o.currentSession.event(t?"open_popover":"close_popover")},o.onDownloadClick=function(e){return function(t){t.preventDefault(),t.stopPropagation(),e.handler(),o.logToPreviews(e,!0)}},o.handleUpdateLinkState=function(e,t){var n=o.props.updateLinkState;n&&n({actionId:e,linkState:t})},o.state={},o.telemetryClient=f.createTelemetryClient({component:"menu_v2"}),o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.showBigTooltip&&this.setBigTooltip(this.props.user.id)},t.prototype.triggerText=function(){return A.intl.formatMessage({id:"z5t3Bh",defaultMessage:"Open"})},t.prototype.renderTriggerButtonContent=function(){var e=this.triggerText();if(this.props.triggerType===y.TriggerType.CollapsedButton){var t=r.default.createElement("div",{className:"app-actions-open-with-menu__trigger-content"},r.default.createElement(b.ButtonIcon,{name:"open","aria-label":e}));return(D||I)&&this.props.triggerType===y.TriggerType.CollapsedButton?r.default.createElement(P.Tooltip,{positionOffset:8,positioning:"left",tooltipContent:A.intl.formatMessage({id:"KEegJt",defaultMessage:"Open With"})},t):t}return r.default.createElement("div",{className:"app-actions-open-with-menu__trigger-content app-actions-open-with-menu__trigger-content--with-text"},r.default.createElement("div",{className:"app-action-open-with-menu__trigger-button-text"},e+" â–¾"))},t.prototype.render=function(){var e=this.props,t=e.file,n=e.appActions,i=e.featureFlags,a=e.isInFVSidebar,s=e.telemetryContext,p=e.triggerType,u=e.showAsButtonIfDownloadOnly;if(!t.file_id)return null;s?this.currentSession=this.telemetryClient.session({surface:s.surface,ext:f.getPiiSafeExtension(C.getFileExt(t)||""),feature_flags:i}):delete this.currentSession;var d=w.getOpenOptionsForFile(this.openOptionsArgs()),g=p===y.TriggerType.CollapsedButton,m=d.length>0,_=!1;if(m&&1===d.length&&(m=!(_=d[0].type===B.OpenButtonAction.DOWNLOAD)),!m&&(0===n.length||c.isSharedFile(t)&&0===h.partitionActions(n).cloudEditors.length)){if(u&&_){var T=p===y.TriggerType.SecondaryButton||g?"secondary":"primary",v=g||a&&"secondary"===T;return r.default.createElement(l.Button,{className:o.default("app-actions-download-button",{"app-actions-download-button--collapsed":v}),variant:T,onClick:this.onDownloadClick(d[0])},v?r.default.createElement(b.ButtonIcon,{name:"download-file",isPrimary:"primary"===T,"aria-label":A.intl.formatMessage({id:"pHnJw0",defaultMessage:"Download"})}):A.intl.formatMessage({id:"pHnJw0",defaultMessage:"Download"}))}return null}return this.renderMenu(d)},t.defaultProps={showAsButtonIfDownloadOnly:!1,triggerType:y.TriggerType.SecondaryButton},t})(r.default.Component);t.ExtensionsMenuV2Component=F;var M=function(e,t){return{appActions:T.getOpenActionsForFile(e,t.file),bylines:T.getBylines(e),categoryInfos:T.getCategoryInfos(e),featureFlags:T.getFeatureFlags(e),cloudDocsInfo:T.getCloudDocInfo(e),landingPagesEnabled:u.isConnectServiceLandingPagesEnabled(e)}},L={updateLinkState:_.updateLinkState,refreshSharingServiceInfo:_.refreshSharingServiceInfoAdapter},N=i.connect(M,L)(F);t.ExtensionsMenuV2NoUnity=m.requireCssWithComponent(N,["/static/css/app_actions/index-vflHsvf3d.css","/static/css/dig-components/index.web-vflSjAPFK.css"]);var V=i.connect(M,L)((function(e){return c.isBrowseFile(e.file)?r.default.createElement(O.WithUnity,{file:e.file,user:e.user,render:function(t){return r.default.createElement(F,n.__assign({},e,{unityInfo:t}))}}):r.default.createElement(F,n.__assign({},e))}));t.ExtensionsMenuV2=m.requireCssWithComponent(V,["/static/css/app_actions/index-vflHsvf3d.css","/static/css/dig-components/index.web-vflSjAPFK.css"])}));
//# sourceMappingURL=extensions_menu_component_v2.min.js-vflFizT57.map