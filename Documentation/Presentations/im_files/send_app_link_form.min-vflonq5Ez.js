define(["require","exports","tslib","react","react-dom","modules/clean/react/css","modules/clean/static_urls","phone_helpers","modules/constants/viewer","modules/core/notify","modules/core/i18n","modules/clean/ajax","modules/clean/mobile_tracker","modules/clean/react/growth/send_app_link_form_disclaimer","modules/clean/validators/email_validator","modules/core/dom"],(function(e,t,n,a,r,o,i,s,u,l,p,m,d,c,f,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=n.__importDefault(a),r=n.__importStar(r),s=n.__importStar(s),u=n.__importStar(u),m=n.__importStar(m),f=n.__importDefault(f),_=n.__importStar(_);var h,S,b,g=["AQ","BV","PN"];(function(e){e.SENDING="sending",e.SUCCESS="success",e.INVALID="invalid",e.FAILURE="failure"})(h=t.SendStatus||(t.SendStatus={})),(function(e){e.SMS="sms",e.EMAIL="email"})(S=t.SendAppLinkFormType||(t.SendAppLinkFormType={})),(function(e){e.RIGHT="button-right",e.BOTTOM="button-bottom"})(t.SendAppLinkButtonPosition||(t.SendAppLinkButtonPosition={})),(function(e){e.DEFAULT="default",e.SUBMIT_ON_BOTTOM="submit-on-bottom"})(b=t.SendAppLinkFormLayout||(t.SendAppLinkFormLayout={})),t.showStatusUsingNotify=function(e){var t=e.currentFormType,n=e.sendStatus,a=e.phoneNumber,r=e.email;switch(l.Notify.clear(),n){case h.SENDING:l.Notify.info(p.intl.formatMessage({id:"zq/eht",defaultMessage:"Sending"}),60);break;case h.SUCCESS:var o=void 0;switch(t){case S.SMS:o=p.intl.formatMessage({id:"GHBzHK",defaultMessage:"Link sent to {phone_number}"},{phone_number:a});break;case S.EMAIL:o=p.intl.formatMessage({id:"RQAh9Y",defaultMessage:"Link sent to {email}"},{email:r})}o&&l.Notify.success(o,3);break;case h.INVALID:var i=void 0;switch(t){case S.SMS:i=p.intl.formatMessage({id:"SYbWri",defaultMessage:"Please enter a valid phone number"});break;case S.EMAIL:i=p.intl.formatMessage({id:"CAJjXO",defaultMessage:"Please enter a valid email address"})}i&&l.Notify.error(i,3);break;case h.FAILURE:l.Notify.error(p.intl.formatMessage({id:"2/fjiQ",defaultMessage:"There was an error sending the link"}),3)}};var y=(function(e){function t(t){var r=e.call(this,t)||this;if(r.getUnformattedNumber=function(e){return(e=e||r.state.phoneNumber).replace(/[^\d]/g,"")},r.isPhoneNumberValid=function(e){e=e||r.state.phoneNumber;var t=r.getPhoneNumberPlaceholder();return r.getUnformattedNumber(e).length===r.getUnformattedNumber(t).length},r.isEmailValid=function(e){return e=e||r.state.email,f.default.validate(e).every((function(e){return e.valid}))},r.handleSubmit=function(e){e.preventDefault();var t=d.getMobileTrackerCampaignParams();switch(r.state.currentFormType){case S.SMS:r.state.sendStatus!==h.SENDING&&(r.isPhoneNumberValid()?(r.setState({sendStatus:h.SENDING}),m.SilentBackgroundRequest({url:"/text_mobile_app",data:n.__assign({country_code:r.getCountryCode(),phone_number:r.getUnformattedNumber()},t),success:function(e){"True"===e?r.setState({sendStatus:h.SUCCESS}):r.setState({sendStatus:h.FAILURE})},error:function(){r.setState({sendStatus:h.FAILURE})}})):r.setState({sendStatus:h.INVALID}));break;case S.EMAIL:r.state.sendStatus!==h.SENDING&&(r.isEmailValid()?(r.setState({sendStatus:h.SENDING}),m.SilentBackgroundRequest({url:"/email_mobile_app",data:n.__assign({recipient_email:r.state.email},t),success:function(e){"True"===e?r.setState({sendStatus:h.SUCCESS}):r.setState({sendStatus:h.FAILURE})},error:function(){r.setState({sendStatus:h.FAILURE})}})):r.setState({sendStatus:h.INVALID}))}r.props.onSubmit&&r.props.onSubmit(e)},r.handlePhoneNumberInput=function(){r.phoneNumberInput&&r.setState({phoneNumber:r.phoneNumberInput.value})},r.handleCountryCodeInput=function(){r.countrySelect&&r.setState({countryAbbreviation:r.countrySelect.value,phoneNumber:""})},r.getStateIconElement=function(){var e;switch(r.state.sendStatus){case h.SUCCESS:e=i.static_url("/static/images/home/experiments/checkmark-vflUJLI49.svg");break;case h.INVALID:e=i.static_url("/static/images/home/experiments/error-vflNe4epB.svg");break;default:return null}return a.default.createElement("img",{src:e,"aria-hidden":"true",className:"send-app-link-form__phone-number__icon"})},r.getCountryIso=function(){return s.iso_to_dialing(r.state.countryAbbreviation)},r.getPhoneNumberPlaceholder=function(){return s.get_example_mobile_number(r.getCountryIso())},r.getCountryCode=function(e){return e=e||r.state.countryAbbreviation,r.props.phoneInputData?r.props.phoneInputData.phone_code_map[e]:null},r.setCountrySelectRef=function(e){return r.countrySelect=e},r.setPhoneNumberInputRef=function(e){return r.phoneNumberInput=e},r.handleFocusCountryCode=function(){r.setState({isCountryCodeFocused:!0})},r.handleBlurCountryCode=function(){r.setState({isCountryCodeFocused:!1})},r.renderHelperText=function(){var e=r.props.inputHelperText,t=r.state,n=t.sendStatus,o=t.currentFormType;if(!e)return null;var i=o===S.SMS?"phone":"email";return a.default.createElement("div",{className:"send-app-link-form__"+i+"-input__error-text send-app-link-form__"+i+"-input__error-text--"+n},e)},r.getPhoneInput=function(){var e=r.props,t=e.phoneInputData,n=e.buttonPosition,o=e.inputHasBorder,i=e.isFullWidth,u=e.smsInputPlaceholder,l=r.state,m=l.countryAbbreviation,d=l.isCountryCodeFocused,c=l.sendStatus,f=l.phoneNumber,_=s.format(r.getCountryIso(),f),h=r.getPhoneNumberPlaceholder();return t?a.default.createElement("div",{className:"\n        send-app-link-form__phone-input\n        send-app-link-form__phone-input--"+n+"\n        send-app-link-form__phone-input--"+(i?"full-width":"auto-width")+"\n        send-app-link-form__phone-input--"+c+"\n      "},a.default.createElement("div",{className:"send-app-link-form__phone-input__input-group"},a.default.createElement("div",{className:"send-app-link-form__country-select"},a.default.createElement("label",{htmlFor:"send-app-link-form__country-select__input"},p.intl.formatMessage({id:"1SPrvR",defaultMessage:"Country"})),a.default.createElement("select",{id:"send-app-link-form__country-select__input",name:"country",className:"send-app-link-form__country-select__input",onChange:r.handleCountryCodeInput,onFocus:r.handleFocusCountryCode,onBlur:r.handleBlurCountryCode,ref:r.setCountrySelectRef,value:m},a.default.createElement("option",{disabled:!0,"aria-selected":!1},p.intl.formatMessage({id:"LrbExT",defaultMessage:"Country code"})),t.country_list.map((function(e){var t=e[0],n=e[1],o=r.getCountryCode(t);return o&&-1===g.indexOf(t)?a.default.createElement("option",{value:t,key:t,"aria-selected":m===t},n+" "+o):null}))),a.default.createElement("div",{className:"\n                send-app-link-form__country-select__display\n                send-app-link-form__country-select__display--"+c+"\n                send-app-link-form__country-select__display--"+(o?"border":"borderless")+"\n                send-app-link-form__country-select__display--"+(d?"outline":"no-outline")+"\n              ","aria-hidden":!0},r.getCountryCode())),a.default.createElement("div",{className:"send-app-link-form__phone-number"},a.default.createElement("label",{htmlFor:"send-app-link-form__phone-number__input"},p.intl.formatMessage({id:"iWHTv1",defaultMessage:"Phone number"})),a.default.createElement("input",{id:"send-app-link-form__phone-number__input",type:"tel",name:"phone_number",className:"\n                send-app-link-form__phone-number__input\n                send-app-link-form__phone-number__input--"+c+"\n                send-app-link-form__phone-number__input--"+(o?"border":"borderless")+"\n              ",placeholder:u||p.intl.formatMessage({id:"iWHTv1",defaultMessage:"Phone number"}),value:_,onChange:r.handlePhoneNumberInput,ref:r.setPhoneNumberInputRef,maxLength:h.length}),r.getStateIconElement())),r.renderHelperText()):null},r.setEmailInputRef=function(e){return r.emailInput=e},r.handleEmailInput=function(){r.emailInput&&r.setState({email:r.emailInput.value})},r.getEmailInput=function(){var e=r.state,t=e.sendStatus,n=e.email,o=r.props,i=o.buttonPosition,s=o.inputHasBorder,u=o.isFullWidth,l=o.emailInputPlaceholder;return a.default.createElement("div",{className:"\n        send-app-link-form__email-input\n        send-app-link-form__email-input--"+i+"\n        send-app-link-form__email-input--"+(u?"full-width":"auto-width")+"\n        send-app-link-form__email-input--"+t+"\n      "},a.default.createElement("div",{className:"send-app-link-form__email-input__input-group"},a.default.createElement("label",{htmlFor:"send-app-link-form__email__input"},p.intl.formatMessage({id:"yU0xda",defaultMessage:"Email address"})),a.default.createElement("input",{id:"send-app-link-form__email__input",type:"email",name:"email",className:"\n              send-app-link-form__email__input\n              send-app-link-form__email__input--"+t+"\n              send-app-link-form__email__input--"+(s?"border":"borderless")+"\n            ",placeholder:l||p.intl.formatMessage({id:"yU0xda",defaultMessage:"Email address"}),value:n,onChange:r.handleEmailInput,ref:r.setEmailInputRef}),r.getStateIconElement()),r.renderHelperText())},r.getInactiveFormType=function(){var e=r.props.formTypes.filter((function(e){return e!==r.state.currentFormType}));return e.length?e[0]:null},r.getFormInputElement=function(){switch(r.state.currentFormType){case S.SMS:return r.getPhoneInput();case S.EMAIL:return r.getEmailInput();default:return null}},r.getFormSwitchPhrase=function(){switch(r.getInactiveFormType()){case S.SMS:return p.intl.formatMessage({id:"NIcDB+",defaultMessage:"Or text me the link"});case S.EMAIL:return p.intl.formatMessage({id:"2WiFdV",defaultMessage:"Or email me the link"});default:return null}},r.handleClickFormSwitch=function(e){e.preventDefault();var t=r.getInactiveFormType();t&&r.setState({currentFormType:t})},r.setFormRef=function(e){r.formRef=e},r.getSubmitButton=function(){var e=r.props,t=e.SubmitButton,n=e.isFullWidth,o=r.state,i=o.sendStatus,s=o.currentFormType;return a.default.createElement("div",{className:"\n          send-app-link-form__submit-wrapper\n          send-app-link-form__submit-wrapper--"+(n?"full-width":"auto-width")+"\n        "},a.default.createElement(t,{sendStatus:i,currentFormType:s}))},r.getFormSwitchButton=function(e){var t=r.props.isFullWidth;return a.default.createElement("div",{className:"\n                send-app-link-form__form-switch__wrapper\n                send-app-link-form__form-switch__wrapper--"+(t?"full-width":"auto-width")+"\n              "},a.default.createElement("button",{className:"send-app-link-form__form-switch",onClick:r.handleClickFormSwitch,type:"button"},e))},r.getDisclaimer=function(){var e=r.state.currentFormType;return a.default.createElement("div",{className:"\n              send-app-link-form__disclaimer\n              send-app-link-form__disclaimer--"+(e===S.SMS?"visible":"hidden")+"\n            ","aria-hidden":e!==S.SMS},a.default.createElement(c.SendAppLinkFormDisclaimer,{tabIndex:e===S.SMS?0:-1,onShowTooltip:r.props.onShowDisclaimerTooltip}))},t.formTypes.includes(S.SMS)&&!t.phoneInputData)throw new Error("SMS form type required phoneInputData prop");return r.state={currentFormType:t.formTypes[0],phoneNumber:"",countryAbbreviation:u.LOCALE||"US",isCountryCodeFocused:!1,email:t.defaultUserEmail?t.defaultUserEmail:"",sendStatus:null},r}return n.__extends(t,e),t.prototype.componentDidUpdate=function(e,t){var n=this.props,a=n.onStatusChange,o=n.onSwitchFormType,i=n.onChangeCountryCode,s=this.state,l=s.sendStatus,p=s.phoneNumber,m=s.countryAbbreviation,d=s.currentFormType,c=s.email;if(a&&t.sendStatus!==l&&a({currentFormType:d,sendStatus:l,phoneNumber:p,email:c}),t.phoneNumber===p&&t.countryAbbreviation===m&&t.email===c&&t.currentFormType===d||(this.setState({sendStatus:null}),i&&m!==t.countryAbbreviation&&i(m),this.props.onChangeInput&&(t.email!==c?this.props.onChangeInput(c):t.phoneNumber!==p&&this.props.onChangeInput(p))),t.currentFormType!==d){if(this.setState({phoneNumber:"",countryAbbreviation:u.LOCALE||"US",email:this.props.defaultUserEmail?this.props.defaultUserEmail:""}),this.formRef){var f=r.findDOMNode(this.formRef),h=_.getTabbableElementsIn(f);h.length&&h[0].focus()}o&&o(d)}},t.prototype.render=function(){var e=this.props,t=e.formTypes,n=e.buttonPosition,r=e.showDisclaimer,o=e.formLayout,i=this.getFormSwitchPhrase(),s=this.getFormInputElement(),u=this.getSubmitButton(),l=t.length>1&&i&&this.getFormSwitchButton(i),p=r&&this.getDisclaimer(),m=a.default.createElement(a.default.Fragment,null,s,u,l,p);switch(o){case b.SUBMIT_ON_BOTTOM:m=a.default.createElement(a.default.Fragment,null,s,p,l,u)}return a.default.createElement("form",{noValidate:!0,onSubmit:this.handleSubmit,className:"\n          send-app-link-form\n          send-app-link-form--"+n+"\n        ",ref:this.setFormRef},m)},t})(a.default.Component);t.SendAppLinkFormComponent=y,t.SendAppLinkForm=o.requireCssWithComponent(y,["/static/css/growth/send_app_link_form-vfltLtwbX.css"])}));
//# sourceMappingURL=send_app_link_form.min.js-vflceDn4Z.map