define(["require","exports","tslib","react","modules/core/i18n","spectrum/modal","modules/clean/static_urls","dig-components/buttons","modules/clean/ux_analytics_modal_tracking","modules/clean/react/css","modules/clean/react/modal","react-modal","external/lodash","modules/clean/react/extensions/common","modules/clean/react/extensions/data/helpers","modules/clean/react/extensions/data/selectors","modules/clean/react/app_actions/redirect","modules/clean/react/file_viewer/open_button/types","modules/clean/react/extensions/cloud_docs_compat","dig-components/typography","dig-components/text_fields","dig-components/icons","dig-components/icons/src","modules/clean/react/app_directory/client","dig-components/progress_indicators","classnames","external/lodash","modules/clean/react/app_actions/developers_site/types"],(function(e,t,a,n,r,s,o,i,c,l,d,p,u,m,f,g,_,h,y,v,x,E,S,M,A,N,C,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),u=a.__importStar(u),M=a.__importStar(M),N=a.__importDefault(N);var I=function(e){return"api_app"===e[".tag"]?e[".tag"]+"/"+e.api_app:"first_party_app"===e[".tag"]?e[".tag"]+"/"+e.first_party_app:""+e[".tag"]};function T(){return n.default.createElement("div",{className:"extensions-scaling-modal__directory-entry-point"},n.default.createElement(v.Link,{href:"/apps",hasNoUnderline:!0,variant:"monochromatic",className:"extensions-scaling-modal__directory-entry-point-text-border"},n.default.createElement(v.Text,{isBold:!0},r.intl.formatMessage({id:"LbLi52",defaultMessage:"View all apps"}))))}t.AppDirectoryEntryPoint=T;var k=(function(e){function t(t){var a=e.call(this,t)||this;return a.hasUsedSearchBar=!1,a.onScroll=C.throttle((function(e){e>0&&!a.state.showTopBorder&&a.setState({showTopBorder:!0}),0===e&&a.state.showTopBorder&&a.setState({showTopBorder:!1})}),20),a.createClickHandler=function(e){return function(){d.Modal.close();var t=a.props,n=t.user,r=t.file,s=t.featureFlags,o=t.currentSession,i=t.telemetryContext,c=t.updateLinkState,l=t.onProfileServiceAuth;if(_.redirectToActionOrShowAuth(n,r,e,s,i,c,l),"redirect"===e.handler[".tag"])m.logEvent(o,"select_action",m.getAppActionExtras(e));else if("cloud_editor"===e.handler[".tag"]){var p=y.isWopiAction(e)?h.OpenButtonAction.OPEN_WITH:h.OpenButtonAction.OPEN_WITH_CLOUD_DOC;m.logEvent(a.props.currentSession,"select_legacy_action",{type:p})}}},a.handleQueryChange=function(e){var t=e.currentTarget.value;a.setState({searchKey:t}),a.hasUsedSearchBar||(m.logEvent(a.props.currentSession,"start_searching",{}),a.hasUsedSearchBar=!0)},a.filterActions=function(){var e=a.props,t=e.appActions,n=e.categoryIdToInfos,r=a.state.searchKey.trim().toLowerCase(),s=t.map((function(e){return e.category})).map((function(e){return n[e]})).filter((function(e){return-1!==e.display_name.toLowerCase().indexOf(r)})).map((function(e){return e.id}));return t.filter((function(e){var t=a.getAppDirectoryPageInfo(e);return(function(e,t){return t||e.app_directory_id&&"first_party_app"===e.app_directory_id[".tag"]||e.developer_state===w.DeveloperState.IN_DEVELOPMENT})(e,t)&&(-1!==e.description.toLowerCase().indexOf(r)||(function(e){return!(!e||!e.short_description)&&-1!==e.short_description.toLowerCase().indexOf(r)})(t)||s.includes(e.category))}))},a.clearSearch=function(){a.setState({searchKey:""})},a.renderExtensionItem=function(e){var t=e.icon,s=t.is_static?o.static_url("/static/images/generic_app_icon-vflIPYT1H.png"):t.url,c=m.isLinked(e),l=c?"primary":"opacity",d=c?g.isShareAction(e)?r.intl.formatMessage({id:"NoV3Co",defaultMessage:"Share"}):r.intl.formatMessage({id:"CNPdm5",defaultMessage:"Open"}):r.intl.formatMessage({id:"vV9l+M",defaultMessage:"Connect"});return n.default.createElement("div",{className:"extension-section",key:e.description},n.default.createElement("img",{src:s,className:"extensions-icon",alt:""}),a.renderActionInfo(e),n.default.createElement("div",{className:"extensions-scaling-modal__redirect_button_wrapper"},n.default.createElement(i.Button,{variant:l,onClick:a.createClickHandler(e),className:"extensions-scaling-modal__redirect_button"},d)))},a.getAppDirectoryPageInfo=function(e){var t=e.app_directory_id&&I(e.app_directory_id);return t?a.state.appDirectoryPageInfo.get(t):void 0},a.renderActionInfo=function(e){var t="ON"===a.props.featureFlags.appDirectory,r=a.getAppDirectoryPageInfo(e),s=r&&r.short_description,o=r&&r.page_url,i=n.default.createElement(n.default.Fragment,null,n.default.createElement(v.Text,{tagName:"div",isBold:!0},e.description),s&&n.default.createElement(v.Text,{color:"faint",className:"extensions-short-description",size:"small"},s));return o&&t?n.default.createElement("div",{className:"extensions-description"},n.default.createElement(v.Link,{href:o,target:"_blank",rel:"noreferrer",variant:"monochromatic",hasNoUnderline:!0,className:"extensions-description__link"},i)):n.default.createElement("div",{className:"extensions-description"},i)},a.renderEmptySearch=function(){var e="ON"===a.props.featureFlags.appDirectory,t=a.state.searchKey,s=t?"/apps/search?query="+t:"/apps",i=t?r.intl.formatMessage({id:"4fGTX4",defaultMessage:"Search “{search_key}” in App Center"},{search_key:t}):r.intl.formatMessage({id:"C5jY7c",defaultMessage:"Search in App Center"});return e?n.default.createElement("div",{className:"extensions-scaling-modal__empty-search-app-center"},n.default.createElement(v.Text,null,r.intl.formatMessage({id:"niuDq6",defaultMessage:"Looking for something?"})),n.default.createElement(v.Link,{href:s,variant:"monochromatic"},n.default.createElement(v.Text,null,i))):n.default.createElement("div",{className:"extensions-scaling-modal__empty-search"},n.default.createElement("img",{className:"extensions-scaling-modal__empty-search-image",src:o.static_url("/static/images/empty_states/search-vflHMNVT9.png"),srcSet:o.static_url("/static/images/empty_states/search@2x-vfly2B3kk.png")+" 2x",alt:""}),n.default.createElement(v.Text,{isBold:!0},r.intl.formatMessage({id:"60pkl0",defaultMessage:"Looking for something?"})),n.default.createElement(v.Text,null,r.intl.formatMessage({id:"v6+J7C",defaultMessage:"Check spelling or try again."})))},a.state={searchKey:"",appDirectoryPageInfo:new Map,loading:!0},a}return a.__extends(t,e),t.prototype.componentDidMount=function(){var e=this,t=this.props.appActions.map((function(e){return e.app_directory_id})).filter((function(e){return void 0!==e}));this.fetchAppDirectoryPageInfoMap(t).then((function(t){return e.setState({appDirectoryPageInfo:t,loading:!1})}))},t.prototype.fetchAppDirectoryPageInfoMap=function(e){return a.__awaiter(this,void 0,Promise,(function(){return a.__generator(this,(function(t){switch(t.label){case 0:return[4,M.getPageInfos(e,this.props.user.id)];case 1:return[2,t.sent().reduce((function(e,t){for(var a=0,n=t.app_identifiers;a<n.length;a++){var r=n[a];e.set(I(r),t)}return e}),new Map)]}}))}))},t.prototype.render=function(){var e=this,t=this.props,a=t.onRequestClose,o=t.featureFlags,l=t.modalTitle,d=this.filterActions().sort(f.actionCompareFn),p="ON"===o.appDirectory;return n.default.createElement(s.Modal,{ariaLabel:r.intl.formatMessage({id:"wjwJvt",defaultMessage:"App actions"}),className:"extensions-scaling-modal",displayCloseButton:!0,open:!0,overlayClassName:"file-viewer-modal-overlay",overlayFixed:!1,onRequestClose:function(){return a()}},this.state.loading?n.default.createElement("div",{className:"extensions-scaling-modal__body-loading"}," ",n.default.createElement(A.Spinner,{"aria-valuetext":"Loading Apps"})," "):n.default.createElement("div",{className:"extensions-scaling-modal__body-wrapper"},n.default.createElement("div",{className:N.default({"extensions-scaling-modal__header-border":this.state.showTopBorder})},n.default.createElement("div",{className:"extensions-scaling-modal__title"},n.default.createElement(v.Title,null,l)),n.default.createElement("div",{className:"extensions-scaling-modal__search-bar"},n.default.createElement(x.TextInput,{"aria-label":"Search Apps",withLeftAccessory:n.default.createElement(E.UIIcon,{src:S.SearchLine}),withRightAccessory:this.state.searchKey&&n.default.createElement(i.IconButton,{variant:"transparent",onClick:this.clearSearch},n.default.createElement(E.UIIcon,{src:S.FailFill})),placeholder:r.intl.formatMessage({id:"+enW1p",defaultMessage:"Search by action or app name"}),value:this.state.searchKey,onChange:this.handleQueryChange}))),n.default.createElement("div",{className:"extensions-container",onScroll:function(t){var a=t.currentTarget.scrollTop;return e.onScroll(a)}},d.length>0?d.map((function(t){return e.renderExtensionItem(t)})):this.renderEmptySearch()),p&&n.default.createElement(T,null)),n.default.createElement(c.UXAnalyticsModalTracking,{id:"extensions-scaling-modal"}))},t})(n.default.Component);t.ExtensionsScalingModal=l.requireCssWithComponent(k,["/static/js/deep-integrations/index.web-vflaKPXS_.css","/static/css/app_actions/index-vflHsvf3d.css"]);var L=u.once((function(){p.setAppElement(document.body)}));t.showExtensionsScalingModal=function(e,a,r,s,o,i,c,l,p,u){L(),d.Modal.showInstance(n.default.createElement(t.ExtensionsScalingModal,{modalTitle:e,user:a,file:r,onRequestClose:d.Modal.close,appActions:s,categoryIdToInfos:o,featureFlags:i,updateLinkState:c,telemetryContext:l,currentSession:p,onProfileServiceAuth:u}));var f=m.partitionActionsByLinkStatus(s),g=f.connected_apps,_=f.unconnected_apps;m.logEvent(p,"view_scaling_modal",{connected_apps:g,unconnected_apps:_})}}));
//# sourceMappingURL=extensions_scaling_modal.min.js-vfl_azRtO.map